<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="dopingdata">
<title>Classifying substances • dopingdata</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Ubuntu-0.4.8/font.css" rel="stylesheet">
<link href="../deps/Ubuntu_Mono-0.4.8/font.css" rel="stylesheet">
<link href="../deps/Fira_Sans_Condensed-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Classifying substances">
<meta property="og:description" content="dopingdata">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">dopingdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Harvesting Data</h6>
    <a class="dropdown-item" href="../articles/scraping-usada-sanctions.html">USADA Sanctions</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Wrangling Data</h6>
    <a class="dropdown-item" href="../articles/clean-dates.html">Sanction Announced (Date)</a>
    <a class="dropdown-item" href="../articles/clean-sports.html">Sports</a>
    <h6 class="dropdown-header" data-toc-skip>Classifying Substances</h6>
    <a class="dropdown-item" href="../articles/classify.html">Adverse Analytical Findings</a>
    <h6 class="dropdown-header" data-toc-skip>Visualizing Substances</h6>
    <a class="dropdown-item" href="../articles/viz-counts.html">Counts</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Classifying substances</h1>
            
      
      
      <div class="d-none name"><code>classify.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjfrigaard.github.io/dopingdata/">dopingdata</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="st">"pak"</span> <span class="op"><a href="../reference/nin.html">%nin%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">loadedNamespaces</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"pak"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dplyr"</span>, <span class="st">"stringr"</span>, <span class="st">"tidyr"</span>, <span class="st">"forcats"</span><span class="op">)</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="va">pkgs</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Updated metadata database: 1.33 MB in 1 file.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Updating metadata database</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Updating metadata database ... done</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> All system requirements are already installed.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> No downloads are needed</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Installing system requirements</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Executing `sudo sh -c apt-get -y update`</span></span>
<span><span class="co">#&gt; Get:1 file:/etc/apt/apt-mirrors.txt Mirrorlist [142 B]</span></span>
<span><span class="co">#&gt; Hit:2 http://azure.archive.ubuntu.com/ubuntu jammy InRelease</span></span>
<span><span class="co">#&gt; Hit:3 http://azure.archive.ubuntu.com/ubuntu jammy-updates InRelease</span></span>
<span><span class="co">#&gt; Hit:4 http://azure.archive.ubuntu.com/ubuntu jammy-backports InRelease</span></span>
<span><span class="co">#&gt; Hit:5 http://azure.archive.ubuntu.com/ubuntu jammy-security InRelease</span></span>
<span><span class="co">#&gt; Hit:6 https://packages.microsoft.com/ubuntu/22.04/prod jammy InRelease</span></span>
<span><span class="co">#&gt; Hit:7 https://ppa.launchpadcontent.net/ubuntu-toolchain-r/test/ubuntu jammy InRelease</span></span>
<span><span class="co">#&gt; Reading package lists...</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Executing `sudo sh -c apt-get -y install libicu-dev`</span></span>
<span><span class="co">#&gt; Reading package lists...</span></span>
<span><span class="co">#&gt; Building dependency tree...</span></span>
<span><span class="co">#&gt; Reading state information...</span></span>
<span><span class="co">#&gt; libicu-dev is already the newest version (70.1-2).</span></span>
<span><span class="co">#&gt; 0 upgraded, 0 newly installed, 0 to remove and 26 not upgraded.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> 4 pkgs + 17 deps: kept 21 <span style="color: #B2B2B2;">[10.5s]</span></span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org/" class="external-link">forcats</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette covers classifying ‘adverse analytic findings’ for a
single banned substance. I’ve written a <code><a href="../reference/get_recent_file.html">get_recent_file()</a></code>
function to quickly import <code>.csv</code> files from a specified
directory:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"demo"</span>, package <span class="op">=</span> <span class="st">"dopingdata"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_recent_file.html">get_recent_file</a></span><span class="op">(</span><span class="va">pth</span>, regex <span class="op">=</span> <span class="st">'sports'</span>, ext <span class="op">=</span> <span class="st">'.csv'</span><span class="op">)</span></span></code></pre></div>
<pre><code>File last changed: 2023-12-21 20:33:32.064979
File name: 2023-12-21-tidy_sports.csv
✔ import code pasted to clipboard!</code></pre>
<p>This makes it easy to paste the necessary import code into the
console (or R markdown file):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_sports</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.delim</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'/Library/path/to/dopingdata/extdata/demo/2023-12-21-tidy_sports.csv'</span>, sep <span class="op">=</span> <span class="st">','</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="aafs-vs-adrvs">AAFs vs ADRVs<a class="anchor" aria-label="anchor" href="#aafs-vs-adrvs"></a>
</h2>
<p>The sanctions are divided into two categories:</p>
<ul>
<li><p><code>analytic</code>: <a href="https://www.usada.org/spirit-of-sport/education/alphabet-soup-results-management/#:~:text" class="external-link">Adverse
Analytical Finding</a>, AAF; <em>An AAF is a report from a
WADA-accredited laboratory that identifies the presence of a prohibited
substance and/or its metabolites or markers in a sample.</em></p></li>
<li><p><code>non-analytic</code>: <a href="https://www.usada.org/spirit-of-sport/education/non-analytical-anti-doping-rule-violations/" class="external-link">Non-Analytical
Anti-doping Rule Violation</a> ADRV; <em>a non-analytical anti-doping
rule violation does not stem from a positive urine or blood sample, but
instead originates from, and is substantiated by, other evidence of
doping or violations by an athlete or athlete support
personnel.</em>.</p></li>
</ul>
<div class="section level3">
<h3 id="substancereason">Substance/reason<a class="anchor" aria-label="anchor" href="#substancereason"></a>
</h3>
<p>The <code>substance_reason</code> column contains the details of the
sanction, which can include the following information:</p>
<ol style="list-style-type: decimal">
<li><p>The name of the banned substance</p></li>
<li><p>A description of the infraction (if non-analytic)</p></li>
</ol>
<p>We will use regular expressions to identify the type of substance
behind the sanction. See the examples below:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view</a></span><span class="op">(</span><span class="va">tidy_sports</span><span class="op">[[</span><span class="st">'substance_reason'</span><span class="op">]</span><span class="op">]</span>, </span>
<span>  <span class="st">"use \\(epo &amp; hgh\\)"</span>, match <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[638] │</span> erythropoietin (epo) and non-analytical: <span style="color: #00BBBB;">&lt;use (epo &amp; hgh)&gt;</span></span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view</a></span><span class="op">(</span><span class="va">tidy_sports</span><span class="op">[[</span><span class="st">'substance_reason'</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="st">"tampering, complicity"</span>, match <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[85] │</span> non-analytical: <span style="color: #00BBBB;">&lt;tampering, complicity&gt;</span></span></span></code></pre></div>
<p>Most of the non-analytic sanctions include the terms
<code>non-analytic</code>/<code>non-analytical</code>/etc., as a prefix
in the <code>substance_reason</code> column.</p>
</div>
<div class="section level3">
<h3 id="sanction-types">Sanction types<a class="anchor" aria-label="anchor" href="#sanction-types"></a>
</h3>
<p>I can pass these terms as regular expressions to create the
<code>sanction_type</code> variable, which will contain two values:
<code>non-analytic</code> and <code>analytic</code>. I’ll save this
variable in a new intermediate <code>substances</code> dataset:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">substances</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">tidy_sports</span>,</span>
<span>    sanction_type <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">substance_reason</span>,</span>
<span>        <span class="st">"non-analytical"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"non-analytic"</span>,</span>
<span>      <span class="op">!</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">substance_reason</span>,</span>
<span>        <span class="st">"non-analytical"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"analytic"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">sanction_type</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;   sanction_type   n</span></span>
<span><span class="co">#&gt; 1      analytic 498</span></span>
<span><span class="co">#&gt; 2  non-analytic 163</span></span></code></pre></div>
<p>Now I can filter <code>substances</code> to the
<code>analytical</code> sanctions in <code>sanction_type</code>.</p>
<div class="section level4">
<h4 id="how-can-i-identify-the-single-vs--multiple-substances">
<em>How can I identify the single vs. multiple substances?</em><a class="anchor" aria-label="anchor" href="#how-can-i-identify-the-single-vs--multiple-substances"></a>
</h4>
<p>Let’s take a look at four different sanctions in
<code>example_sanction_type</code>:</p>
<pre><code><span><span class="co">#&gt;           sport                                           substance_reason</span></span>
<span><span class="co">#&gt; 1      swimming                     non-analytical: 3 whereabouts failures</span></span>
<span><span class="co">#&gt; 2 track &amp; field                                               cannabinoids</span></span>
<span><span class="co">#&gt; 3     triathlon                  androgenic anabolic steroid; cannabinoids</span></span>
<span><span class="co">#&gt; 4 track &amp; field non-analytical: tampering, administration, and trafficking</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="substance-category">Substance category<a class="anchor" aria-label="anchor" href="#substance-category"></a>
</h3>
<p>We can see two analytic and two non-analytic sanctions, and each one
has a single and multiple substance/reason. Fortunately, the sanctions
with multiple items are separated by either semicolons (<code>;</code>),
commas (<code>,</code>), or a conjunction (<code>and</code>), and can be
separated by a regular expression:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">example_sanction_type</span>,</span>
<span>  substance_cat <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="co"># identify the multiple_sr substances using a regular expression</span></span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="st">"; |, | and | &amp; | / "</span><span class="op">)</span> <span class="op">~</span> <span class="st">'multiple'</span>,</span>
<span>    <span class="co"># negate the regular expression for the single substances</span></span>
<span>    <span class="op">!</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="st">"; |, | and | &amp; | / "</span><span class="op">)</span> <span class="op">~</span> <span class="st">'single'</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">substance_cat</span>, <span class="va">substance_reason</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">substance_cat</span>, values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   substance_reason                                           multiple single</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> androgenic anabolic steroid; cannabinoids                         1     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> non-analytical: tampering, administration, and trafficking        1     <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> cannabinoids                                                     <span style="color: #BB0000;">NA</span>      1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> non-analytical: 3 whereabouts failures                           <span style="color: #BB0000;">NA</span>      1</span></span></code></pre></div>
<p>The <code>substance_cat</code> identifier can be used to separate
sanctions with multiple substance/reasons from sanctions with a single
substance or reason.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">substances</span> <span class="op">&lt;-</span> <span class="va">substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>substance_cat <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="st">"; |, | and | &amp; | / "</span><span class="op">)</span> <span class="op">~</span> <span class="st">'multiple'</span>,</span>
<span>    <span class="op">!</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="st">"; |, | and | &amp; | / "</span><span class="op">)</span> <span class="op">~</span> <span class="st">'single'</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">substances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">substance_cat</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;   substance_cat   n</span></span>
<span><span class="co">#&gt; 1        single 478</span></span>
<span><span class="co">#&gt; 2      multiple 183</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="single-analytic-substances">Single analytic substances<a class="anchor" aria-label="anchor" href="#single-analytic-substances"></a>
</h2>
<p>First create a dataset that contains the sanctions with a
<em>single</em> substance listed. Store these in
<code>single_analytic_substances</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">single_analytic_substances</span> <span class="op">&lt;-</span> <span class="va">substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">substance_cat</span> <span class="op">==</span> <span class="st">'single'</span> <span class="op">&amp;</span> <span class="va">sanction_type</span> <span class="op">==</span> <span class="st">"analytic"</span><span class="op">)</span></span></code></pre></div>
<p>View the top ten single analytic substances:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">single_analytic_substances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">substance_reason</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 substance_reason  n</span></span>
<span><span class="co">#&gt; 1    androgenic anabolic steroid 49</span></span>
<span><span class="co">#&gt; 2                   cannabinoids 38</span></span>
<span><span class="co">#&gt; 3                       ostarine 37</span></span>
<span><span class="co">#&gt; 4                     clomiphene 18</span></span>
<span><span class="co">#&gt; 5              methylhexaneamine 12</span></span>
<span><span class="co">#&gt; 6                     stanozolol 11</span></span>
<span><span class="co">#&gt; 7                   testosterone 10</span></span>
<span><span class="co">#&gt; 8                     furosemide  9</span></span>
<span><span class="co">#&gt; 9                 spironolactone  8</span></span>
<span><span class="co">#&gt; 10 dehydroepiandrosterone (dhea)  7</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="multiple-analytic-substances">Multiple analytic substances<a class="anchor" aria-label="anchor" href="#multiple-analytic-substances"></a>
</h2>
<p>Next create a dataset with the sanctions listing <em>multiple</em>
substances in <code>substance_reason</code>. Store these in
<code>multiple_analytic_substances</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multiple_analytic_substances</span> <span class="op">&lt;-</span> <span class="va">substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">substance_cat</span> <span class="op">==</span> <span class="st">'multiple'</span> <span class="op">&amp;</span> <span class="va">sanction_type</span> <span class="op">==</span> <span class="st">"analytic"</span><span class="op">)</span></span></code></pre></div>
<p>View the top ten multiple analytic substances:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multiple_analytic_substances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">substance_reason</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                            substance_reason n</span></span>
<span><span class="co">#&gt; 1                    hydrochlorothiazide and chlorothiazide 4</span></span>
<span><span class="co">#&gt; 2      19-norandrosterone (19-na) and 19-noretiocholanolone 3</span></span>
<span><span class="co">#&gt; 3                             clomiphene and its metabolite 3</span></span>
<span><span class="co">#&gt; 4                                        ostarine; lgd-4033 3</span></span>
<span><span class="co">#&gt; 5  androgenic anabolic steroid &amp; 19-norandrosterone (19-na) 2</span></span>
<span><span class="co">#&gt; 6                 androgenic anabolic steroid and modafinil 2</span></span>
<span><span class="co">#&gt; 7                        benzoylecgonine and methylecgonine 2</span></span>
<span><span class="co">#&gt; 8                      hydrochlorothiazide &amp; chlorothiazide 2</span></span>
<span><span class="co">#&gt; 9                        methylphenidate and its metabolite 2</span></span>
<span><span class="co">#&gt; 10                               ostarine; lgd-4033; gw1516 2</span></span></code></pre></div>
<div class="section level3">
<h3 id="tidying-substances">Tidying substances<a class="anchor" aria-label="anchor" href="#tidying-substances"></a>
</h3>
<p>Tidying the sanctions with multiple <a href="https://www.wada-ama.org/en/prohibited-list?q" class="external-link">WADA banned
substances</a> (i.e., one substance per athlete per row) will result in
certain athletes appearing in the dataset more than once. The regular
expressions below cover a range of semicolons, tabs, and spaces to
identify and separate each substance.</p>
<div class="section level4">
<h4 id="add_match_col">add_match_col()<a class="anchor" aria-label="anchor" href="#add_match_col"></a>
</h4>
<blockquote>
<p><em>I’ve written the <code><a href="../reference/add_match_col.html">add_match_col()</a></code> function, which
creates a new <code>'matched'</code> column with the matched regular
expression pattern (it’s like <code><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">stringr::str_view()</a></code>, but in a
<code>data.frame</code>/<code>tibble</code>). I used
<code><a href="../reference/add_match_col.html">add_match_col()</a></code> while determining the correct pattern to
match on (i.e., any substances listing
<code>metabolites</code>):</em></p>
</blockquote>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">example_sanction_type</span>,</span>
<span>  <span class="co"># add matched column</span></span>
<span>  punct_match <span class="op">=</span> <span class="fu"><a href="../reference/add_match_col.html">add_match_col</a></span><span class="op">(</span></span>
<span>    string <span class="op">=</span> <span class="va">substance_reason</span>, </span>
<span>    pattern <span class="op">=</span> <span class="st">"[[:punct:]]"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt;                                             substance_reason punct_match</span></span>
<span><span class="co">#&gt; 1                     non-analytical: 3 whereabouts failures        -, :</span></span>
<span><span class="co">#&gt; 2                                               cannabinoids        &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3                  androgenic anabolic steroid; cannabinoids           ;</span></span>
<span><span class="co">#&gt; 4 non-analytical: tampering, administration, and trafficking  -, :, ,, ,</span></span></code></pre></div>
<blockquote>
<p><em>The rows above are all matching correctly on the regular
expression pattern.</em></p>
</blockquote>
<p>Below are a series of regular expression to 1) match the substances
that list <code>metabolites</code> 2) differentiate the multiple
substances, and 3) trims the white space from the tidy
<code>substance_reason</code> column.</p>
<p>The code below tests this pattern on a sample from
<code>multiple_analytic_substances</code> before its passed to
<code><a href="https://tidyr.tidyverse.org/reference/separate_rows.html" class="external-link">tidyr::separate_rows()</a></code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="va">multiple_analytic_substances</span>, size <span class="op">=</span> <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># replace plurals</span></span>
<span>      substance_reason <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="va">substance_reason</span>,</span>
<span>        <span class="st">"and its metabolite|and its metabolites|its metabolite"</span>,</span>
<span>        <span class="st">"(metabolite)"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_rows.html" class="external-link">separate_rows</a></span><span class="op">(</span><span class="va">substance_reason</span>, </span>
<span>        sep <span class="op">=</span> <span class="st">"; |;\t|\\t|, |;| and |and a |and | &amp; | / "</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>substance_reason <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html" class="external-link">trimws</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="st">"both"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="va">substance_reason</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 26 × 2</span></span></span>
<span><span class="co">#&gt;    athlete                substance_reason                   </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> atkinson, annie        hydrochlorothiazide                </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> atkinson, annie        chlorothiazide                     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> atkinson, annie        triamterene                        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> atkinson, annie        4-hydroxytriamterene               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> cardoso, josé henrique 19-norandrosterone (19-na)         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> cardoso, josé henrique 2a-methyl-5a-androstan-3a-ol-17-one</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> cardoso, josé henrique epitrenbolone                      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> cardoso, josé henrique methasterone                       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> cardoso, josé henrique testosterone                       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> prince, david          ostarine                           </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 16 more rows</span></span></span></code></pre></div>
<p>After confirming the pattern is working, the output will be stored in
<code>tidy_multiple_substances</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_multiple_substances</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">multiple_analytic_substances</span>,</span>
<span>  <span class="co"># replace plurals</span></span>
<span>    substance_reason <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="va">substance_reason</span>,</span>
<span>      <span class="st">"and its metabolite|and its metabolites|its metabolite"</span>,</span>
<span>      <span class="st">"(metabolite)"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_rows.html" class="external-link">separate_rows</a></span><span class="op">(</span><span class="va">substance_reason</span>, </span>
<span>      sep <span class="op">=</span> <span class="st">"; |;\t|\\t|, |;| and |and a |and | &amp; | / "</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>substance_reason <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html" class="external-link">trimws</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="st">"both"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>With both single and multiple substances in tidy format, they can be
combined together into a single <code>tidy_substances</code>
dataset.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">single_analytic_substances</span>, <span class="va">tidy_multiple_substances</span><span class="op">)</span> </span></code></pre></div>
<p>The top 10 tidy substances are below:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">substance_reason</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;               substance_reason  n</span></span>
<span><span class="co">#&gt; 1  androgenic anabolic steroid 65</span></span>
<span><span class="co">#&gt; 2                     ostarine 60</span></span>
<span><span class="co">#&gt; 3                 cannabinoids 41</span></span>
<span><span class="co">#&gt; 4                   clomiphene 31</span></span>
<span><span class="co">#&gt; 5                       gw1516 17</span></span>
<span><span class="co">#&gt; 6          hydrochlorothiazide 17</span></span>
<span><span class="co">#&gt; 7                   stanozolol 16</span></span>
<span><span class="co">#&gt; 8                 testosterone 16</span></span>
<span><span class="co">#&gt; 9   19-norandrosterone (19-na) 14</span></span>
<span><span class="co">#&gt; 10           methylhexaneamine 14</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="classifying-substances">Classifying substances<a class="anchor" aria-label="anchor" href="#classifying-substances"></a>
</h2>
<p>To identify the <a href="https://www.wada-ama.org/en/prohibited-list#search-anchor" class="external-link">WADA
banned substances</a>, I’ve written
<code><a href="../reference/classify_wada_substances.html">classify_wada_substances()</a></code>, a function that scans the
<code>substance_reason</code> column and identifies any substances found
on the <a href="https://www.wada-ama.org/sites/default/files/2022-09/2023list_en_final_9_september_2022.pdf" class="external-link">WADA
list</a>. See the <code><a href="../reference/classify_wada_substances.html">classify_wada_substances()</a></code> documentation
for more information.</p>
<div class="section level3">
<h3 id="wada-classes">WADA Classes<a class="anchor" aria-label="anchor" href="#wada-classes"></a>
</h3>
<p><code><a href="../reference/classify_wada_substances.html">classify_wada_substances()</a></code> creates a
<code>substance_group</code> variable with each of the WADA
classifications (stored in <code>dopingdata::wada_classes</code>):</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dopingdata</span><span class="fu">::</span><span class="va">wada_classes</span></span>
<span><span class="co">#&gt;                           Classification</span></span>
<span><span class="co">#&gt; 1                     S1 ANABOLIC AGENTS</span></span>
<span><span class="co">#&gt; 2     S2 PEP HORMONES/G FACTORS/MIMETICS</span></span>
<span><span class="co">#&gt; 3                     S3 BETA-2 AGONISTS</span></span>
<span><span class="co">#&gt; 4    S4 HORMONE AND METABOLIC MODULATORS</span></span>
<span><span class="co">#&gt; 5            S5 DIURETICS/MASKING AGENTS</span></span>
<span><span class="co">#&gt; 6                          S6 STIMULANTS</span></span>
<span><span class="co">#&gt; 7                           S7 NARCOTICS</span></span>
<span><span class="co">#&gt; 8                        S8 CANNABINOIDS</span></span>
<span><span class="co">#&gt; 9                     S9 GLUCOCORTICOIDS</span></span>
<span><span class="co">#&gt; 10              S0 UNAPPROVED SUBSTANCES</span></span>
<span><span class="co">#&gt; 11              M1 MANIPULATION OF BLOOD</span></span>
<span><span class="co">#&gt; 12 M2 CHEMICAL AND PHYSICAL MANIPULATION</span></span>
<span><span class="co">#&gt; 13               M3 GENE AND CELL DOPING</span></span>
<span><span class="co">#&gt; 14                      P1 BETA-BLOCKERS</span></span></code></pre></div>
<p><code>dopingdata</code> stores vectors with each substance group in
the WADA list (the <code>S1 ANABOLIC AGENTS</code> substances are
below):</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">dopingdata</span><span class="fu">::</span><span class="va">s1_substances</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "3α-hydroxy-5α-androst-1-en-17-one"              </span></span>
<span><span class="co">#&gt;  [2] "androgenic anabolic steroid"                    </span></span>
<span><span class="co">#&gt;  [3] "androgenic anabolic steroids"                   </span></span>
<span><span class="co">#&gt;  [4] "anabolic agent"                                 </span></span>
<span><span class="co">#&gt;  [5] "anabolic agents"                                </span></span>
<span><span class="co">#&gt;  [6] "anabolic steroid"                               </span></span>
<span><span class="co">#&gt;  [7] "anabolic steroids"                              </span></span>
<span><span class="co">#&gt;  [8] "androstenedione"                                </span></span>
<span><span class="co">#&gt;  [9] "metabolites of androstenedione"                 </span></span>
<span><span class="co">#&gt; [10] "1-androstenediol (5α-androst-1-ene-3β,17β-diol)"</span></span></code></pre></div>
<p>The substance group vectors are passed to make_regex() to create a
regular expressions (<code>s1_regex</code>), which we can use to match
the <code>substance_reason</code> column on (see the example using
<code>dopingdata::example_tidy_substances</code> dataset):</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s1_regex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_regex.html">make_regex</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">dopingdata</span><span class="fu">::</span><span class="va">s1_substances</span><span class="op">)</span></span>
<span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">example_tidy_substances</span><span class="op">$</span><span class="va">substance_reason</span>,</span>
<span>  pattern <span class="op">=</span> <span class="va">s1_regex</span>, match <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[10] │</span> <span style="color: #00BBBB;">&lt;androgenic anabolic steroid&gt;</span></span></span></code></pre></div>
<p>The output from <code><a href="../reference/classify_wada_substances.html">classify_wada_substances()</a></code> can be used
to answer questions like: <em>what <code>substance_group</code>’s appear
the most?</em></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/classify_wada_substances.html">classify_wada_substances</a></span><span class="op">(</span></span>
<span>  usada_data <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  subs_column <span class="op">=</span> <span class="st">"substance_reason"</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="unclassified-single-substances">
<strong>UNCLASSIFIED</strong> single substances<a class="anchor" aria-label="anchor" href="#unclassified-single-substances"></a>
</h3>
<p>The following <code>single</code> substances are marked as
<code>UNCLASSIFIED</code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>      <span class="va">substance_cat</span> <span class="op">==</span> <span class="st">"single"</span> <span class="op">&amp;</span> </span>
<span>      <span class="va">substance_group</span> <span class="op">==</span> <span class="st">"UNCLASSIFIED"</span> <span class="op">&amp;</span> </span>
<span>      <span class="va">substance_reason</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="va">substance_reason</span><span class="op">)</span></span>
<span><span class="co">#&gt;           athlete       substance_reason</span></span>
<span><span class="co">#&gt; 1 rodriguez, yair 3 whereabouts failures</span></span></code></pre></div>
<p>The final unclassified substance is actually a result from a
miss-classified sanction type (for <code>rodriguez, yair</code>).</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">athlete</span> <span class="op">==</span> <span class="st">"rodriguez, yair"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="va">substance_reason</span>, <span class="va">substance_group</span>, <span class="va">sanction_type</span><span class="op">)</span></span>
<span><span class="co">#&gt;           athlete       substance_reason substance_group sanction_type</span></span>
<span><span class="co">#&gt; 1 rodriguez, yair 3 whereabouts failures    UNCLASSIFIED      analytic</span></span></code></pre></div>
<p>For this particular athlete, 1) the <code>sanction_type</code> should
be <code>non-analytic</code>, and 2) the <code>substance_group</code>
should be missing (<code>NA_character_</code>)</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="va">tidy_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sanction_type <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">athlete</span> <span class="op">==</span> <span class="st">"rodriguez, yair"</span> <span class="op">~</span> <span class="st">"non-analytic"</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">sanction_type</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>substance_group <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">athlete</span> <span class="op">==</span> <span class="st">"rodriguez, yair"</span> <span class="op">~</span> <span class="cn">NA_character_</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">substance_group</span></span>
<span>  <span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">tidy_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">athlete</span> <span class="op">==</span> <span class="st">"rodriguez, yair"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="va">substance_reason</span>, <span class="va">substance_group</span>, <span class="va">sanction_type</span><span class="op">)</span></span>
<span><span class="co">#&gt;           athlete       substance_reason substance_group sanction_type</span></span>
<span><span class="co">#&gt; 1 rodriguez, yair 3 whereabouts failures            &lt;NA&gt;  non-analytic</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="unclassified-multiple-substances">
<strong>UNCLASSIFIED</strong> multiple substances<a class="anchor" aria-label="anchor" href="#unclassified-multiple-substances"></a>
</h3>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>      <span class="va">substance_cat</span> <span class="op">==</span> <span class="st">"multiple"</span> <span class="op">&amp;</span> </span>
<span>      <span class="va">substance_group</span> <span class="op">==</span> <span class="st">"UNCLASSIFIED"</span> <span class="op">&amp;</span> </span>
<span>      <span class="va">substance_reason</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">substance_reason</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                                       substance_reason</span></span>
<span><span class="co">#&gt; 1                                  2a-methyl-5a-androstan-3a-ol-17-one</span></span>
<span><span class="co">#&gt; 2                                                    d-methamphetamine</span></span>
<span><span class="co">#&gt; 3                                                           arimistane</span></span>
<span><span class="co">#&gt; 4                                                           torasemide</span></span>
<span><span class="co">#&gt; 5                                                           possession</span></span>
<span><span class="co">#&gt; 6                                                    use/attempted use</span></span>
<span><span class="co">#&gt; 7                                            evading sample collection</span></span>
<span><span class="co">#&gt; 8                                                                igf-1</span></span>
<span><span class="co">#&gt; 9                                   human chorionic gonadotropin (hcg)</span></span>
<span><span class="co">#&gt; 10                                                            aod-9064</span></span>
<span><span class="co">#&gt; 11                                                                s-23</span></span>
<span><span class="co">#&gt; 12                           intact human chorionic gonadtrophin (hcg)</span></span>
<span><span class="co">#&gt; 13 thiazide metabolite 4-amino-6-chloro-1,3-benzenedisulfonamide (acb)</span></span>
<span><span class="co">#&gt; 14                                                      methylecgonine</span></span>
<span><span class="co">#&gt; 15                                                     propylhexadrine</span></span>
<span><span class="co">#&gt; 16                                                 androstatrienedione</span></span>
<span><span class="co">#&gt; 17                                             androst-(2,3)-en-17-one</span></span>
<span><span class="co">#&gt; 18                                                     methylclostebol</span></span>
<span><span class="co">#&gt; 19                                                           promagnon</span></span>
<span><span class="co">#&gt; 20                                                4-hydroxytriamterene</span></span>
<span><span class="co">#&gt; 21                                      non-anatlyical: administration</span></span>
<span><span class="co">#&gt; 22                                                         trafficking</span></span>
<span><span class="co">#&gt; 23                                 human chorionic gonadotrophin (hcg)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="re-classifying-substances">Re-classifying substances<a class="anchor" aria-label="anchor" href="#re-classifying-substances"></a>
</h2>
<p>Any substances that are not classified from the existing WADA list
can be added with <code><a href="../reference/reclass_substance.html">reclass_substance()</a></code> (these substances can
also added to their relative vector and regular expression in
<code>data-raw/</code>)</p>
<div class="section level3">
<h3 id="reclass_substance">
<strong>reclass_substance()</strong><a class="anchor" aria-label="anchor" href="#reclass_substance"></a>
</h3>
<p><code><a href="../reference/reclass_substance.html">reclass_substance()</a></code> takes a <code>df</code>,
<code>substance</code>, and <code>value</code>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 2a-methyl-5a-androstan-3a-ol-17-one ----</span></span>
<span><span class="co"># https://www.wada-ama.org/en/prohibited-list?page=0&amp;q=arimistane&amp;all=1#search-anchor</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"^2a-methyl-5a-androstan-3a-ol-17-one$"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S1 ANABOLIC AGENTS"</span><span class="op">)</span></span>
<span><span class="co"># d-methamphetamine ----</span></span>
<span><span class="co"># https://www.usada.org/sanction/hillary-tran-accepts-doping-sanction/</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"d-methamphetamine"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S6 STIMULANTS"</span><span class="op">)</span></span>
<span><span class="co"># arimistane ----</span></span>
<span><span class="co"># https://www.wada-ama.org/en/prohibited-list?page=0&amp;q=arimistane&amp;all=1#search-anchor</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"arimistane"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S4 HORMONE AND METABOLIC MODULATORS"</span><span class="op">)</span></span>
<span><span class="co"># torasemide ----</span></span>
<span><span class="co"># https://www.wada-ama.org/en/prohibited-list?page=0&amp;q=torasemide&amp;all=1#search-anchor</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"torasemide"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S5 DIURETICS/MASKING AGENTS"</span><span class="op">)</span></span>
<span><span class="co"># igf-1 ----</span></span>
<span><span class="co"># https://www.wada-ama.org/en/prohibited-list?page=0&amp;q=igf-1&amp;all=1#search-anchor</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"igf-1"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S2 PEP HORMONES/G FACTORS/MIMETICS"</span><span class="op">)</span></span>
<span><span class="co"># human chorionic gonadotropin (hcg)  ----</span></span>
<span><span class="co"># https://www.usada.org/athletes/antidoping101/athlete-guide-anti-doping/</span></span>
<span><span class="co"># https://www.usada.org/spirit-of-sport/education/wellness-and-anti-aging-clinics/</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"^human chorionic gonadotropin \\(hcg\\)$"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S2 PEP HORMONES/G FACTORS/MIMETICS"</span><span class="op">)</span></span>
<span><span class="co"># intact human chorionic gonadtrophin (hcg)  ----</span></span>
<span><span class="co"># https://www.usada.org/athletes/antidoping101/athlete-guide-anti-doping/</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"^intact human chorionic gonadtrophin \\(hcg\\)$"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S2 PEP HORMONES/G FACTORS/MIMETICS"</span><span class="op">)</span></span>
<span><span class="co"># human chorionic gonadotrophin (hcg)  ----</span></span>
<span><span class="co"># https://www.usada.org/athletes/antidoping101/athlete-guide-anti-doping/</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"human chorionic gonadotrophin \\(hcg\\)"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S2 PEP HORMONES/G FACTORS/MIMETICS"</span><span class="op">)</span></span>
<span><span class="co"># aod-9064  ----</span></span>
<span><span class="co"># https://www.wada-ama.org/en/prohibited-list?page=0&amp;q=aod-9064&amp;all=1#search-anchor</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"aod-9064"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S2 PEP HORMONES/G FACTORS/MIMETICS"</span><span class="op">)</span></span>
<span><span class="co"># s-23  ----</span></span>
<span><span class="co"># https://www.wada-ama.org/en/prohibited-list?page=0&amp;q=s-23&amp;all=1#search-anchor</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"s-23"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S1 ANABOLIC AGENTS"</span><span class="op">)</span></span>
<span><span class="co"># methenolone  ----</span></span>
<span><span class="co"># https://www.wada-ama.org/en/prohibited-list?page=0&amp;q=methenolone&amp;all=1#search-anchor</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"methenolone"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S1 ANABOLIC AGENTS"</span><span class="op">)</span></span>
<span><span class="co"># thiazide metabolite 4-amino-6-chloro-1,3-benzenedisulfonamide (acb)  ----</span></span>
<span><span class="co"># https://www.wada-ama.org/en/prohibited-list?page=0&amp;q=thiazide&amp;all=1#search-anchor</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"^thiazide metabolite 4-amino-6-chloro-1,3-benzenedisulfonamide \\(acb\\)$"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S5 DIURETICS/MASKING AGENTS"</span><span class="op">)</span></span>
<span><span class="co"># methylecgonine  ----</span></span>
<span><span class="co"># https://www.usada.org/sanction/mike-alexandrov-accepts-doping-sanction/</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"methylecgonine"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S6 STIMULANTS"</span><span class="op">)</span></span>
<span><span class="co"># propylhexadrine  ----</span></span>
<span><span class="co"># https://www.wada-ama.org/en/prohibited-list?page=0&amp;q=propylhexadrine&amp;all=1#search-anchor</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"propylhexadrine"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S6 STIMULANTS"</span><span class="op">)</span></span>
<span><span class="co"># androstatrienedione  ----</span></span>
<span><span class="co"># https://www.wada-ama.org/en/prohibited-list?page=0&amp;q=androstatrienedione&amp;all=1#search-anchor</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"androstatrienedione"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S4 HORMONE AND METABOLIC MODULATORS"</span><span class="op">)</span></span>
<span><span class="co"># androst-(2,3)-en-17-one  ----</span></span>
<span><span class="co"># https://www.wada-ama.org/en/prohibited-list?page=0&amp;q=androst&amp;all=1#search-anchor</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"androst-\\(2,3\\)-en-17-one"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S1 ANABOLIC AGENTS"</span><span class="op">)</span></span>
<span><span class="co"># methylclostebol ----</span></span>
<span><span class="co"># https://www.wada-ama.org/en/prohibited-list?page=0&amp;q=methylclostebol&amp;all=1#search-anchor</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"methylclostebol"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S1 ANABOLIC AGENTS"</span><span class="op">)</span></span>
<span><span class="co"># promagnon  ----</span></span>
<span><span class="co"># https://www.usada.org/sanction/u-s-judo-athlete-ohara-accepts-sanction-rule-violation/</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"promagnon"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S1 ANABOLIC AGENTS"</span><span class="op">)</span></span>
<span><span class="co"># 4-hydroxytriamterene  ----</span></span>
<span><span class="co"># 4-Hydroxy Triamterene is a diuretic agent and metabolite of Triamterene</span></span>
<span><span class="co"># https://www.scbt.com/p/4-hydroxy-triamterene-1226-52-4</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"4-hydroxytriamterene"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S5 DIURETICS/MASKING AGENTS"</span><span class="op">)</span></span></code></pre></div>
<p>After reclassifying the substances above, remaining
<code>UNCLASSIFIED</code>/<code>multiple</code> sanctions are all
non-analytic:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>      <span class="va">substance_cat</span> <span class="op">==</span> <span class="st">"multiple"</span> <span class="op">&amp;</span> </span>
<span>      <span class="va">substance_group</span> <span class="op">==</span> <span class="st">"UNCLASSIFIED"</span> <span class="op">&amp;</span> </span>
<span>      <span class="va">substance_reason</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">substance_reason</span><span class="op">)</span> </span>
<span><span class="co">#&gt;                 substance_reason</span></span>
<span><span class="co">#&gt; 1                     possession</span></span>
<span><span class="co">#&gt; 2              use/attempted use</span></span>
<span><span class="co">#&gt; 3      evading sample collection</span></span>
<span><span class="co">#&gt; 4 non-anatlyical: administration</span></span>
<span><span class="co">#&gt; 5                    trafficking</span></span></code></pre></div>
<p>Changing the <code>sanction_type</code> classification to
non-analytic requires missing (<code>NA_character_</code>) values for
<code>substance_group</code>:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Change sanction_type to non-analytic</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="va">tidy_substances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    sanction_type <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">substance_group</span> <span class="op">==</span> <span class="st">"UNCLASSIFIED"</span> <span class="op">&amp;</span> <span class="va">substance_reason</span> <span class="op">==</span> <span class="st">"possession"</span> <span class="op">~</span> <span class="st">"non-analytic"</span>,</span>
<span>      <span class="va">substance_group</span> <span class="op">==</span> <span class="st">"UNCLASSIFIED"</span> <span class="op">&amp;</span> <span class="va">substance_reason</span> <span class="op">==</span> <span class="st">"use/attempted use"</span> <span class="op">~</span> <span class="st">"non-analytic"</span>,</span>
<span>      <span class="va">substance_group</span> <span class="op">==</span> <span class="st">"UNCLASSIFIED"</span> <span class="op">&amp;</span> <span class="va">substance_reason</span> <span class="op">==</span> <span class="st">"evading sample collection"</span> <span class="op">~</span> <span class="st">"non-analytic"</span>,</span>
<span>      <span class="va">substance_group</span> <span class="op">==</span> <span class="st">"UNCLASSIFIED"</span> <span class="op">&amp;</span> <span class="va">substance_reason</span> <span class="op">==</span> <span class="st">"non-anatlyical: administration"</span> <span class="op">~</span> <span class="st">"non-analytic"</span>,</span>
<span>      <span class="va">substance_group</span> <span class="op">==</span> <span class="st">"UNCLASSIFIED"</span> <span class="op">&amp;</span> <span class="va">substance_reason</span> <span class="op">==</span> <span class="st">"trafficking"</span> <span class="op">~</span> <span class="st">"non-analytic"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">sanction_type</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> </span>
<span><span class="co"># Change substance_group to NA_character_</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="va">tidy_substances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    substance_group <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">sanction_type</span> <span class="op">==</span> <span class="st">"non-analytic"</span> <span class="op">~</span> <span class="cn">NA_character_</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">substance_group</span><span class="op">)</span></span>
<span>    <span class="op">)</span> </span></code></pre></div>
<p>Remove the empty <code>substance_reason</code> values:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tidy_substances</span>, <span class="va">substance_reason</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="tidy-substances">Tidy substances<a class="anchor" aria-label="anchor" href="#tidy-substances"></a>
</h2>
<p>Now all the substances have been properly classified as <a href="https://www.usada.org/spirit-of-sport/education/alphabet-soup-results-management/#:~:text" class="external-link">Adverse
Analytical Findings</a>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">sanction_type</span>, <span class="va">substance_group</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">sanction_type</span>, values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 14 × 3</span></span></span>
<span><span class="co">#&gt;    substance_group                       analytic `non-analytic`</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> M1 MANIPULATION OF BLOOD                     3             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> M2 CHEMICAL AND PHYSICAL MANIPULATION        1             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> P1 BETA-BLOCKERS                             2             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> S0 UNAPPROVED SUBSTANCES                     1             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> S1 ANABOLIC AGENTS                         327             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> S2 PEP HORMONES/G FACTORS/MIMETICS          42             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> S3 BETA-2 AGONISTS                          12             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> S4 HORMONE AND METABOLIC MODULATORS         80             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> S5 DIURETICS/MASKING AGENTS                 67             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> S6 STIMULANTS                               95             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> S7 NARCOTICS                                 3             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> S8 CANNABINOIDS                             41             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> S9 GLUCOCORTICOIDS                           8             <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> <span style="color: #BB0000;">NA</span>                                          <span style="color: #BB0000;">NA</span>              6</span></span></code></pre></div>
<p>And the <code>non-analytic</code> sanctions are truly <a href="https://www.usada.org/spirit-of-sport/education/non-analytical-anti-doping-rule-violations/" class="external-link">Non-Analytical
Anti-doping Rule Violations</a>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tidy_substances</span>, <span class="va">sanction_type</span> <span class="op">==</span> <span class="st">"non-analytic"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="va">substance_cat</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">substance_cat</span>, values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   substance_reason               single multiple</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 3 whereabouts failures              1       <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> evading sample collection          <span style="color: #BB0000;">NA</span>        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> non-anatlyical: administration     <span style="color: #BB0000;">NA</span>        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> possession                         <span style="color: #BB0000;">NA</span>        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> trafficking                        <span style="color: #BB0000;">NA</span>        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> use/attempted use                  <span style="color: #BB0000;">NA</span>        1</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Martin Frigaard.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
