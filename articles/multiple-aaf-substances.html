<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="dopingdata">
<title>Multiple AAF substances • dopingdata</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Ubuntu-0.4.4/font.css" rel="stylesheet">
<link href="../deps/Ubuntu_Mono-0.4.4/font.css" rel="stylesheet">
<link href="../deps/Fira_Sans_Condensed-0.4.4/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Multiple AAF substances">
<meta property="og:description" content="dopingdata">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">dopingdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Harvesting Data</h6>
    <a class="dropdown-item" href="../articles/scraping-usada-sanctions.html">USADA Sanctions</a>
    <a class="dropdown-item" href="../articles/scraping-usada-proh-assoc.html">USADA Prohibited Associations</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Dates</h6>
    <a class="dropdown-item" href="../articles/sanction-dates.html">Sanction Dates</a>
    <h6 class="dropdown-header" data-toc-skip>Sports</h6>
    <a class="dropdown-item" href="../articles/sanction-sports.html">Sanction Sports</a>
    <h6 class="dropdown-header" data-toc-skip>Adverse Analytical Findings</h6>
    <a class="dropdown-item" href="../articles/single-aaf-substances.html">Single substance aaf sanctions</a>
    <a class="dropdown-item" href="../articles/multiple-aaf-substances.html">Multiple substance aaf sanctions</a>
    <h6 class="dropdown-header" data-toc-skip>Non-Analytic Rule Violations</h6>
    <a class="dropdown-item" href="../articles/single-adrv-sanctions.html">Single ADRV sanctions</a>
    <h6 class="dropdown-header" data-toc-skip>Multiple ADRV sanctions</h6>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Multiple AAF substances</h1>
            
      
      
      <div class="d-none name"><code>multiple-aaf-substances.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjfrigaard.github.io/dopingdata/">dopingdata</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org/" class="external-link">forcats</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor" class="external-link">janitor</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://dirk.eddelbuettel.com/code/anytime.html" class="external-link">anytime</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>This vignette covers the classification of adverse analytic findings
(AAF) for multiple banned substances in the <a href="https://www.usada.org/testing/results/sanctions/" class="external-link">USADA sanction
table</a>.</p>
</div>
<div class="section level2">
<h2 id="data-versioning">Data versioning<a class="anchor" aria-label="anchor" href="#data-versioning"></a>
</h2>
<p><code>dopingdata</code> uses data from tables that get updated
regularly. To keep track of the versions, I’ve separated the raw
(<code>_raw</code>) and processed (<code>_pro</code>) data in the
<code>inst/</code> folder:</p>
<ul>
<li>
<p>Raw data:</p>
<pre><code><span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">../inst/extdata/raw/</span></span></span>
<span><span class="co">#&gt; ├── 2023-01-21_usada_prohib_assoc_raw.csv</span></span>
<span><span class="co">#&gt; ├── 2023-01-21_usada_sanctions_raw.csv</span></span>
<span><span class="co">#&gt; ├── 2023-01-22_usada_prohib_assoc_raw.csv</span></span>
<span><span class="co">#&gt; ├── 2023-01-22_usada_sanctions_raw.csv</span></span>
<span><span class="co">#&gt; ├── 2023-01-23_usada_prohib_assoc_raw.csv</span></span>
<span><span class="co">#&gt; └── 2023-01-23_usada_sanctions_raw.csv</span></span></code></pre>
</li>
<li>
<p>Processed data</p>
<pre><code><span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">../inst/extdata</span></span></span>
<span><span class="co">#&gt; ├── <span style="color: #0000BB; font-weight: bold;">raw</span></span></span>
<span><span class="co">#&gt; ├── substance_types.csv</span></span>
<span><span class="co">#&gt; ├── tidy_multp_aaf_subs.csv</span></span>
<span><span class="co">#&gt; ├── tidy_single_aafs.csv</span></span>
<span><span class="co">#&gt; ├── tidy_sports.csv</span></span>
<span><span class="co">#&gt; ├── usada_dates.csv</span></span>
<span><span class="co">#&gt; ├── usada_prohib_assoc_pro.csv</span></span>
<span><span class="co">#&gt; ├── usada_sanction_types.csv</span></span>
<span><span class="co">#&gt; ├── usada_sanctions_pro.csv</span></span>
<span><span class="co">#&gt; ├── usada_substance_types.csv</span></span>
<span><span class="co">#&gt; └── <span style="color: #0000BB; font-weight: bold;">wada</span></span></span></code></pre>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="outline">Outline<a class="anchor" aria-label="anchor" href="#outline"></a>
</h2>
<p>This vignette assumes the following:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Harvest the data:</strong> A copy of the <a href="https://www.usada.org/testing/results/sanctions/" class="external-link">USADA sanctions
table</a> has been scraped and lives in the
<code>inst/extdata/raw/</code> folder</li>
</ol>
<ul>
<li>
<p>See <a href="https://mjfrigaard.github.io/dopingdata/articles/scraping-usada-sanctions.html"><code>vignettes/scraping-usada.Rmd</code></a>
for more information</p>
<pre><code><span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">../inst/extdata/raw/</span></span></span>
<span><span class="co">#&gt; ├── 2023-01-21_usada_sanctions_raw.csv</span></span>
<span><span class="co">#&gt; ├── 2023-01-22_usada_sanctions_raw.csv</span></span>
<span><span class="co">#&gt; └── 2023-01-23_usada_sanctions_raw.csv</span></span></code></pre>
</li>
<li>
<p>These data have had all the column names formatted with
<code><a href="https://rdrr.io/pkg/janitor/man/clean_names.html" class="external-link">janitor::clean_names()</a></code>, and all the text has been converted
to lowercase</p>
<pre><code><span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">../inst/extdata/</span></span></span>
<span><span class="co">#&gt; └── usada_sanctions_pro.csv</span></span></code></pre>
</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>
<strong>Fix the dates:</strong> The dates in this table have been
formatted and wrangled</li>
</ol>
<ul>
<li>
<p>See <a href="https://mjfrigaard.github.io/dopingdata/articles/sanction-dates.html"><code>vignettes/sanction-dates.Rmd</code></a>
more information</p>
<pre><code><span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">../inst/extdata/</span></span></span>
<span><span class="co">#&gt; └── usada_dates.csv</span></span></code></pre>
</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>
<strong>Tidy the sports:</strong> The <code>sport</code> column has
been ‘tidied’ and athletes/support personnel listed with more than one
sport have been repeated in the data</li>
</ol>
<ul>
<li>
<p>See <a href="https://mjfrigaard.github.io/dopingdata/articles/sanction-sports.html"><code>vignettes/sanction-sports.Rmd</code></a>
for more information</p>
<pre><code><span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">../inst/extdata/</span></span></span>
<span><span class="co">#&gt; └── tidy_sports.csv</span></span></code></pre>
</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>
<strong>Tidy the AAF (single substances):</strong> The
<code>sanction_reason</code> column in <code>tidy_sports.csv</code> was
used to classify the analytic (i.e, adverse analytic finding) sanctions
into <code>sanction_groups</code> based on the WADA banned list of
substances.</li>
</ol>
<ul>
<li>
<p>See <a href="https://mjfrigaard.github.io/dopingdata/articles/single-aaf-substances.html"><code>vignettes/single-aaf-substances.Rmd</code></a>
for more information</p>
<pre><code><span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">../inst/extdata/</span></span></span>
<span><span class="co">#&gt; └── tidy_single_aafs.csv</span></span></code></pre>
</li>
</ul>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>This vignette picks up where <a href="https://mjfrigaard.github.io/dopingdata/articles/single-aaf-substances.html"><code>vignettes/single-aaf-substances.Rmd</code></a>
left off (and imports the previous <code>tidy_single_aafs.csv</code>
dataset)</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_recent</span>(<span class="st">"../inst/extdata"</span>, <span class="st">"csv"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>✔ The last modified date <span class="cf">in</span> <span class="st">'../inst/extdata'</span><span class="sc">:</span> <span class="dv">2023-01-23</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>       dstmp </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="st">"2023-01-23"</span> </span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">substance_types</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span></span>
<span>  file <span class="op">=</span> <span class="st">'../inst/extdata/usada_substance_types.csv'</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">689</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">10</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">chr</span>  (5): athlete, sport, substance_reason, sanction_terms, sanction_type</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">lgl</span>  (4): support_personnel, multiple_sports, paralympic, multiple_sr</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">date</span> (1): sanction_date</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">substance_types</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 689</span></span>
<span><span class="co">#&gt; Columns: 10</span></span>
<span><span class="co">#&gt; $ athlete           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "montañez barroso, elias", "ruiz-gutierrez, noslen",…</span></span>
<span><span class="co">#&gt; $ sport             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "cycling", "cycling", "track &amp; field", "cycling", "w…</span></span>
<span><span class="co">#&gt; $ substance_reason  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "non-analytical: refusal to submit to sample collect…</span></span>
<span><span class="co">#&gt; $ sanction_terms    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "4-year suspension; loss of results", "4-year suspen…</span></span>
<span><span class="co">#&gt; $ sanction_date     <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2023-01-10, 2023-01-04, 2022-12-08, 2022-12-05, 202…</span></span>
<span><span class="co">#&gt; $ support_personnel <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FAL…</span></span>
<span><span class="co">#&gt; $ multiple_sports   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FAL…</span></span>
<span><span class="co">#&gt; $ paralympic        <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FAL…</span></span>
<span><span class="co">#&gt; $ sanction_type     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "non-analytical", "analytical", "analytical", "analy…</span></span>
<span><span class="co">#&gt; $ multiple_sr       <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> FALSE, TRUE, TRUE, FALSE, TRUE, FALSE, TRUE, FALSE, …</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="multiple-substances-multiple_sr">Multiple substances (<code>multiple_sr</code>)<a class="anchor" aria-label="anchor" href="#multiple-substances-multiple_sr"></a>
</h3>
<p>The substance_types data has the <code>multiple_sr</code> column for
identifying if an sanction included more than one substance:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">substance_types</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/tabyl.html" class="external-link">tabyl</a></span><span class="op">(</span><span class="va">multiple_sr</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/adorn_pct_formatting.html" class="external-link">adorn_pct_formatting</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt;  multiple_sr   n percent</span></span>
<span><span class="co">#&gt;        FALSE 508     74%</span></span>
<span><span class="co">#&gt;         TRUE 181     26%</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="aaf-vs--adrv-sanctions">AAF vs. ADRV Sanctions<a class="anchor" aria-label="anchor" href="#aaf-vs--adrv-sanctions"></a>
</h2>
<p>The sanctions are divided into two categories:</p>
<ul>
<li><p><code>analytic</code>: <a href="https://www.usada.org/spirit-of-sport/education/alphabet-soup-results-management/#:~:text" class="external-link">Adverse
Analytical Finding</a>, AAF; <em>An AAF is a report from a
WADA-accredited laboratory that identifies the presence of a prohibited
substance and/or its metabolites or markers in a sample.</em></p></li>
<li><p><code>non-analytic</code>: <a href="https://www.usada.org/spirit-of-sport/education/non-analytical-anti-doping-rule-violations/" class="external-link">Non-Analytical
Anti-doping Rule Violation</a> ADRV; <em>a non-analytical anti-doping
rule violation does not stem from a positive urine or blood sample, but
instead originates from, and is substantiated by, other evidence of
doping or violations by an athlete or athlete support
personnel.</em>.</p></li>
</ul>
<p>The variable identifying the AAF vs. ADRV sanctions is
<code>sanction_type</code>, and I breakdown <code>multiple_sr</code> by
<code>sanction_type</code> below:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">substance_types</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/tabyl.html" class="external-link">tabyl</a></span><span class="op">(</span><span class="va">multiple_sr</span>, <span class="va">sanction_type</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/adorn_percentages.html" class="external-link">adorn_percentages</a></span><span class="op">(</span>denominator <span class="op">=</span> <span class="st">"col"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/janitor/man/adorn_pct_formatting.html" class="external-link">adorn_pct_formatting</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> </span>
<span><span class="co">#&gt;  multiple_sr analytical non-analytical</span></span>
<span><span class="co">#&gt;        FALSE        78%            62%</span></span>
<span><span class="co">#&gt;         TRUE        22%            38%</span></span></code></pre></div>
<div class="section level3">
<h3 id="multiple-analytic-substances">Multiple analytic substances<a class="anchor" aria-label="anchor" href="#multiple-analytic-substances"></a>
</h3>
<p>Filter <code>substance_types</code> into multiple
<code>analytic</code> substances (<code>mult_aaf_subs</code>)</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mult_aaf_subs</span> <span class="op">&lt;-</span> <span class="va">substance_types</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sanction_type</span> <span class="op">==</span> <span class="st">"analytical"</span> <span class="op">&amp;</span> <span class="va">multiple_sr</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mult_aaf_subs</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">multiple_sr</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;   multiple_sr     n</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> TRUE          115</span></span></code></pre></div>
<p>Below is a ‘count of counts’, which tells me most of the multiple
substance combinations occur only once.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mult_aaf_subs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">substance_reason</span>, sort <span class="op">=</span> <span class="cn">TRUE</span>, name <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">Count</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">#&gt;   Count     n</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1    89</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2     8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3     2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4     1</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="tidying-multiple-substances">Tidying multiple substances<a class="anchor" aria-label="anchor" href="#tidying-multiple-substances"></a>
</h2>
<p>We’re going to separate the multiple <a href="https://www.wada-ama.org/en/prohibited-list?q" class="external-link">WADA banned
substances</a> into a ‘tidy’ form (one substance per athlete per row),
which means the athletes with multiple substances will appear in this
dataset more than once.</p>
<p>To tidy the substances with multiple steps, I’ll define a regular
expression that identifies the separators between each substance (and
make sure we’re not splitting up the individual substances). The regular
expression should (ideally) cover a range of word boundaries, tabs,
semicolons, and spaces.</p>
<div class="section level3">
<h3 id="step-1-white-space">Step 1: white space<a class="anchor" aria-label="anchor" href="#step-1-white-space"></a>
</h3>
<p>I’ll start by trimming the white space from
<code>substance_reason</code></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">mult_aaf_subs</span>,</span>
<span>  substance_reason <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_trim</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="st">"both"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="va">substance_reason</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 115 × 2</span></span></span>
<span><span class="co">#&gt;    athlete                     substance_reason                                 </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ruiz-gutierrez, noslen      <span style="color: #949494;">"</span>dexamethasone; phentermine; 19-noretiocholanolo…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> roberts, gil                <span style="color: #949494;">"</span>andarine; ostarine<span style="color: #949494;">"</span>                             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> rodriguez ocasio, christian <span style="color: #949494;">"</span>heptaminol; octodrine<span style="color: #949494;">"</span>                          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> mead, hassan                <span style="color: #949494;">"</span>ostarine; lgd-4033<span style="color: #949494;">"</span>                             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> bringas, joshua             <span style="color: #949494;">"</span>heptaminol; ibutamoren, oxilofrine; gw1516<span style="color: #949494;">"</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> allen, sabina               <span style="color: #949494;">"</span>phentermine; lgd-4033<span style="color: #949494;">"</span>                          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> wilson, ian                 <span style="color: #949494;">"</span>stanozolol; drostanolone<span style="color: #949494;">"</span>                       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> prazeres, michel            <span style="color: #949494;">"</span>clomiphene; oxandrolone; androgenic anabolic st…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> adel, jordan                <span style="color: #949494;">"</span>ostarine; lgd-4033; ibutamoren<span style="color: #949494;">"</span>                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> tran, hillary               <span style="color: #949494;">"</span>cocaine; d-methamphetamine<span style="color: #949494;">"</span>                     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> lacoste, jacob              <span style="color: #949494;">"</span>clomiphene; 19-norandrosterone (19-na)<span style="color: #949494;">"</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> storie, logan               <span style="color: #949494;">"</span>ostarine; lgd‐4033; gw1516<span style="color: #949494;">"</span>                     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> prince, david               <span style="color: #949494;">"</span>ostarine; lgd‐4033<span style="color: #949494;">"</span>                             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> gallardo, luis              <span style="color: #949494;">"</span>oxymetholone; dehydrochloromethyltestosterone (…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> pessoa nunes, raphael       <span style="color: #949494;">"</span>hydrochlorothiazide (hctz); possession and use/…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> aivazian, vahe              <span style="color: #949494;">"</span>testosterone;\tnandrolone; \tdehydroepiandroste…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> pennington, raquel          <span style="color: #949494;">"</span>7-keto-dhea; aod-9064<span style="color: #949494;">"</span>                          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> lewis-parry, chi            <span style="color: #949494;">"</span>drostanolone; stanozolol; dehydrochloromethylte…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> gonzalez villa, jorge       <span style="color: #949494;">"</span>stanozolol; drostanolone<span style="color: #949494;">"</span>                       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> ostovich-berdon, rachael    <span style="color: #949494;">"</span>ostarine; gw1516<span style="color: #949494;">"</span>                               </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">21</span> romero noboa, isidro        <span style="color: #949494;">"</span>androgenic anabolic steroid; cannabinoids; anas…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">22</span> hurst, rowdy                <span style="color: #949494;">"</span>androgenic anabolic steroid; clomiphene; modafi…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">23</span> gleaves, john               <span style="color: #949494;">"</span>oxandrolone; clomiphene<span style="color: #949494;">"</span>                        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">24</span> aguero, manuel              <span style="color: #949494;">"</span>amphetamine; modafinil<span style="color: #949494;">"</span>                         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">25</span> saint preux, ovince         <span style="color: #949494;">"</span>ostarine; lgd-4033; gw1516<span style="color: #949494;">"</span>                     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 90 more rows</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-2-commas-in-chemical-compounds">Step 2: commas in chemical compounds<a class="anchor" aria-label="anchor" href="#step-2-commas-in-chemical-compounds"></a>
</h3>
<p>I need to be careful using commas, because some of the chemical
compounds use commas in their names:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view_all</a></span><span class="op">(</span></span>
<span>  <span class="va">mult_aaf_subs</span><span class="op">$</span><span class="va">substance_reason</span>,</span>
<span>  pattern <span class="op">=</span> <span class="st">"\\d+,\\d+"</span>,</span>
<span>  match <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: `str_view()` was deprecated in stringr 1.5.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `str_view_all()` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[36] │</span> heptaminol, <span style="color: #00BBBB;">&lt;1,4&gt;</span>‐dimethylpentylamine (<span style="color: #00BBBB;">&lt;1,4&gt;</span>‐dmpa), octodrine, ostarine, di‐hydroxy‐lgd‐4033</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[42] │</span> furosemide; hydrochlorothiazide; chlorothiazide; thiazide metabolite 4-amino-6-chloro-<span style="color: #00BBBB;">&lt;1,3&gt;</span>-benzenedisulfonamide (acb)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[62] │</span> higenamine, <span style="color: #00BBBB;">&lt;1,4&gt;</span>-dimethylpentylamine</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[89] │</span> methenolone, androst-(<span style="color: #00BBBB;">&lt;2,3&gt;</span>)-en-17-one, and ghrp-6</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-3-plurals">Step 3: plurals<a class="anchor" aria-label="anchor" href="#step-3-plurals"></a>
</h3>
<p>The pattern above seems to identify most of the separators, but it’s
separating on <code>&lt;substance&gt;</code>
<strong><code>and</code></strong> <code>its metabolite</code>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># metabolite/metabolites</span></span>
<span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view_all</a></span><span class="op">(</span></span>
<span>  <span class="va">mult_aaf_subs</span><span class="op">$</span><span class="va">substance_reason</span>,</span>
<span>  <span class="st">"and its metabolites|and its metabolite|its metabolites|its metabolite"</span>,</span>
<span>  match <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [57] │</span> clomiphene <span style="color: #00BBBB;">&lt;and its metabolite&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [58] │</span> clomiphene <span style="color: #00BBBB;">&lt;and its metabolite&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [64] │</span> clomiphene <span style="color: #00BBBB;">&lt;and its metabolite&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [68] │</span> 1-androstenedione <span style="color: #00BBBB;">&lt;and its metabolite&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [69] │</span> oxandrolone <span style="color: #00BBBB;">&lt;and its metabolite&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [70] │</span> stanozolol <span style="color: #00BBBB;">&lt;and its metabolites&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [73] │</span> 19-norandrosterone (19-na), drostanolone <span style="color: #00BBBB;">&lt;and its metabolites&gt;</span>, and epitrenbolone</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [80] │</span> 19-norandrosterone (19-na), 19-noretiocholanolone, and drostanolone <span style="color: #00BBBB;">&lt;and its metabolites&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [90] │</span> clenbuterol, and oxandrolone <span style="color: #00BBBB;">&lt;and its metabolite&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [92] │</span> methylphenidate <span style="color: #00BBBB;">&lt;and its metabolite&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [94] │</span> methylphenidate <span style="color: #00BBBB;">&lt;and its metabolite&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[110] │</span> tamoxifen <span style="color: #00BBBB;">&lt;and its metabolite&gt;</span>, anastrozole, letrozole, human chorionic gonadotrophin (hcg), and clomiphene</span></span></code></pre></div>
<p>I want to include the information on
<code>metabolite</code>/<code>metabolites</code>, so I’ll replace this
with, <code>(metabolite)</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">mult_aaf_subs</span>,</span>
<span>  substance_reason <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span></span>
<span>    <span class="va">substance_reason</span>,</span>
<span>    <span class="st">"and its metabolite|and its metabolites"</span>,</span>
<span>    <span class="st">"(metabolite)"</span><span class="op">)</span>,</span>
<span>  substance_reason <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span></span>
<span>    <span class="va">substance_reason</span>,</span>
<span>    <span class="st">"its metabolite"</span>,</span>
<span>    <span class="st">"(metabolite)"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">substance_reason</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/as_vector.html" class="external-link">as_vector</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view_all</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"metabolite"</span>, match <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [42] │</span> furosemide; hydrochlorothiazide; chlorothiazide; thiazide <span style="color: #00BBBB;">&lt;metabolite&gt;</span> 4-amino-6-chloro-1,3-benzenedisulfonamide (acb)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [57] │</span> clomiphene (<span style="color: #00BBBB;">&lt;metabolite&gt;</span>)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [58] │</span> clomiphene (<span style="color: #00BBBB;">&lt;metabolite&gt;</span>)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [59] │</span> clomiphene and methylphenidate <span style="color: #00BBBB;">&lt;metabolite&gt;</span> ritalinic acid</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [61] │</span> hydrochlorothiazide, chlorothiazide, ostarine and stanozolol <span style="color: #00BBBB;">&lt;metabolite&gt;</span>s</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [64] │</span> clomiphene (<span style="color: #00BBBB;">&lt;metabolite&gt;</span>)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [68] │</span> 1-androstenedione (<span style="color: #00BBBB;">&lt;metabolite&gt;</span>)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [69] │</span> oxandrolone (<span style="color: #00BBBB;">&lt;metabolite&gt;</span>)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [70] │</span> stanozolol (<span style="color: #00BBBB;">&lt;metabolite&gt;</span>)s</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [71] │</span> clenbuterol, ostarine, and a tamoxifen <span style="color: #00BBBB;">&lt;metabolite&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [73] │</span> 19-norandrosterone (19-na), drostanolone (<span style="color: #00BBBB;">&lt;metabolite&gt;</span>)s, and epitrenbolone</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [80] │</span> 19-norandrosterone (19-na), 19-noretiocholanolone, and drostanolone (<span style="color: #00BBBB;">&lt;metabolite&gt;</span>)s</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [90] │</span> clenbuterol, and oxandrolone (<span style="color: #00BBBB;">&lt;metabolite&gt;</span>)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [92] │</span> methylphenidate (<span style="color: #00BBBB;">&lt;metabolite&gt;</span>)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [94] │</span> methylphenidate (<span style="color: #00BBBB;">&lt;metabolite&gt;</span>)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[110] │</span> tamoxifen (<span style="color: #00BBBB;">&lt;metabolite&gt;</span>), anastrozole, letrozole, human chorionic gonadotrophin (hcg), and clomiphene</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-4-conjunctions">Step 4: conjunctions<a class="anchor" aria-label="anchor" href="#step-4-conjunctions"></a>
</h3>
<p>I want to create a regular expression that matches on the
conjunctions (<code>and</code> and <code>,</code>) connecting the
multiple substances. I’ll store the pattern in
<code>multp_subs_regex</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># I'm showing only a sample of 20 to reduce printing</span></span>
<span><span class="va">multp_subs_regex</span> <span class="op">&lt;-</span> <span class="st">"\\b and \\b|\\b, and \\b|, and |\\band\\b|\\b, \\b|, | &amp; |\\b&amp;\\b"</span></span>
<span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view_all</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">mult_aaf_subs</span><span class="op">$</span><span class="va">substance_reason</span>, </span>
<span>    size <span class="op">=</span> <span class="fl">20</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  pattern <span class="op">=</span> <span class="va">multp_subs_regex</span>,</span>
<span>  match <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [2] │</span> clomiphene<span style="color: #00BBBB;">&lt; and &gt;</span>its metabolite</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [3] │</span> hydrochlorothiazide<span style="color: #00BBBB;">&lt; &amp; &gt;</span>chlorothiazide</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [5] │</span> androgenic anabolic steroid<span style="color: #00BBBB;">&lt;, &gt;</span> erythropoietin (epo) <span style="color: #00BBBB;">&lt;and&gt;</span> amphetamine</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [6] │</span> androgenic anabolic steroid<span style="color: #00BBBB;">&lt; and &gt;</span>methylphenidate</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [7] │</span> methylhexaneamine<span style="color: #00BBBB;">&lt; &amp; &gt;</span>phenpromethamine</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [8] │</span> androgenic anabolic steroid<span style="color: #00BBBB;">&lt;, &gt;</span>clomiphene</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [9] │</span> clenbuterol<span style="color: #00BBBB;">&lt;, and &gt;</span>oxandrolone<span style="color: #00BBBB;">&lt; and &gt;</span>its metabolite</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[11] │</span> methylphenidate<span style="color: #00BBBB;">&lt; and &gt;</span>its metabolite</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[14] │</span> 19-norandrosterone<span style="color: #00BBBB;">&lt;, &gt;</span>epo<span style="color: #00BBBB;">&lt;, &gt;</span>furosemide</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[15] │</span> 19-norandrosterone (19-na) <span style="color: #00BBBB;">&lt;and&gt;</span> 19-noretiocholanolone</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[16] │</span> rad140<span style="color: #00BBBB;">&lt; and &gt;</span>ibutamoren</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[17] │</span> heptaminol<span style="color: #00BBBB;">&lt;, &gt;</span>1,4‐dimethylpentylamine (1,4‐dmpa)<span style="color: #00BBBB;">&lt;, &gt;</span>octodrine<span style="color: #00BBBB;">&lt;, &gt;</span>ostarine<span style="color: #00BBBB;">&lt;, &gt;</span>di‐hydroxy‐lgd‐4033</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[18] │</span> methylclostebol<span style="color: #00BBBB;">&lt;, &gt;</span>promagnon</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[19] │</span> hydrochlorothiazide<span style="color: #00BBBB;">&lt; and &gt;</span>chlorothiazide</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[20] │</span> ostarine<span style="color: #00BBBB;">&lt;, &gt;</span>s-23</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-5-semicolons">Step 5: semicolons<a class="anchor" aria-label="anchor" href="#step-5-semicolons"></a>
</h3>
<p>In addition to conjunctions, I also want to match on the semicolons,
so I will add this to <code>multp_subs_regex</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># I'm showing only a sample of 20 to reduce printing</span></span>
<span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view_all</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">mult_aaf_subs</span><span class="op">$</span><span class="va">substance_reason</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    replace <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span>,</span>
<span>  pattern <span class="op">=</span> <span class="st">";\\b|; \\b|; \\b |; "</span>,</span>
<span>  match <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [4] │</span> testosterone;<span style="color: #00BBBB;">{\t}</span>nandrolone<span style="color: #00BBBB;">&lt;; &gt;{\t}</span>dehydroepiandrosterone (dhea)<span style="color: #00BBBB;">&lt;; &gt;{\t}</span>somatropin (hgh)<span style="color: #00BBBB;">&lt;; &gt;</span>ipamorelin<span style="color: #00BBBB;">&lt;; &gt;{\t}</span>ghrp-6<span style="color: #00BBBB;">&lt;; &gt;</span>cjc-1295<span style="color: #00BBBB;">&lt;; &gt;</span> igf-1<span style="color: #00BBBB;">&lt;; &gt;</span>human chorionic gonadotropin (hcg)<span style="color: #00BBBB;">&lt;; &gt;</span>anastrozole</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [5] │</span> erythropoietin (epo)<span style="color: #00BBBB;">&lt;; &gt;</span>19‐norandrosterone (19‐na)<span style="color: #00BBBB;">&lt;; &gt;</span>androgenic-anabolic steroids (aas)<span style="color: #00BBBB;">&lt;; &gt;</span>clostebol, testosterone</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [6] │</span> androgenic anabolic steroid<span style="color: #00BBBB;">&lt;; &gt;</span>cannabinoids<span style="color: #00BBBB;">&lt;; &gt;</span>anastrozole<span style="color: #00BBBB;">&lt;; &gt;</span>clomiphene<span style="color: #00BBBB;">&lt;; &gt;</span>gw1516</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [7] │</span> 7-keto-dhea<span style="color: #00BBBB;">&lt;; &gt;</span>aod-9064</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [9] │</span> clomiphene<span style="color: #00BBBB;">&lt;; &gt;</span>oxandrolone<span style="color: #00BBBB;">&lt;; &gt;</span>androgenic anabolic steroid</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[18] │</span> clomiphene<span style="color: #00BBBB;">&lt;; &gt;</span>19-norandrosterone (19-na)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[19] │</span> tamoxifen<span style="color: #00BBBB;">&lt;; &gt;</span>boldenone, methandienone, drostanolone, and clenbuterol</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[20] │</span> ostarine<span style="color: #00BBBB;">&lt;; &gt;</span>gw1516</span></span>
<span><span class="co"># add to multp_subs_regex</span></span>
<span><span class="va">multp_subs_regex</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">multp_subs_regex</span>, <span class="st">";\\b|; \\b|; \\b |; "</span>, collapse <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-6-tab-boundaries">Step 6: tab boundaries<a class="anchor" aria-label="anchor" href="#step-6-tab-boundaries"></a>
</h3>
<p>The final pattern to add to <code>multp_subs_regex</code> is for tab
boundaries (<code>\\t</code>).</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view_all</a></span><span class="op">(</span></span>
<span>    <span class="va">mult_aaf_subs</span><span class="op">$</span><span class="va">substance_reason</span>,</span>
<span>  pattern <span class="op">=</span> <span class="st">"\\t| \\t| \\t |\\t "</span>,</span>
<span>  match <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">[16] │</span> testosterone;<span style="color: #00BBBB;">&lt;{\t}</span>&gt;nandrolone;<span style="color: #00BBBB;">&lt; {\t}</span>&gt;dehydroepiandrosterone (dhea);<span style="color: #00BBBB;">&lt; {\t}</span>&gt;somatropin (hgh); ipamorelin;<span style="color: #00BBBB;">&lt; {\t}</span>&gt;ghrp-6; cjc-1295;  igf-1; human chorionic gonadotropin (hcg); anastrozole</span></span>
<span><span class="co"># add to multp_subs_regex</span></span>
<span><span class="va">multp_subs_regex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">multp_subs_regex</span>, <span class="st">"\\t| \\t| \\t |\\t "</span>, collapse <span class="op">=</span> <span class="st">"|"</span><span class="op">)</span></span></code></pre></div>
<p>I combine all the steps above into the code chunk below:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># white space</span></span>
<span><span class="va">mult_aaf_subs</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">mult_aaf_subs</span>,</span>
<span>  substance_reason <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_trim</a></span><span class="op">(</span></span>
<span>    <span class="va">substance_reason</span>, </span>
<span>    <span class="st">"both"</span><span class="op">)</span>,</span>
<span>  <span class="co"># plurals</span></span>
<span>    substance_reason <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span></span>
<span>    <span class="va">substance_reason</span>,</span>
<span>    <span class="st">"and its metabolite|and its metabolites"</span>,</span>
<span>    <span class="st">"(metabolite)"</span><span class="op">)</span>,</span>
<span>  <span class="co"># plurals</span></span>
<span>  substance_reason <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span></span>
<span>    <span class="va">substance_reason</span>,</span>
<span>    <span class="st">"its metabolite"</span>,</span>
<span>    <span class="st">"(metabolite)"</span><span class="op">)</span>,</span>
<span>  <span class="co"># regex</span></span>
<span>  substance_reason <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove_all</a></span><span class="op">(</span></span>
<span>    <span class="va">substance_reason</span>,</span>
<span>    <span class="va">multp_subs_regex</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="classifying-multiple-substances">Classifying multiple substances<a class="anchor" aria-label="anchor" href="#classifying-multiple-substances"></a>
</h2>
<p>I’ve written <code><a href="../reference/classify_wada_substances.html">classify_wada_substances()</a></code> to identify
sanctions with multiple <a href="https://www.wada-ama.org/en/prohibited-list#search-anchor" class="external-link">WADA
banned substances</a>.</p>
<p>The <code><a href="../reference/classify_wada_substances.html">classify_wada_substances()</a></code> function scans the
<code>substance_reason</code> column and identifies any substances found
on the <a href="https://www.wada-ama.org/sites/default/files/2022-09/2023list_en_final_9_september_2022.pdf" class="external-link">WADA
list</a>.</p>
<p>See <a href="https://mjfrigaard.github.io/dopingdata/articles/single-aaf-substances.html"><code>vignettes/single-aaf-substances.Rmd</code></a>
for more information.</p>
<div class="section level3">
<h3 id="tidy_multp_aaf_subs">
<code>tidy_multp_aaf_subs</code><a class="anchor" aria-label="anchor" href="#tidy_multp_aaf_subs"></a>
</h3>
<p>The output from is stored in <code>tidy_multp_aaf_subs</code>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_multp_aaf_subs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/classify_wada_substances.html">classify_wada_substances</a></span><span class="op">(</span></span>
<span>  usada_data <span class="op">=</span> <span class="va">mult_aaf_subs</span>,</span>
<span>  subs_column <span class="op">=</span> <span class="va">substance_reason</span></span>
<span><span class="op">)</span></span>
<span><span class="va">tidy_multp_aaf_subs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/tabyl.html" class="external-link">tabyl</a></span><span class="op">(</span><span class="va">substance_group</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/adorn_pct_formatting.html" class="external-link">adorn_pct_formatting</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                      substance_group  n percent valid_percent</span></span>
<span><span class="co">#&gt;                   S1 ANABOLIC AGENTS 75   65.2%         65.8%</span></span>
<span><span class="co">#&gt;   S2 PEP HORMONES/G FACTORS/MIMETICS  5    4.3%          4.4%</span></span>
<span><span class="co">#&gt;                   S3 BETA-2 AGONISTS  2    1.7%          1.8%</span></span>
<span><span class="co">#&gt;  S4 HORMONE AND METABOLIC MODULATORS  9    7.8%          7.9%</span></span>
<span><span class="co">#&gt;          S5 DIURETICS/MASKING AGENTS 11    9.6%          9.6%</span></span>
<span><span class="co">#&gt;                        S6 STIMULANTS 11    9.6%          9.6%</span></span>
<span><span class="co">#&gt;                      S8 CANNABINOIDS  1    0.9%          0.9%</span></span>
<span><span class="co">#&gt;                                 &lt;NA&gt;  1    0.9%             -</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="unclassified-substances">Unclassified substances<a class="anchor" aria-label="anchor" href="#unclassified-substances"></a>
</h3>
<p>I want to identify any unclassified substances in
<code>tidy_multp_aaf_subs</code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_multp_aaf_subs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">substance_group</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">substance_reason</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;   substance_reason                              n</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> non-anatlyical: administrationtrafficking     1</span></span></code></pre></div>
<p>I can see this particular <code>substance_reason</code> is
non-analytical, so I need to reclassify this in the
<code>usada_substance_types.csv</code> data (which we imported above as
<code>substance_types</code>).</p>
<p>We can identify this sanction and athlete below:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tidy_multp_aaf_subs</span>, </span>
<span>  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="st">"^non-anatlyical"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="va">substance_reason</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;   athlete     substance_reason                         </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> block, mark non-anatlyical: administrationtrafficking</span></span></code></pre></div>
<p>I can recode these in <code>substance_types</code> and
<code>tidy_multp_aaf_subs</code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reclass_substance_types</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">substance_types</span>,</span>
<span>  sanction_type <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span></span>
<span>      <span class="va">substance_reason</span>, <span class="st">"non-anatlyical"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"non-analytical"</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">sanction_type</span></span>
<span>  <span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">tidy_multp_aaf_subs</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">tidy_multp_aaf_subs</span>,</span>
<span>  sanction_type <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span></span>
<span>      <span class="va">substance_reason</span>, <span class="st">"non-anatlyical"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"non-analytical"</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">sanction_type</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Check the <code>sanction_type</code> in
<code>reclass_substance_types</code></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reclass_substance_types</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="st">"block, mark"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="va">substance_reason</span>, <span class="va">sanction_type</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   athlete     substance_reason                               sanction_type </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> block, mark non-anatlyical: administration and trafficking non-analytical</span></span></code></pre></div>
<p>Check the <code>sanction_type</code> in
<code>tidy_multp_aaf_subs</code></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_multp_aaf_subs</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="st">"block, mark"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="va">substance_reason</span>, <span class="va">sanction_type</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   athlete     substance_reason                          sanction_type </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> block, mark non-anatlyical: administrationtrafficking non-analytical</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="export-substance-types">Export substance types<a class="anchor" aria-label="anchor" href="#export-substance-types"></a>
</h2>
<p>Export <code>substance_types</code></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/export_extdata.html">export_extdata</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">substance_types</span>, </span>
<span>  inst_path <span class="op">=</span> <span class="st">"../inst/"</span>, </span>
<span>  raw <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Exporting data: substance_types</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Exporting data: substance_types ... done</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Data successfully exported!</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="export-tidy-classified-multiple-substances">Export tidy classified (multiple) substances<a class="anchor" aria-label="anchor" href="#export-tidy-classified-multiple-substances"></a>
</h2>
<p>Export classified multiple substances
(<code>tidy_multp_aaf_subs</code>):</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/export_extdata.html">export_extdata</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">tidy_multp_aaf_subs</span>, </span>
<span>  inst_path <span class="op">=</span> <span class="st">"../inst/"</span>, </span>
<span>  raw <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Exporting data: tidy_multp_aaf_subs</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Exporting data: tidy_multp_aaf_subs ... done</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> Data successfully exported!</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Martin Frigaard.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
