<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="R package of data and code from the United States Anti-Doping
    Agency website.">
<title>USADA doping data • dopingdata</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Ubuntu-0.4.8/font.css" rel="stylesheet">
<link href="deps/Ubuntu_Mono-0.4.8/font.css" rel="stylesheet">
<link href="deps/Fira_Sans_Condensed-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="USADA doping data">
<meta property="og:description" content="R package of data and code from the United States Anti-Doping
    Agency website.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">dopingdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Harvesting Data</h6>
    <a class="dropdown-item" href="articles/scraping-usada-sanctions.html">USADA Sanctions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="dopingdata">dopingdata<a class="anchor" aria-label="anchor" href="#dopingdata"></a>
</h1></div>
<!-- badges: start -->
<p><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg"></p>
<!-- https://img.shields.io/badge/lifecycle-stable-green.svg -->
<!-- badges: end -->
<p><code>dopingdata</code> contains data from the <a href="https://en.wikipedia.org/wiki/United_States_Anti-Doping_Agency" class="external-link">United States Anti-Doping Agency</a> for exploration, modeling, and visualizations. The datasets in this package are derived from from the <a href="https://www.usada.org/" class="external-link">USADA website</a> and the <a href="https://www.wada-ama.org/en/prohibited-list?q=" class="external-link">World Anti-Doping Agency (WADA) banned substances list</a>. Scraping, processing, and visualizing these data presented so many unique challenges I decided to combine the utilities into a package.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of <code>dopingdata</code> like so:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"mjfrigaard/dopingdata"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjfrigaard.github.io/dopingdata/">dopingdata</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="scraping-usada-data">Scraping USADA Data<a class="anchor" aria-label="anchor" href="#scraping-usada-data"></a>
</h2>
<p>Each dataset was ha<strong>rvest</strong>ed using the <a href="https://rvest.tidyverse.org/" class="external-link"><code>rvest</code></a> and <a href="https://xml2.r-lib.org/" class="external-link"><code>xml2</code></a> packages, but using manners (with the <a href="https://dmi3kno.github.io/polite/" class="external-link"><code>polite</code></a> package).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/scrape_sanctions.html">scrape_sanctions</a></span><span class="op">(</span>dest_path <span class="op">=</span> <span class="st">"data-raw/csv"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Exporting data<span class="sc">:</span> data<span class="sc">-</span>raw<span class="sc">/</span>csv<span class="sc">/</span><span class="dv">2023-12-20</span><span class="sc">/</span><span class="dv">2023-12-20</span><span class="sc">-</span>usada_raw.csv</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Data successfully exported<span class="sc">!</span></span></code></pre></div>
<p><code>dopingdata</code> results in a lot of datasets, so I’ve written two helper functions (and an example raw dataset to demonstrate).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">example_usada_raw</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    250 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;  $ Athlete           : chr  "*Name Removed" "Richardson, Sha'Carri" "*Name Removed" "*Name Removed" ...</span></span>
<span><span class="co">#&gt;  $ Sport             : chr  "Cycling" "Track and Field" "Track and Field" "Bobsled and Skeleton" ...</span></span>
<span><span class="co">#&gt;  $ Substance.Reason  : chr  "Non-Analytical: Use and Possession (EPO)" "Cannabinoids" "Non-Analytical: Refusal to Submit to Sample Collection" "Elevated T/E" ...</span></span>
<span><span class="co">#&gt;  $ Sanction.Terms    : chr  "2-Year Suspension - Loss of Results" "1-Month Suspension; Loss of Results" "2-Year Suspension - Loss of Results" "2-Year Suspension - Loss of Results" ...</span></span>
<span><span class="co">#&gt;  $ Sanction.Announced: chr  "" "07/02/2021" "" "" ...</span></span></code></pre></div>
<div class="section level3">
<h3 id="export_data">
<strong>export_data()</strong><a class="anchor" aria-label="anchor" href="#export_data"></a>
</h3>
<p><code><a href="reference/export_data.html">export_data()</a></code> will export data of various <code>type</code>s (<code>.csv</code>, <code>.tsv</code>, <code>.rds</code>, etc.) to a designated <code>path</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/export_data.html">export_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">example_usada_raw</span>, path <span class="op">=</span> <span class="st">"dev"</span>, type <span class="op">=</span> <span class="st">"rds"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Exporting data: dev/2023-12-21/2023-12-21-example_usada_raw.rds</span></span>
<span><span class="co">#&gt; Data successfully exported!</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="export_extdata">
<strong>export_extdata()</strong><a class="anchor" aria-label="anchor" href="#export_extdata"></a>
</h3>
<p><code><a href="reference/export_extdata.html">export_extdata()</a></code> is similiar, but exports the data to an <code>inst/</code> folder (helpful when writing R packages).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/export_extdata.html">export_extdata</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">example_usada_raw</span>, path <span class="op">=</span> <span class="st">"raw"</span>, type <span class="op">=</span> <span class="st">"csv"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Exporting data: inst/extdata/raw/2023-12-21/2023-12-21-example_usada_raw.csv</span></span>
<span><span class="co">#&gt; Data successfully exported!</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="process_text">
<strong>process_text()</strong><a class="anchor" aria-label="anchor" href="#process_text"></a>
</h3>
<p><code><a href="reference/process_text.html">process_text()</a></code> performs the following:</p>
<ul>
<li><p>Processed data have all had the column names formatted <code>snake_case</code></p></li>
<li><p>All of the text has been converted to lowercase</p></li>
</ul>
<p>Below we’ll import the scraped data in <code>data-raw/csv/</code> and process the text:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 'data.frame':    937 obs. of  5 variables:</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ athlete           : chr  "rodriguez, daniel" "park, mariah" "frey, john" "jha, kanak" ...</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ sport             : chr  "mixed martial arts" "weightlifting" "cycling" "table tennis" ...</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ substance_reason  : chr  "ostarine; lgd-4033" "chlorthalidone" "non-analytical: refusal to submit to sample collection" "non-analytical: 3 whereabouts failures" ...</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ sanction_terms    : chr  "3-month suspenion" "public warning" "2-year suspension; loss of results" "1-year suspension; loss of results" ...</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ sanction_announced: chr  "12/14/2023" "12/11/2023" "12/05/2023" "original: 3/20/2023; updated: 12/01/2023" ...</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="dates">Dates<a class="anchor" aria-label="anchor" href="#dates"></a>
</h2>
<p><code>sanction_announced</code> contains the date the sanction was announced, and about 30 of these contain two values (<code>original</code> and <code>updated</code>). Wrangling these values pose some challenges because they aren’t <em>consistently</em> messy:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">usada</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^original"</span>, <span class="va">usada</span><span class="op">[[</span><span class="st">'sanction_announced'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="va">sanction_announced</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<colgroup>
<col width="6%">
<col width="33%">
<col width="59%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">athlete</th>
<th align="left">sanction_announced</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">4</td>
<td align="left">jha, kanak</td>
<td align="left">original: 3/20/2023; updated: 12/01/2023</td>
</tr>
<tr class="even">
<td align="left">88</td>
<td align="left">prempeh, ernest</td>
<td align="left">original: 05/07/2019; updated: 02/04/2022</td>
</tr>
<tr class="odd">
<td align="left">91</td>
<td align="left">ngetich, eliud</td>
<td align="left">original: 09/03/21; updated: 01/25/22</td>
</tr>
<tr class="even">
<td align="left">121</td>
<td align="left">gehm, zach</td>
<td align="left">original: 11/04/2019;updated: 05/17/2021</td>
</tr>
<tr class="odd">
<td align="left">152</td>
<td align="left">hudson, ryan</td>
<td align="left">original 12/20/2018; updated 11/04/2020</td>
</tr>
<tr class="even">
<td align="left">156</td>
<td align="left">paparella, flavia</td>
<td align="left">original: 10/19/2020updated: 01/05/2021</td>
</tr>
<tr class="odd">
<td align="left">167</td>
<td align="left">murdock, vince</td>
<td align="left">original: 09/05/2019; updated: 08/26/2020</td>
</tr>
<tr class="even">
<td align="left">171</td>
<td align="left">rante, danielle</td>
<td align="left">original: 07/22/2020, updated: 11/03/2022</td>
</tr>
<tr class="odd">
<td align="left">200</td>
<td align="left">werdum, fabricio</td>
<td align="left">original 09/11/2018; updated 01/16/2020</td>
</tr>
<tr class="even">
<td align="left">212</td>
<td align="left">jones, stirley</td>
<td align="left">original: 06/17/2019; updated: 12/16/2019</td>
</tr>
<tr class="odd">
<td align="left">213</td>
<td align="left">hay, amy</td>
<td align="left">original: 10/31/2017; updated: 12/16/2019</td>
</tr>
<tr class="even">
<td align="left">240</td>
<td align="left">orbon, joane</td>
<td align="left">original: 08/12/2019; updated: 09/10/2019</td>
</tr>
<tr class="odd">
<td align="left">255</td>
<td align="left">ribas, amanda</td>
<td align="left">original: 01/10/2018; updated 05/03/2019</td>
</tr>
<tr class="even">
<td align="left">288</td>
<td align="left">saccente, nicholas</td>
<td align="left">original: 02/14/2017; updated: 12/11/2018</td>
</tr>
<tr class="odd">
<td align="left">289</td>
<td align="left">miyao, paulo</td>
<td align="left">original: 05/10/2017;updated: 11/27/2018</td>
</tr>
<tr class="even">
<td align="left">293</td>
<td align="left">garcia del moral, luis</td>
<td align="left">original: 07/10/2012;updated: 10/26/2018</td>
</tr>
<tr class="odd">
<td align="left">294</td>
<td align="left">bruyneel, johan</td>
<td align="left">original: 04/22/2014;updated: 10/24/2018</td>
</tr>
<tr class="even">
<td align="left">295</td>
<td align="left">celaya lazama, pedro</td>
<td align="left">original: 04/22/2014;updated: 10/24/2018</td>
</tr>
<tr class="odd">
<td align="left">296</td>
<td align="left">marti, jose</td>
<td align="left">original: 04/22/2014;updated: 10/24/2018</td>
</tr>
<tr class="even">
<td align="left">297</td>
<td align="left">moffett, shaun</td>
<td align="left">original: 04/24/2018updated: 10/19/2018</td>
</tr>
<tr class="odd">
<td align="left">305</td>
<td align="left">hunter, adam</td>
<td align="left">original: 10/28/2016; updated: 09/26/2018</td>
</tr>
<tr class="even">
<td align="left">384</td>
<td align="left">bailey, ryan</td>
<td align="left">original: 08/03/2017; updated: 12/01/2017</td>
</tr>
<tr class="odd">
<td align="left">450</td>
<td align="left">thomas, tammy</td>
<td align="left">original: 08/30/2002; updated: 02/13/2017</td>
</tr>
<tr class="even">
<td align="left">478</td>
<td align="left">tovar, oscar</td>
<td align="left">original: 10/28/2015; updated: 10/04/2016</td>
</tr>
<tr class="odd">
<td align="left">518</td>
<td align="left">fischbach, dylan</td>
<td align="left">original: 12/18/2015; updated: 04/11/2016</td>
</tr>
<tr class="even">
<td align="left">526</td>
<td align="left">lea, robert</td>
<td align="left">original: 12/17/2015; updated: 02/25/2016</td>
</tr>
<tr class="odd">
<td align="left">539</td>
<td align="left">trafeh, mohamed</td>
<td align="left">original: 12/18/2014; updated: 08/25/2015</td>
</tr>
<tr class="even">
<td align="left">604</td>
<td align="left">dotti, juan pablo</td>
<td align="left">original: 10/20/2011; updated: 06/05/2013</td>
</tr>
<tr class="odd">
<td align="left">679</td>
<td align="left">oliveira, flavia</td>
<td align="left">original: 04/13/2010; updated 12/10/2010</td>
</tr>
<tr class="even">
<td align="left">742</td>
<td align="left">young, jerome</td>
<td align="left">original: 11/10/2004; updated: 06/17/2008</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="clean_dates">
<strong>clean_dates()</strong><a class="anchor" aria-label="anchor" href="#clean_dates"></a>
</h3>
<p>I’ve written a <code><a href="reference/clean_dates.html">clean_dates()</a></code> function that takes <code>date_col</code>, <code>split</code> and <code>pattern</code> arguments:</p>
<ul>
<li><p><code>df</code> = processed USADA dataset with messy dates</p></li>
<li><p><code>date_col</code> = sanction date column (usually <code>sanction_announced</code>)</p></li>
<li><p><code>split</code> = regex to pass to split argument of <code><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit()</a></code> (defaults to <code>"updated"</code>)</p></li>
<li><p><code>pattern</code> = regex for other non-date pattern (defaults to <code>"original"</code>)</p></li>
</ul>
<p>Below is an example dataset to demonstrate how <code><a href="reference/clean_dates.html">clean_dates()</a></code> works:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/clean_dates.html">clean_dates</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">example_sanction_dates</span>, </span>
<span>  date_col <span class="op">=</span> <span class="st">"ugly_dates"</span>, </span>
<span>  split <span class="op">=</span> <span class="st">"updated"</span>, </span>
<span>  pattern <span class="op">=</span> <span class="st">"original"</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<colgroup>
<col width="25%">
<col width="46%">
<col width="15%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="left">athlete</th>
<th align="left">ugly_dates</th>
<th align="left">pattern_date</th>
<th align="left">split_date</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">jha, kanak</td>
<td align="left">original: 3/20/2023; updated: 12/01/2023</td>
<td align="left">2023-03-20</td>
<td align="left">2023-12-01</td>
</tr>
<tr class="even">
<td align="left">prempeh, ernest</td>
<td align="left">original: 05/07/2019; updated: 02/04/2022</td>
<td align="left">2019-05-07</td>
<td align="left">2022-02-04</td>
</tr>
<tr class="odd">
<td align="left">ngetich, eliud</td>
<td align="left">original: 09/03/21; updated: 01/25/22</td>
<td align="left">0021-09-03</td>
<td align="left">0022-01-25</td>
</tr>
<tr class="even">
<td align="left">gehm, zach</td>
<td align="left">original: 11/04/2019;updated: 05/17/2021</td>
<td align="left">2019-11-04</td>
<td align="left">2021-05-17</td>
</tr>
<tr class="odd">
<td align="left">hudson, ryan</td>
<td align="left">original 12/20/2018; updated 11/04/2020</td>
<td align="left">2018-12-20</td>
<td align="left">2020-11-04</td>
</tr>
<tr class="even">
<td align="left">paparella, flavia</td>
<td align="left">original: 10/19/2020updated: 01/05/2021</td>
<td align="left">2020-10-19</td>
<td align="left">2021-01-05</td>
</tr>
<tr class="odd">
<td align="left">murdock, vince</td>
<td align="left">original: 09/05/2019; updated: 08/26/2020</td>
<td align="left">2019-09-05</td>
<td align="left">2020-08-26</td>
</tr>
<tr class="even">
<td align="left">rante, danielle</td>
<td align="left">original: 07/22/2020, updated: 11/03/2022</td>
<td align="left">2020-07-22</td>
<td align="left">2022-11-03</td>
</tr>
<tr class="odd">
<td align="left">werdum, fabricio</td>
<td align="left">original 09/11/2018; updated 01/16/2020</td>
<td align="left">2018-09-11</td>
<td align="left">2020-01-16</td>
</tr>
<tr class="even">
<td align="left">jones, stirley</td>
<td align="left">original: 06/17/2019; updated: 12/16/2019</td>
<td align="left">2019-06-17</td>
<td align="left">2019-12-16</td>
</tr>
<tr class="odd">
<td align="left">hay, amy</td>
<td align="left">original: 10/31/2017; updated: 12/16/2019</td>
<td align="left">2017-10-31</td>
<td align="left">2019-12-16</td>
</tr>
<tr class="even">
<td align="left">orbon, joane</td>
<td align="left">original: 08/12/2019; updated: 09/10/2019</td>
<td align="left">2019-08-12</td>
<td align="left">2019-09-10</td>
</tr>
<tr class="odd">
<td align="left">ribas, amanda</td>
<td align="left">original: 01/10/2018; updated 05/03/2019</td>
<td align="left">2018-01-10</td>
<td align="left">2019-05-03</td>
</tr>
<tr class="even">
<td align="left">saccente, nicholas</td>
<td align="left">original: 02/14/2017; updated: 12/11/2018</td>
<td align="left">2017-02-14</td>
<td align="left">2018-12-11</td>
</tr>
<tr class="odd">
<td align="left">miyao, paulo</td>
<td align="left">original: 05/10/2017;updated: 11/27/2018</td>
<td align="left">2017-05-10</td>
<td align="left">2018-11-27</td>
</tr>
<tr class="even">
<td align="left">garcia del moral, luis</td>
<td align="left">original: 07/10/2012;updated: 10/26/2018</td>
<td align="left">2012-07-10</td>
<td align="left">2018-10-26</td>
</tr>
<tr class="odd">
<td align="left">bruyneel, johan</td>
<td align="left">original: 04/22/2014;updated: 10/24/2018</td>
<td align="left">2014-04-22</td>
<td align="left">2018-10-24</td>
</tr>
<tr class="even">
<td align="left">celaya lazama, pedro</td>
<td align="left">original: 04/22/2014;updated: 10/24/2018</td>
<td align="left">2014-04-22</td>
<td align="left">2018-10-24</td>
</tr>
<tr class="odd">
<td align="left">marti, jose</td>
<td align="left">original: 04/22/2014;updated: 10/24/2018</td>
<td align="left">2014-04-22</td>
<td align="left">2018-10-24</td>
</tr>
<tr class="even">
<td align="left">moffett, shaun</td>
<td align="left">original: 04/24/2018updated: 10/19/2018</td>
<td align="left">2018-04-24</td>
<td align="left">2018-10-19</td>
</tr>
<tr class="odd">
<td align="left">hunter, adam</td>
<td align="left">original: 10/28/2016; updated: 09/26/2018</td>
<td align="left">2016-10-28</td>
<td align="left">2018-09-26</td>
</tr>
<tr class="even">
<td align="left">bailey, ryan</td>
<td align="left">original: 08/03/2017; updated: 12/01/2017</td>
<td align="left">2017-08-03</td>
<td align="left">2017-12-01</td>
</tr>
<tr class="odd">
<td align="left">thomas, tammy</td>
<td align="left">original: 08/30/2002; updated: 02/13/2017</td>
<td align="left">2002-08-30</td>
<td align="left">2017-02-13</td>
</tr>
<tr class="even">
<td align="left">tovar, oscar</td>
<td align="left">original: 10/28/2015; updated: 10/04/2016</td>
<td align="left">2015-10-28</td>
<td align="left">2016-10-04</td>
</tr>
<tr class="odd">
<td align="left">fischbach, dylan</td>
<td align="left">original: 12/18/2015; updated: 04/11/2016</td>
<td align="left">2015-12-18</td>
<td align="left">2016-04-11</td>
</tr>
<tr class="even">
<td align="left">lea, robert</td>
<td align="left">original: 12/17/2015; updated: 02/25/2016</td>
<td align="left">2015-12-17</td>
<td align="left">2016-02-25</td>
</tr>
<tr class="odd">
<td align="left">trafeh, mohamed</td>
<td align="left">original: 12/18/2014; updated: 08/25/2015</td>
<td align="left">2014-12-18</td>
<td align="left">2015-08-25</td>
</tr>
<tr class="even">
<td align="left">dotti, juan pablo</td>
<td align="left">original: 10/20/2011; updated: 06/05/2013</td>
<td align="left">2011-10-20</td>
<td align="left">2013-06-05</td>
</tr>
<tr class="odd">
<td align="left">oliveira, flavia</td>
<td align="left">original: 04/13/2010; updated 12/10/2010</td>
<td align="left">2010-04-13</td>
<td align="left">2010-12-10</td>
</tr>
<tr class="even">
<td align="left">young, jerome</td>
<td align="left">original: 11/10/2004; updated: 06/17/2008</td>
<td align="left">2004-11-10</td>
<td align="left">2008-06-17</td>
</tr>
</tbody>
</table>
</div>
<p>For <code>usada</code>, split the data into three <code>data.frame</code>s (<code>bad_dates</code>, <code>good_dates</code>, and <code>no_dates</code>).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bad_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">usada</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^original"</span>, <span class="va">usada</span><span class="op">[[</span><span class="st">'sanction_announced'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">good_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">usada</span>, </span>
<span>  <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^original"</span>, <span class="va">usada</span><span class="op">[[</span><span class="st">'sanction_announced'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">sanction_announced</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="va">no_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">usada</span>,</span>
<span>  <span class="va">athlete</span> <span class="op">==</span> <span class="st">"*name removed"</span> <span class="op">&amp;</span> <span class="va">sanction_announced</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p>Clean dates in <code>bad_dates</code> by splitting the bad dates on <code>"updated"</code> and provided <code>"original"</code> as the pattern (the opposite will also work). The <code>sanction_date</code> column will contain the correctly formatted updated <code>sanction_date</code>.</p>
<p>After formatting <code>good_dates</code> and removing <code>original_date</code> column we can combine the two with <code><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind()</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cleaned_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/clean_dates.html">clean_dates</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">bad_dates</span>, </span>
<span>  date_col <span class="op">=</span> <span class="st">"sanction_announced"</span>, </span>
<span>  split <span class="op">=</span> <span class="st">"updated"</span>, </span>
<span>  pattern <span class="op">=</span> <span class="st">"original"</span><span class="op">)</span></span>
<span><span class="co"># address names </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cleaned_dates</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cleaned_dates</span><span class="op">)</span> <span class="op">==</span> <span class="st">'split_date'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'sanction_date'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cleaned_dates</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cleaned_dates</span><span class="op">)</span> <span class="op">==</span> <span class="st">'pattern_date'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'original_date'</span></span>
<span><span class="co"># format good_dates</span></span>
<span><span class="va">good_dates</span><span class="op">$</span><span class="va">sanction_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">good_dates</span><span class="op">[[</span><span class="st">'sanction_announced'</span><span class="op">]</span><span class="op">]</span>, </span>
<span>                                    format <span class="op">=</span> <span class="st">"%m/%d/%Y"</span><span class="op">)</span></span>
<span><span class="co"># get intersecting names </span></span>
<span><span class="va">nms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cleaned_dates</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">good_dates</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># bind the two datasets </span></span>
<span><span class="va">usada_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">good_dates</span>, <span class="va">cleaned_dates</span><span class="op">[</span><span class="va">nms</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">usada_dates</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    649 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;  $ athlete           : chr  "rodriguez, daniel" "park, mariah" "frey, john" "forrest, evan" ...</span></span>
<span><span class="co">#&gt;  $ sport             : chr  "mixed martial arts" "weightlifting" "cycling" "weightlifting" ...</span></span>
<span><span class="co">#&gt;  $ substance_reason  : chr  "ostarine; lgd-4033" "chlorthalidone" "non-analytical: refusal to submit to sample collection" "boldenone; drostanolone; methandienone; nandrolone; testosterone" ...</span></span>
<span><span class="co">#&gt;  $ sanction_terms    : chr  "3-month suspenion" "public warning" "2-year suspension; loss of results" "3-year suspension; loss of results" ...</span></span>
<span><span class="co">#&gt;  $ sanction_announced: chr  "12/14/2023" "12/11/2023" "12/05/2023" "11/30/2023" ...</span></span>
<span><span class="co">#&gt;  $ sanction_date     : Date, format: "2023-12-14" "2023-12-11" ...</span></span></code></pre></div>
<p>Export the <code>usada_dates</code> to <code>data-raw/csv</code> folder.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/export_data.html">export_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">usada_dates</span>, path <span class="op">=</span> <span class="st">"data-raw/csv"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Exporting data: data-raw/csv/2023-12-21/2023-12-21-usada_dates.csv</span></span>
<span><span class="co">#&gt; Data successfully exported!</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="sports">Sports<a class="anchor" aria-label="anchor" href="#sports"></a>
</h2>
<p>To wrangle the sports, I’ll use packages and functions from the <code>tidyverse</code> (<code>dplyr</code>, <code>stringr</code>, <code>tidyr</code>, etc.), but I also provide the base R alternatives (wherever possible).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; ✔ dplyr     1.1.4     ✔ readr     2.1.4</span></span>
<span><span class="co">#&gt; ✔ forcats   1.0.0     ✔ stringr   1.5.1</span></span>
<span><span class="co">#&gt; ✔ ggplot2   3.4.4     ✔ tibble    3.2.1</span></span>
<span><span class="co">#&gt; ✔ lubridate 1.9.3     ✔ tidyr     1.3.0</span></span>
<span><span class="co">#&gt; ✔ purrr     1.0.2     </span></span>
<span><span class="co">#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></span>
<span><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></span>
<span><span class="co">#&gt; ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</span></span></code></pre></div>
<p><code>tidyverse</code> functions will return a <code>tibble</code> (not a <code>data.frame</code>), which prints fewer rows to the console.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_sports</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">usada_dates</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">usada_sports</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [649 × 6] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ athlete           : chr [1:649] "rodriguez, daniel" "park, mariah" "frey, john" "forrest, evan" ...</span></span>
<span><span class="co">#&gt;  $ sport             : chr [1:649] "mixed martial arts" "weightlifting" "cycling" "weightlifting" ...</span></span>
<span><span class="co">#&gt;  $ substance_reason  : chr [1:649] "ostarine; lgd-4033" "chlorthalidone" "non-analytical: refusal to submit to sample collection" "boldenone; drostanolone; methandienone; nandrolone; testosterone" ...</span></span>
<span><span class="co">#&gt;  $ sanction_terms    : chr [1:649] "3-month suspenion" "public warning" "2-year suspension; loss of results" "3-year suspension; loss of results" ...</span></span>
<span><span class="co">#&gt;  $ sanction_announced: chr [1:649] "12/14/2023" "12/11/2023" "12/05/2023" "11/30/2023" ...</span></span>
<span><span class="co">#&gt;  $ sanction_date     : Date[1:649], format: "2023-12-14" "2023-12-11" ...</span></span></code></pre></div>
<p>We can start by counting the <code>sport</code> column:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_sports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">sport</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">sport</th>
<th align="right">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">mixed martial arts</td>
<td align="right">135</td>
</tr>
<tr class="even">
<td align="left">cycling</td>
<td align="right">125</td>
</tr>
<tr class="odd">
<td align="left">weightlifting</td>
<td align="right">122</td>
</tr>
<tr class="even">
<td align="left">track and field</td>
<td align="right">93</td>
</tr>
<tr class="odd">
<td align="left">wrestling</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="left">triathlon</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">brazilian jiu-jitsu</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">paralympic track and field</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">swimming</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">cycling - athlete support personnel</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">track and field - athlete support personnel</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">ice hockey</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">rowing</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">taekwondo</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">bobsled and skeleton</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">boxing</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">judo</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">paralympic cycling</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">paralympic judo</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">archery</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">cycling, triathlon</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">karate</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">para track and field</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">rugby</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">bobsled</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">boccia</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">paralympic basketball</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">powerlifting</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">racquetball</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">speedskating</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">team handball</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">track &amp; field</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">baseball</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">bobsled and skeleton, track and field</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">bowling</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">brazilian jiu-jitsu - athlete support personnel</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">brazillian jiu-jitsu</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">canoe</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">cycling, weightlifting</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">equestrian</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">gymnastics</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">luge</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">para shooting</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">paralympic archery</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">paralympic boccia</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">paralympic curling</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">paralympic rugby</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">paralympic sailing</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">paralympic snowboarding</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">paralympic table tennis</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">paralympic track and field, paralympic volleyball</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">pentathlon</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">professional boxing</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">roller sports</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">shooting</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">skateboarding</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">skiing</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">skiing and snowboarding</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">soccer</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">squash</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">table tennis</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">tennis</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">volleyball</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">waterskiing</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">weightlifting - athlete support personnel</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">wheelchair tennis</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="support-personnel">Support personnel<a class="anchor" aria-label="anchor" href="#support-personnel"></a>
</h3>
<p>Some of the sports aren’t sports–they’re <code>athlete support personnel</code>. These need a <code>support_personnel</code> identifier.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_sports</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">usada_sports</span>, </span>
<span>  <span class="co"># support_personnel</span></span>
<span>  support_personnel <span class="op">=</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span>condition <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span></span>
<span>      <span class="va">sport</span>, <span class="st">"support personnel"</span><span class="op">)</span>, </span>
<span>      true <span class="op">=</span> <span class="cn">TRUE</span>, false <span class="op">=</span> <span class="cn">FALSE</span>, missing <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">usada_sports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">sport</span>, <span class="st">"support personnel"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">sport</span>, <span class="va">support_personnel</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">support_personnel</span>, values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">sport</th>
<th align="right">TRUE</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">brazilian jiu-jitsu - athlete support personnel</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">cycling - athlete support personnel</td>
<td align="right">6</td>
</tr>
<tr class="odd">
<td align="left">track and field - athlete support personnel</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">weightlifting - athlete support personnel</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="track-and-field-or-track--field">‘track and field’ or ‘track &amp; field’<a class="anchor" aria-label="anchor" href="#track-and-field-or-track--field"></a>
</h3>
<p>Convert sports like <code>track &amp; field</code> to <code>track and field</code> to help determine which athletes/support personnel are involved in multiple sports.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_sports</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">usada_sports</span>,</span>
<span>  <span class="co"># track &amp; field</span></span>
<span>  sport <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="va">sport</span>, <span class="st">'track and field'</span>, <span class="st">'track &amp; field'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">usada_sports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">sport</span>, <span class="st">"track"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">sport</span>, <span class="va">support_personnel</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">support_personnel</span>, values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">sport</th>
<th align="right">FALSE</th>
<th align="right">TRUE</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">bobsled and skeleton, track &amp; field</td>
<td align="right">1</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">para track &amp; field</td>
<td align="right">3</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">paralympic track &amp; field</td>
<td align="right">11</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">paralympic track &amp; field, paralympic volleyball</td>
<td align="right">1</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">track &amp; field</td>
<td align="right">95</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">track &amp; field - athlete support personnel</td>
<td align="right">NA</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="spelling">Spelling<a class="anchor" aria-label="anchor" href="#spelling"></a>
</h3>
<p>The incorrect spelling for <code>brazilian jiu-jitsu</code> (<code>brazillian jiu-jitsu</code>) is corrected below.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_sports</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">usada_sports</span>, </span>
<span>  <span class="co"># brazilian jiu-jitsu</span></span>
<span>  sport <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">sport</span> <span class="op">==</span> <span class="st">'brazillian jiu-jitsu'</span> <span class="op">~</span> <span class="st">'brazilian jiu-jitsu'</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">sport</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">usada_sports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">sport</span>, <span class="st">"jitsu"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">sport</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">sport</th>
<th align="right">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">brazilian jiu-jitsu</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">brazilian jiu-jitsu - athlete support personnel</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="paralympic">‘paralympic’<a class="anchor" aria-label="anchor" href="#paralympic"></a>
</h3>
<p>An identifier for paralympic sports: <code>paralympic</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_sports</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">usada_sports</span>, </span>
<span>  <span class="co"># paralympic</span></span>
<span>  paralympic <span class="op">=</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span>condition <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">sport</span>, <span class="st">"paralympic|para"</span><span class="op">)</span>, </span>
<span>      true <span class="op">=</span> <span class="cn">TRUE</span>, false <span class="op">=</span> <span class="cn">FALSE</span>, missing <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">usada_sports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">sport</span>, <span class="st">"paralympic|para"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">paralympic</span>, <span class="va">sport</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">paralympic</span>, values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">sport</th>
<th align="right">TRUE</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">para shooting</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">para track &amp; field</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">paralympic archery</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">paralympic basketball</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">paralympic boccia</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">paralympic curling</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">paralympic cycling</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">paralympic judo</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="left">paralympic rugby</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">paralympic sailing</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">paralympic snowboarding</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">paralympic table tennis</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">paralympic track &amp; field</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">paralympic track &amp; field, paralympic volleyball</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="multiple-sports">Multiple sports<a class="anchor" aria-label="anchor" href="#multiple-sports"></a>
</h3>
<p>Identify the multiple sports using <code>and</code> and <code>,</code> in a regular expression.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_sports</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">usada_sports</span>, </span>
<span>  <span class="co"># multiple_sports</span></span>
<span>  multiple_sports <span class="op">=</span> </span>
<span>    <span class="fu">if_else</span><span class="op">(</span>condition <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">sport</span>, <span class="st">"and |, "</span><span class="op">)</span>, </span>
<span>      true <span class="op">=</span> <span class="cn">TRUE</span>, false <span class="op">=</span> <span class="cn">FALSE</span>, missing <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">usada_sports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">sport</span>, <span class="st">"and |, "</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">multiple_sports</span>, <span class="va">sport</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">multiple_sports</span>, values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">sport</th>
<th align="right">TRUE</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">bobsled and skeleton</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">bobsled and skeleton, track &amp; field</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">cycling, triathlon</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">cycling, weightlifting</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">paralympic track &amp; field, paralympic volleyball</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">skiing and snowboarding</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="tidy">Tidy<a class="anchor" aria-label="anchor" href="#tidy"></a>
</h3>
<p>Separate the multi-sport athletes in <code>usada_sports</code> as <code>multp_sport_athletes</code> and single-sport athletes in <code>single_sport_athletes</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multp_sport_athletes</span> <span class="op">&lt;-</span> <span class="va">usada_sports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">multiple_sports</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">multp_sport_athletes</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [11 × 9] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ athlete           : chr [1:11] "allison, kyler" "blandford, jenna" "cruse, j.c." "schrodt, patrick \"dillon\"" ...</span></span>
<span><span class="co">#&gt;  $ sport             : chr [1:11] "bobsled and skeleton" "cycling, triathlon" "bobsled and skeleton" "bobsled and skeleton" ...</span></span>
<span><span class="co">#&gt;  $ substance_reason  : chr [1:11] "non-analytical: refusal to submit to sample collection" "non-analytical: use and possession (testosterone, hgh and oxandrolone)" "dimethylbutylamine (dmba)" "dimethylbutylamine (dmba)" ...</span></span>
<span><span class="co">#&gt;  $ sanction_terms    : chr [1:11] "4-year suspension; loss of results; sanction tolled due to retirement" "4-year suspension - loss of results" "16-month suspension - loss of results" "16-month suspension - loss of results" ...</span></span>
<span><span class="co">#&gt;  $ sanction_announced: chr [1:11] "10/09/2019" "11/28/2017" "07/20/2017" "04/06/2017" ...</span></span>
<span><span class="co">#&gt;  $ sanction_date     : Date[1:11], format: "2019-10-09" "2017-11-28" ...</span></span>
<span><span class="co">#&gt;  $ support_personnel : logi [1:11] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ paralympic        : logi [1:11] FALSE FALSE FALSE FALSE TRUE FALSE ...</span></span>
<span><span class="co">#&gt;  $ multiple_sports   : logi [1:11] TRUE TRUE TRUE TRUE TRUE TRUE ...</span></span>
<span><span class="va">single_sport_athletes</span> <span class="op">&lt;-</span> <span class="va">usada_sports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">multiple_sports</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">single_sport_athletes</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [638 × 9] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ athlete           : chr [1:638] "rodriguez, daniel" "park, mariah" "frey, john" "forrest, evan" ...</span></span>
<span><span class="co">#&gt;  $ sport             : chr [1:638] "mixed martial arts" "weightlifting" "cycling" "weightlifting" ...</span></span>
<span><span class="co">#&gt;  $ substance_reason  : chr [1:638] "ostarine; lgd-4033" "chlorthalidone" "non-analytical: refusal to submit to sample collection" "boldenone; drostanolone; methandienone; nandrolone; testosterone" ...</span></span>
<span><span class="co">#&gt;  $ sanction_terms    : chr [1:638] "3-month suspenion" "public warning" "2-year suspension; loss of results" "3-year suspension; loss of results" ...</span></span>
<span><span class="co">#&gt;  $ sanction_announced: chr [1:638] "12/14/2023" "12/11/2023" "12/05/2023" "11/30/2023" ...</span></span>
<span><span class="co">#&gt;  $ sanction_date     : Date[1:638], format: "2023-12-14" "2023-12-11" ...</span></span>
<span><span class="co">#&gt;  $ support_personnel : logi [1:638] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ paralympic        : logi [1:638] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ multiple_sports   : logi [1:638] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span></code></pre></div>
<p>The athletes listed with multiple sports will occupy multiple rows in a ‘tidy’ version of <code>usada_sports</code>.</p>
<ul>
<li>Passing the sport column to <code><a href="https://tidyr.tidyverse.org/reference/separate_rows.html" class="external-link">tidyr::separate_rows()</a></code> and <code><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">stringr::str_trim()</a></code> in <code>multp_sport_athletes</code> will create a <code>tidy_multp_sport_athletes</code> dataset:</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_multp_sport_athletes</span> <span class="op">&lt;-</span> <span class="va">multp_sport_athletes</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_rows.html" class="external-link">separate_rows</a></span><span class="op">(</span><span class="va">sport</span>, sep <span class="op">=</span> <span class="st">"and|, "</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sport <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_trim</a></span><span class="op">(</span><span class="va">sport</span>, side <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">tidy_multp_sport_athletes</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [23 × 9] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ athlete           : chr [1:23] "allison, kyler" "allison, kyler" "blandford, jenna" "blandford, jenna" ...</span></span>
<span><span class="co">#&gt;  $ sport             : chr [1:23] "bobsled" "skeleton" "cycling" "triathlon" ...</span></span>
<span><span class="co">#&gt;  $ substance_reason  : chr [1:23] "non-analytical: refusal to submit to sample collection" "non-analytical: refusal to submit to sample collection" "non-analytical: use and possession (testosterone, hgh and oxandrolone)" "non-analytical: use and possession (testosterone, hgh and oxandrolone)" ...</span></span>
<span><span class="co">#&gt;  $ sanction_terms    : chr [1:23] "4-year suspension; loss of results; sanction tolled due to retirement" "4-year suspension; loss of results; sanction tolled due to retirement" "4-year suspension - loss of results" "4-year suspension - loss of results" ...</span></span>
<span><span class="co">#&gt;  $ sanction_announced: chr [1:23] "10/09/2019" "10/09/2019" "11/28/2017" "11/28/2017" ...</span></span>
<span><span class="co">#&gt;  $ sanction_date     : Date[1:23], format: "2019-10-09" "2019-10-09" ...</span></span>
<span><span class="co">#&gt;  $ support_personnel : logi [1:23] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ paralympic        : logi [1:23] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ multiple_sports   : logi [1:23] TRUE TRUE TRUE TRUE TRUE TRUE ...</span></span></code></pre></div>
<p>Finally, combine the two datasets.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_sports</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">single_sport_athletes</span>, <span class="va">tidy_multp_sport_athletes</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">tidy_sports</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [661 × 9] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ athlete           : chr [1:661] "rodriguez, daniel" "park, mariah" "frey, john" "forrest, evan" ...</span></span>
<span><span class="co">#&gt;  $ sport             : chr [1:661] "mixed martial arts" "weightlifting" "cycling" "weightlifting" ...</span></span>
<span><span class="co">#&gt;  $ substance_reason  : chr [1:661] "ostarine; lgd-4033" "chlorthalidone" "non-analytical: refusal to submit to sample collection" "boldenone; drostanolone; methandienone; nandrolone; testosterone" ...</span></span>
<span><span class="co">#&gt;  $ sanction_terms    : chr [1:661] "3-month suspenion" "public warning" "2-year suspension; loss of results" "3-year suspension; loss of results" ...</span></span>
<span><span class="co">#&gt;  $ sanction_announced: chr [1:661] "12/14/2023" "12/11/2023" "12/05/2023" "11/30/2023" ...</span></span>
<span><span class="co">#&gt;  $ sanction_date     : Date[1:661], format: "2023-12-14" "2023-12-11" ...</span></span>
<span><span class="co">#&gt;  $ support_personnel : logi [1:661] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ paralympic        : logi [1:661] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ multiple_sports   : logi [1:661] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="clean_sports">
<strong>clean_sports()</strong><a class="anchor" aria-label="anchor" href="#clean_sports"></a>
</h3>
<p>These steps are combined in the <code><a href="reference/clean_sports.html">clean_sports()</a></code> function:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="reference/clean_sports.html">clean_sports</a></span><span class="op">(</span></span>
<span>    df <span class="op">=</span> <span class="va">usada_dates</span>, </span>
<span>    sport_col <span class="op">=</span> <span class="st">"sport"</span>, </span>
<span>    tidy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    661 obs. of  9 variables:</span></span>
<span><span class="co">#&gt;  $ athlete           : chr  "rodriguez, daniel" "park, mariah" "frey, john" "forrest, evan" ...</span></span>
<span><span class="co">#&gt;  $ sport             : chr  "mixed martial arts" "weightlifting" "cycling" "weightlifting" ...</span></span>
<span><span class="co">#&gt;  $ substance_reason  : chr  "ostarine; lgd-4033" "chlorthalidone" "non-analytical: refusal to submit to sample collection" "boldenone; drostanolone; methandienone; nandrolone; testosterone" ...</span></span>
<span><span class="co">#&gt;  $ sanction_terms    : chr  "3-month suspenion" "public warning" "2-year suspension; loss of results" "3-year suspension; loss of results" ...</span></span>
<span><span class="co">#&gt;  $ sanction_announced: chr  "12/14/2023" "12/11/2023" "12/05/2023" "11/30/2023" ...</span></span>
<span><span class="co">#&gt;  $ sanction_date     : Date, format: "2023-12-14" "2023-12-11" ...</span></span>
<span><span class="co">#&gt;  $ support_personnel : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ paralympic        : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ multiple_sports   : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span></code></pre></div>
<p>Verify there aren’t any duplicates (again).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_sports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="va">sanction_date</span>, <span class="va">sport</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">athlete</th>
<th align="left">sanction_date</th>
<th align="left">sport</th>
<th align="right">n</th>
</tr></thead>
<tbody></tbody>
</table>
</div>
<p>We can see the multi-sport athletes are listed in <code>tidy_sports</code> (but with one sport per row):</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_sports</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">multiple_sports</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="va">sport</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">athlete</th>
<th align="left">sport</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">allison, kyler</td>
<td align="left">bobsled</td>
</tr>
<tr class="even">
<td align="left">allison, kyler</td>
<td align="left">skeleton</td>
</tr>
<tr class="odd">
<td align="left">blandford, jenna</td>
<td align="left">cycling</td>
</tr>
<tr class="even">
<td align="left">blandford, jenna</td>
<td align="left">triathlon</td>
</tr>
<tr class="odd">
<td align="left">cruse, j.c.</td>
<td align="left">bobsled</td>
</tr>
<tr class="even">
<td align="left">cruse, j.c.</td>
<td align="left">skeleton</td>
</tr>
<tr class="odd">
<td align="left">schrodt, patrick “dillon”</td>
<td align="left">bobsled</td>
</tr>
<tr class="even">
<td align="left">schrodt, patrick “dillon”</td>
<td align="left">skeleton</td>
</tr>
<tr class="odd">
<td align="left">green, roderick</td>
<td align="left">paralympic track &amp; field</td>
</tr>
<tr class="even">
<td align="left">green, roderick</td>
<td align="left">paralympic volleyball</td>
</tr>
<tr class="odd">
<td align="left">denney phillips, jessica</td>
<td align="left">cycling</td>
</tr>
<tr class="even">
<td align="left">denney phillips, jessica</td>
<td align="left">weightlifting</td>
</tr>
<tr class="odd">
<td align="left">ives, kevin</td>
<td align="left">bobsled</td>
</tr>
<tr class="even">
<td align="left">ives, kevin</td>
<td align="left">skeleton</td>
</tr>
<tr class="odd">
<td align="left">teeple, sloan</td>
<td align="left">cycling</td>
</tr>
<tr class="even">
<td align="left">teeple, sloan</td>
<td align="left">triathlon</td>
</tr>
<tr class="odd">
<td align="left">flanagan, tyler</td>
<td align="left">skiing</td>
</tr>
<tr class="even">
<td align="left">flanagan, tyler</td>
<td align="left">snowboarding</td>
</tr>
<tr class="odd">
<td align="left">hamilton, tyler</td>
<td align="left">cycling</td>
</tr>
<tr class="even">
<td align="left">hamilton, tyler</td>
<td align="left">triathlon</td>
</tr>
<tr class="odd">
<td align="left">bailey, ryan</td>
<td align="left">bobsled</td>
</tr>
<tr class="even">
<td align="left">bailey, ryan</td>
<td align="left">skeleton</td>
</tr>
<tr class="odd">
<td align="left">bailey, ryan</td>
<td align="left">track &amp; field</td>
</tr>
</tbody>
</table>
</div>
<p>Export <code>tidy_sports</code> to <code>data-raw/</code></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/export_data.html">export_data</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">tidy_sports</span>, </span>
<span>  path <span class="op">=</span> <span class="st">"data-raw/csv"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Exporting data: data-raw/csv/2023-12-21/2023-12-21-tidy_sports.csv</span></span>
<span><span class="co">#&gt; Data successfully exported!</span></span></code></pre></div>
<p>Verify</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="st">"data-raw/csv"</span><span class="op">)</span></span>
<span><span class="co">#&gt; data-raw/csv</span></span>
<span><span class="co">#&gt; └── 2023-12-21</span></span>
<span><span class="co">#&gt;     ├── 2023-12-21-tidy_sports.csv</span></span>
<span><span class="co">#&gt;     ├── 2023-12-21-tidy_substances.csv</span></span>
<span><span class="co">#&gt;     ├── 2023-12-21-usada_dates.csv</span></span>
<span><span class="co">#&gt;     └── 2023-12-21-usada_raw.csv</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="substances">Substances<a class="anchor" aria-label="anchor" href="#substances"></a>
</h2>
<p>We’ll start by classifying ‘adverse analytic findings’ for a single banned substance. I’ve written a <code><a href="reference/get_recent_file.html">get_recent_file()</a></code> function to quickly import .csv files from a specified directory:</p>
<div class="section level3">
<h3 id="get_recent_file">
<strong>get_recent_file()</strong><a class="anchor" aria-label="anchor" href="#get_recent_file"></a>
</h3>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"data-raw/csv/"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/get_recent_file.html">get_recent_file</a></span><span class="op">(</span><span class="va">pth</span>, regex <span class="op">=</span> <span class="st">'sports'</span>, ext <span class="op">=</span> <span class="st">'.csv'</span><span class="op">)</span></span>
<span><span class="co">#&gt; File last changed: 2023-12-21 12:11:28.122484</span></span>
<span><span class="co">#&gt; File name: 2023-12-21-tidy_sports.csv</span></span>
<span><span class="co">#&gt; ✔ import code pasted to clipboard!</span></span></code></pre></div>
<p>This makes it easy to paste the necessary import code into the console (or R markdown file):</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_sports</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.delim</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'data-raw/csv/2023-12-21/2023-12-21-tidy_sports.csv'</span>, sep <span class="op">=</span> <span class="st">','</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="aafs-vs-adrvs">AAFs vs ADRVs<a class="anchor" aria-label="anchor" href="#aafs-vs-adrvs"></a>
</h4>
<p>The sanctions are divided into two categories:</p>
<ul>
<li><p><code>analytic</code>: <a href="https://www.usada.org/spirit-of-sport/education/alphabet-soup-results-management/#:~:text" class="external-link">Adverse Analytical Finding</a>, AAF; <em>An AAF is a report from a WADA-accredited laboratory that identifies the presence of a prohibited substance and/or its metabolites or markers in a sample.</em></p></li>
<li><p><code>non-analytic</code>: <a href="https://www.usada.org/spirit-of-sport/education/non-analytical-anti-doping-rule-violations/" class="external-link">Non-Analytical Anti-doping Rule Violation</a> ADRV; <em>a non-analytical anti-doping rule violation does not stem from a positive urine or blood sample, but instead originates from, and is substantiated by, other evidence of doping or violations by an athlete or athlete support personnel.</em>.</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="substancereason">Substance/reason<a class="anchor" aria-label="anchor" href="#substancereason"></a>
</h4>
<p>The <code>substance_reason</code> column contains the details of the sanction, which can include the following information:</p>
<ol style="list-style-type: decimal">
<li><p>The name of the banned substance</p></li>
<li><p>A description of the infraction (if non-analytic)</p></li>
</ol>
<p>We will use regular expressions to identify the type of substance behind the sanction. See the examples below:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view</a></span><span class="op">(</span><span class="va">tidy_sports</span><span class="op">[[</span><span class="st">'substance_reason'</span><span class="op">]</span><span class="op">]</span>, </span>
<span>  <span class="st">"use \\(epo &amp; hgh\\)"</span>, match <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [638] │ erythropoietin (epo) and non-analytical: &lt;use (epo &amp; hgh)&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view</a></span><span class="op">(</span><span class="va">tidy_sports</span><span class="op">[[</span><span class="st">'substance_reason'</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="st">"tampering, complicity"</span>, match <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [85] │ non-analytical: &lt;tampering, complicity&gt;</span></span></code></pre></div>
<p>Most of the non-analytic sanctions include the terms <code>non-analytic</code>/<code>non-analytical</code>/etc., as a prefix in the <code>substance_reason</code> column.</p>
<div class="section level5">
<h5 id="sanction_type">
<strong><code>sanction_type</code></strong><a class="anchor" aria-label="anchor" href="#sanction_type"></a>
</h5>
<p>I can pass these terms as regular expressions to create the <code>sanction_type</code> variable, which will contain two values: <code>non-analytic</code> and <code>analytic</code>. I’ll save this variable in a new the <code>usada_substances</code> dataset:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_substances</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">tidy_sports</span>,</span>
<span>    sanction_type <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">substance_reason</span>,</span>
<span>        <span class="st">"non-analytical"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"non-analytic"</span>,</span>
<span>      <span class="op">!</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">substance_reason</span>,</span>
<span>        <span class="st">"non-analytical"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"analytic"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">usada_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">sanction_type</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">sanction_type</th>
<th align="right">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">analytic</td>
<td align="right">498</td>
</tr>
<tr class="even">
<td align="left">non-analytic</td>
<td align="right">163</td>
</tr>
</tbody>
</table>
</div>
<p>Now I can filter <code>usada_substances</code> to the <code>analytical</code> sanctions in <code>sanction_type</code>.</p>
<p><em>How can I identify the single vs. multiple substances?</em></p>
<p>Let’s take a look at four different sanctions in <code>example_sanction_type</code>:</p>
<div class="kable-table">
<table class="table">
<colgroup>
<col width="20%">
<col width="80%">
</colgroup>
<thead><tr class="header">
<th align="left">sport</th>
<th align="left">substance_reason</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">swimming</td>
<td align="left">non-analytical: 3 whereabouts failures</td>
</tr>
<tr class="even">
<td align="left">track &amp; field</td>
<td align="left">cannabinoids</td>
</tr>
<tr class="odd">
<td align="left">triathlon</td>
<td align="left">androgenic anabolic steroid; cannabinoids</td>
</tr>
<tr class="even">
<td align="left">track &amp; field</td>
<td align="left">non-analytical: tampering, administration, and trafficking</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level5">
<h5 id="substance_cat">
<strong><code>substance_cat</code></strong><a class="anchor" aria-label="anchor" href="#substance_cat"></a>
</h5>
<p>We can see two analytic and two non-analytic sanctions, and each one has a single or multiple substance/reason. Fortunately, the sanctions with multiple items are separated by either semicolons (<code>;</code>), commas (<code>,</code>), or a conjunction (<code>and</code>), so I can use a regular expression to separate the items.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">example_sanction_type</span>,</span>
<span>  substance_cat <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="co"># identify the multiple_sr substances using a regular expression</span></span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="st">"; |, | and | &amp; | / "</span><span class="op">)</span> <span class="op">~</span> <span class="st">'multiple'</span>,</span>
<span>    <span class="co"># negate the regular expression for the single substances</span></span>
<span>    <span class="op">!</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="st">"; |, | and | &amp; | / "</span><span class="op">)</span> <span class="op">~</span> <span class="st">'single'</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">substance_cat</span>, <span class="va">substance_reason</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">substance_cat</span>, values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<colgroup>
<col width="76%">
<col width="12%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left">substance_reason</th>
<th align="right">multiple</th>
<th align="right">single</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">androgenic anabolic steroid; cannabinoids</td>
<td align="right">1</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">non-analytical: tampering, administration, and trafficking</td>
<td align="right">1</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">cannabinoids</td>
<td align="right">NA</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">non-analytical: 3 whereabouts failures</td>
<td align="right">NA</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
<p>The <code>substance_cat</code> identifier can be used to separate sanctions with multiple substance/reasons from sanctions with a single substance or reason.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_substances</span> <span class="op">&lt;-</span> <span class="va">usada_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>substance_cat <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="st">"; |, | and | &amp; | / "</span><span class="op">)</span> <span class="op">~</span> <span class="st">'multiple'</span>,</span>
<span>    <span class="op">!</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="st">"; |, | and | &amp; | / "</span><span class="op">)</span> <span class="op">~</span> <span class="st">'single'</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">usada_substances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">substance_cat</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">substance_cat</th>
<th align="right">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">single</td>
<td align="right">478</td>
</tr>
<tr class="even">
<td align="left">multiple</td>
<td align="right">183</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="single-analytic-substances">Single analytic substances<a class="anchor" aria-label="anchor" href="#single-analytic-substances"></a>
</h3>
<p>First create a dataset that contains the sanctions with a single substance listed.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">single_analytic_substances</span> <span class="op">&lt;-</span> <span class="va">usada_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">substance_cat</span> <span class="op">==</span> <span class="st">'single'</span> <span class="op">&amp;</span> <span class="va">sanction_type</span> <span class="op">==</span> <span class="st">"analytic"</span><span class="op">)</span></span></code></pre></div>
<p>View the top ten single analytic substances:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">single_analytic_substances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">substance_reason</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">substance_reason</th>
<th align="right">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">androgenic anabolic steroid</td>
<td align="right">49</td>
</tr>
<tr class="even">
<td align="left">cannabinoids</td>
<td align="right">38</td>
</tr>
<tr class="odd">
<td align="left">ostarine</td>
<td align="right">37</td>
</tr>
<tr class="even">
<td align="left">clomiphene</td>
<td align="right">18</td>
</tr>
<tr class="odd">
<td align="left">methylhexaneamine</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">stanozolol</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">testosterone</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">furosemide</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">spironolactone</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">dehydroepiandrosterone (dhea)</td>
<td align="right">7</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="multiple-analytic-substances">Multiple analytic substances<a class="anchor" aria-label="anchor" href="#multiple-analytic-substances"></a>
</h3>
<p>Next create a dataset with the sanctions listing multiple substances in <code>substance_reason</code>. Store these in <code>multiple_analytic_substances</code>.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multiple_analytic_substances</span> <span class="op">&lt;-</span> <span class="va">usada_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">substance_cat</span> <span class="op">==</span> <span class="st">'multiple'</span> <span class="op">&amp;</span> <span class="va">sanction_type</span> <span class="op">==</span> <span class="st">"analytic"</span><span class="op">)</span></span></code></pre></div>
<p>View the top ten multiple analytic substances:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multiple_analytic_substances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">substance_reason</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">substance_reason</th>
<th align="right">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">hydrochlorothiazide and chlorothiazide</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">19-norandrosterone (19-na) and 19-noretiocholanolone</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">clomiphene and its metabolite</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">ostarine; lgd-4033</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">androgenic anabolic steroid &amp; 19-norandrosterone (19-na)</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">androgenic anabolic steroid and modafinil</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">benzoylecgonine and methylecgonine</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">hydrochlorothiazide &amp; chlorothiazide</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">methylphenidate and its metabolite</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">ostarine; lgd-4033; gw1516</td>
<td align="right">2</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="tidy-substances">Tidy substances<a class="anchor" aria-label="anchor" href="#tidy-substances"></a>
</h4>
<p>Tidying the sanctions with multiple <a href="https://www.wada-ama.org/en/prohibited-list?q" class="external-link">WADA banned substances</a> (i.e., one substance per athlete per row) will result in certain athletes appearing in the dataset more than once. The regular expressions below cover a range of semicolons, tabs, and spaces to identify and separate each substance.</p>
</div>
<div class="section level4">
<h4 id="add_match_col">
<strong>add_match_col()</strong><a class="anchor" aria-label="anchor" href="#add_match_col"></a>
</h4>
<p>I’ve written the <code><a href="reference/add_match_col.html">add_match_col()</a></code> function, which creates a new <code>'matched'</code> column with the matched regular expression pattern (it’s like <code>str_view()</code>, but in a <code>data.frame</code>/<code>tibble</code>). I used <code><a href="reference/add_match_col.html">add_match_col()</a></code> while determining the correct pattern to match on (i.e., any substances listing <code>metabolites</code>):</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">multiple_analytic_substances</span>,</span>
<span>  <span class="co"># add matched column</span></span>
<span>  matched <span class="op">=</span> <span class="fu"><a href="reference/add_match_col.html">add_match_col</a></span><span class="op">(</span></span>
<span>    string <span class="op">=</span> <span class="va">substance_reason</span>, </span>
<span>    pattern <span class="op">=</span> <span class="st">"and its metabolite|and its metabolites|its metabolite"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">last_col</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">matched</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<colgroup>
<col width="79%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="left">substance_reason</th>
<th align="left">matched</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">clomiphene and its metabolite</td>
<td align="left">and, its, metabolite</td>
</tr>
<tr class="even">
<td align="left">clomiphene and its metabolite</td>
<td align="left">and, its, metabolite</td>
</tr>
<tr class="odd">
<td align="left">clomiphene and its metabolite</td>
<td align="left">and, its, metabolite</td>
</tr>
<tr class="even">
<td align="left">1-androstenedione and its metabolite</td>
<td align="left">and, its, metabolite</td>
</tr>
<tr class="odd">
<td align="left">oxandrolone and its metabolite</td>
<td align="left">and, its, metabolite</td>
</tr>
<tr class="even">
<td align="left">stanozolol and its metabolites</td>
<td align="left">and, its, metabolites</td>
</tr>
<tr class="odd">
<td align="left">19-norandrosterone (19-na), drostanolone and its metabolites, and epitrenbolone</td>
<td align="left">and, its, metabolites</td>
</tr>
<tr class="even">
<td align="left">19-norandrosterone (19-na), 19-noretiocholanolone, and drostanolone and its metabolites</td>
<td align="left">and, its, metabolites</td>
</tr>
<tr class="odd">
<td align="left">clenbuterol, and oxandrolone and its metabolite</td>
<td align="left">and, its, metabolite</td>
</tr>
<tr class="even">
<td align="left">methylphenidate and its metabolite</td>
<td align="left">and, its, metabolite</td>
</tr>
<tr class="odd">
<td align="left">methylphenidate and its metabolite</td>
<td align="left">and, its, metabolite</td>
</tr>
</tbody>
</table>
</div>
<p>The rows above are all matching correctly on the regular expression pattern.</p>
<p>Below is a regular expression to differentiate the multiple substances on a sample from <code>multiple_analytic_substances</code>. This pattern will be passed to <code><a href="https://tidyr.tidyverse.org/reference/separate_rows.html" class="external-link">tidyr::separate_rows()</a></code> (similar to multiple-sport athletes above).</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html" class="external-link">sample_n</a></span><span class="op">(</span><span class="va">multiple_analytic_substances</span>, size <span class="op">=</span> <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># replace plurals</span></span>
<span>      substance_reason <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="va">substance_reason</span>,</span>
<span>        <span class="st">"and its metabolite|and its metabolites|its metabolite"</span>,</span>
<span>        <span class="st">"(metabolite)"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_rows.html" class="external-link">separate_rows</a></span><span class="op">(</span><span class="va">substance_reason</span>, </span>
<span>        sep <span class="op">=</span> <span class="st">"; |;\t|\\t|, |;| and |and a |and | &amp; | / "</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="va">substance_reason</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<colgroup>
<col width="21%">
<col width="78%">
</colgroup>
<thead><tr class="header">
<th align="left">athlete</th>
<th align="left">substance_reason</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">leogrande, kayle</td>
<td align="left">raloxifene</td>
</tr>
<tr class="even">
<td align="left">leogrande, kayle</td>
<td align="left">ostarine</td>
</tr>
<tr class="odd">
<td align="left">leogrande, kayle</td>
<td align="left">ibutamoren</td>
</tr>
<tr class="even">
<td align="left">leogrande, kayle</td>
<td align="left">gw1516 sulfone</td>
</tr>
<tr class="odd">
<td align="left">leogrande, kayle</td>
<td align="left">rad140</td>
</tr>
<tr class="even">
<td align="left">leogrande, kayle</td>
<td align="left">lgd4033</td>
</tr>
<tr class="odd">
<td align="left">leogrande, kayle</td>
<td align="left">andarine</td>
</tr>
<tr class="even">
<td align="left">smolyakov, dmitry</td>
<td align="left">recombinant human erythropoietin (rhuepo)</td>
</tr>
<tr class="odd">
<td align="left">smolyakov, dmitry</td>
<td align="left">intact human chorionic gonadtrophin (hcg)</td>
</tr>
<tr class="even">
<td align="left">storie, logan</td>
<td align="left">ostarine</td>
</tr>
<tr class="odd">
<td align="left">storie, logan</td>
<td align="left">lgd‐4033</td>
</tr>
<tr class="even">
<td align="left">storie, logan</td>
<td align="left">gw1516</td>
</tr>
<tr class="odd">
<td align="left">schober, zachary</td>
<td align="left">amphetamine</td>
</tr>
<tr class="even">
<td align="left">schober, zachary</td>
<td align="left">methylphenidate</td>
</tr>
<tr class="odd">
<td align="left">schober, zachary</td>
<td align="left">gw1516</td>
</tr>
<tr class="even">
<td align="left">maynard, nicole</td>
<td align="left">methenolone</td>
</tr>
<tr class="odd">
<td align="left">maynard, nicole</td>
<td align="left">lgd‐4033</td>
</tr>
<tr class="even">
<td align="left">maynard, nicole</td>
<td align="left">gw1516</td>
</tr>
<tr class="odd">
<td align="left">lewis-parry, chi</td>
<td align="left">drostanolone</td>
</tr>
<tr class="even">
<td align="left">lewis-parry, chi</td>
<td align="left">stanozolol</td>
</tr>
<tr class="odd">
<td align="left">lewis-parry, chi</td>
<td align="left">dehydrochloromethyltestosterone (dhcmt)</td>
</tr>
<tr class="even">
<td align="left">lewis-parry, chi</td>
<td align="left">tampering</td>
</tr>
<tr class="odd">
<td align="left">schiefer, john</td>
<td align="left">clomiphene (metabolite)</td>
</tr>
<tr class="even">
<td align="left">roehrick, nick</td>
<td align="left">clomiphene (metabolite)</td>
</tr>
<tr class="odd">
<td align="left">maia, jennifer</td>
<td align="left">furosemide</td>
</tr>
<tr class="even">
<td align="left">maia, jennifer</td>
<td align="left">hydrochlorothiazide</td>
</tr>
<tr class="odd">
<td align="left">maia, jennifer</td>
<td align="left">chlorothiazide</td>
</tr>
<tr class="even">
<td align="left">maia, jennifer</td>
<td align="left">thiazide metabolite 4-amino-6-chloro-1,3-benzenedisulfonamide (acb)</td>
</tr>
<tr class="odd">
<td align="left">rybka, jason</td>
<td align="left">methasterone</td>
</tr>
<tr class="even">
<td align="left">rybka, jason</td>
<td align="left">ostarine</td>
</tr>
<tr class="odd">
<td align="left">rybka, jason</td>
<td align="left">androstatrienedione</td>
</tr>
</tbody>
</table>
</div>
<p>The final step trims the white space from the tidy <code>substance_reason</code> column. The output will be stored in <code>tidy_multiple_substances</code>.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_multiple_substances</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">multiple_analytic_substances</span>,</span>
<span>  <span class="co"># replace plurals</span></span>
<span>    substance_reason <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="va">substance_reason</span>,</span>
<span>      <span class="st">"and its metabolite|and its metabolites|its metabolite"</span>,</span>
<span>      <span class="st">"(metabolite)"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_rows.html" class="external-link">separate_rows</a></span><span class="op">(</span><span class="va">substance_reason</span>, </span>
<span>      sep <span class="op">=</span> <span class="st">"; |;\t|\\t|, |;| and |and a |and | &amp; | / "</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>substance_reason <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/trimws.html" class="external-link">trimws</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="st">"both"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now that we have both single and multiple substances in tidy formats, we can bind them together into a single <code>tidy_substances</code> dataset.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">single_analytic_substances</span>, <span class="va">tidy_multiple_substances</span><span class="op">)</span> </span></code></pre></div>
<p>The top 10 substances are below:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">substance_reason</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">substance_reason</th>
<th align="right">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">androgenic anabolic steroid</td>
<td align="right">65</td>
</tr>
<tr class="even">
<td align="left">ostarine</td>
<td align="right">60</td>
</tr>
<tr class="odd">
<td align="left">cannabinoids</td>
<td align="right">41</td>
</tr>
<tr class="even">
<td align="left">clomiphene</td>
<td align="right">31</td>
</tr>
<tr class="odd">
<td align="left">gw1516</td>
<td align="right">17</td>
</tr>
<tr class="even">
<td align="left">hydrochlorothiazide</td>
<td align="right">17</td>
</tr>
<tr class="odd">
<td align="left">stanozolol</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="left">testosterone</td>
<td align="right">16</td>
</tr>
<tr class="odd">
<td align="left">19-norandrosterone (19-na)</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">methylhexaneamine</td>
<td align="right">14</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section level3">
<h3 id="classifying-substances">Classifying substances<a class="anchor" aria-label="anchor" href="#classifying-substances"></a>
</h3>
<p>To identify the <a href="https://www.wada-ama.org/en/prohibited-list#search-anchor" class="external-link">WADA banned substances</a>, I’ve written <code><a href="reference/classify_wada_substances.html">classify_wada_substances()</a></code>, a function that scans the <code>substance_reason</code> column and identifies any substances found on the <a href="https://www.wada-ama.org/sites/default/files/2022-09/2023list_en_final_9_september_2022.pdf" class="external-link">WADA list</a>. See the <code><a href="reference/classify_wada_substances.html">classify_wada_substances()</a></code> documentation for more information.</p>
<div class="section level4">
<h4 id="classify_wada_substances">
<strong>classify_wada_substances()</strong><a class="anchor" aria-label="anchor" href="#classify_wada_substances"></a>
</h4>
<p><code><a href="reference/classify_wada_substances.html">classify_wada_substances()</a></code> creates a <code>substance_group</code> variable with each of the WADA classifications (stored in <code>dopingdata::wada_classes</code>):</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dopingdata</span><span class="fu">::</span><span class="va">wada_classes</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">Classification</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">S1 ANABOLIC AGENTS</td>
</tr>
<tr class="even">
<td align="left">S2 PEP HORMONES/G FACTORS/MIMETICS</td>
</tr>
<tr class="odd">
<td align="left">S3 BETA-2 AGONISTS</td>
</tr>
<tr class="even">
<td align="left">S4 HORMONE AND METABOLIC MODULATORS</td>
</tr>
<tr class="odd">
<td align="left">S5 DIURETICS/MASKING AGENTS</td>
</tr>
<tr class="even">
<td align="left">S6 STIMULANTS</td>
</tr>
<tr class="odd">
<td align="left">S7 NARCOTICS</td>
</tr>
<tr class="even">
<td align="left">S8 CANNABINOIDS</td>
</tr>
<tr class="odd">
<td align="left">S9 GLUCOCORTICOIDS</td>
</tr>
<tr class="even">
<td align="left">S0 UNAPPROVED SUBSTANCES</td>
</tr>
<tr class="odd">
<td align="left">M1 MANIPULATION OF BLOOD</td>
</tr>
<tr class="even">
<td align="left">M2 CHEMICAL AND PHYSICAL MANIPULATION</td>
</tr>
<tr class="odd">
<td align="left">M3 GENE AND CELL DOPING</td>
</tr>
<tr class="even">
<td align="left">P1 BETA-BLOCKERS</td>
</tr>
</tbody>
</table>
</div>
<p><code>dopingdata</code> stores vectors with each substance group in the WADA list (the <code>S1 ANABOLIC AGENTS</code> substances are below):</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">dopingdata</span><span class="fu">::</span><span class="va">s1_substances</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "3α-hydroxy-5α-androst-1-en-17-one"              </span></span>
<span><span class="co">#&gt;  [2] "androgenic anabolic steroid"                    </span></span>
<span><span class="co">#&gt;  [3] "androgenic anabolic steroids"                   </span></span>
<span><span class="co">#&gt;  [4] "anabolic agent"                                 </span></span>
<span><span class="co">#&gt;  [5] "anabolic agents"                                </span></span>
<span><span class="co">#&gt;  [6] "anabolic steroid"                               </span></span>
<span><span class="co">#&gt;  [7] "anabolic steroids"                              </span></span>
<span><span class="co">#&gt;  [8] "androstenedione"                                </span></span>
<span><span class="co">#&gt;  [9] "metabolites of androstenedione"                 </span></span>
<span><span class="co">#&gt; [10] "1-androstenediol (5α-androst-1-ene-3β,17β-diol)"</span></span></code></pre></div>
<p>The substance group vectors are also stored as regular expressions (<code>s1_regex</code>), which we can use to match the <code>substance_reason</code> column on (see the example using <code>dopingdata::example_tidy_substances</code> dataset):</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">example_tidy_substances</span><span class="op">$</span><span class="va">substance_reason</span>,</span>
<span>  pattern <span class="op">=</span> <span class="va">s1_regex</span>, match <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [10] │ &lt;androgenic anabolic steroid&gt;</span></span></code></pre></div>
<p>The output from <code><a href="reference/classify_wada_substances.html">classify_wada_substances()</a></code> can be used to answer questions like: <em>what <code>substance_group</code>’s appear the most?</em></p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/classify_wada_substances.html">classify_wada_substances</a></span><span class="op">(</span></span>
<span>  usada_data <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  subs_column <span class="op">=</span> <span class="st">"substance_reason"</span><span class="op">)</span> </span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="unclassified-single-substances">
<code>UNCLASSIFIED</code> single substances<a class="anchor" aria-label="anchor" href="#unclassified-single-substances"></a>
</h3>
<p>The following <code>single</code> substances are marked as <code>UNCLASSIFIED</code>:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>      <span class="va">substance_cat</span> <span class="op">==</span> <span class="st">"single"</span> <span class="op">&amp;</span> </span>
<span>      <span class="va">substance_group</span> <span class="op">==</span> <span class="st">"UNCLASSIFIED"</span> <span class="op">&amp;</span> </span>
<span>      <span class="va">substance_reason</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="va">substance_reason</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">athlete</th>
<th align="left">substance_reason</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">rodriguez, yair</td>
<td align="left">3 whereabouts failures</td>
</tr></tbody>
</table>
</div>
<p>The final unclassified substance is actually a result from a miss-classified sanction type (for <code>rodriguez, yair</code>).</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">athlete</span> <span class="op">==</span> <span class="st">"rodriguez, yair"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="va">substance_reason</span>, <span class="va">substance_group</span>, <span class="va">sanction_type</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<colgroup>
<col width="23%">
<col width="32%">
<col width="23%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="left">athlete</th>
<th align="left">substance_reason</th>
<th align="left">substance_group</th>
<th align="left">sanction_type</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">rodriguez, yair</td>
<td align="left">3 whereabouts failures</td>
<td align="left">UNCLASSIFIED</td>
<td align="left">analytic</td>
</tr></tbody>
</table>
</div>
<p>For this particular athlete, the <code>sanction_type</code> should be <code>non-analytic</code>, and the <code>substance_group</code> should be missing (<code>NA_character_</code>)</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="va">tidy_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sanction_type <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">athlete</span> <span class="op">==</span> <span class="st">"rodriguez, yair"</span> <span class="op">~</span> <span class="st">"non-analytic"</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">sanction_type</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>substance_group <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="va">athlete</span> <span class="op">==</span> <span class="st">"rodriguez, yair"</span> <span class="op">~</span> <span class="cn">NA_character_</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">substance_group</span></span>
<span>  <span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">tidy_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">athlete</span> <span class="op">==</span> <span class="st">"rodriguez, yair"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="va">substance_reason</span>, <span class="va">substance_group</span>, <span class="va">sanction_type</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<colgroup>
<col width="23%">
<col width="32%">
<col width="23%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="left">athlete</th>
<th align="left">substance_reason</th>
<th align="left">substance_group</th>
<th align="left">sanction_type</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">rodriguez, yair</td>
<td align="left">3 whereabouts failures</td>
<td align="left">NA</td>
<td align="left">non-analytic</td>
</tr></tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="unclassified-multiple-substances">
<code>UNCLASSIFIED</code> multiple substances<a class="anchor" aria-label="anchor" href="#unclassified-multiple-substances"></a>
</h3>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>      <span class="va">substance_cat</span> <span class="op">==</span> <span class="st">"multiple"</span> <span class="op">&amp;</span> </span>
<span>      <span class="va">substance_group</span> <span class="op">==</span> <span class="st">"UNCLASSIFIED"</span> <span class="op">&amp;</span> </span>
<span>      <span class="va">substance_reason</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">substance_reason</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">substance_reason</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">arimistane</td>
</tr>
<tr class="even">
<td align="left">torasemide</td>
</tr>
<tr class="odd">
<td align="left">possession</td>
</tr>
<tr class="even">
<td align="left">use/attempted use</td>
</tr>
<tr class="odd">
<td align="left">evading sample collection</td>
</tr>
<tr class="even">
<td align="left">igf-1</td>
</tr>
<tr class="odd">
<td align="left">human chorionic gonadotropin (hcg)</td>
</tr>
<tr class="even">
<td align="left">aod-9064</td>
</tr>
<tr class="odd">
<td align="left">s-23</td>
</tr>
<tr class="even">
<td align="left">intact human chorionic gonadtrophin (hcg)</td>
</tr>
<tr class="odd">
<td align="left">thiazide metabolite 4-amino-6-chloro-1,3-benzenedisulfonamide (acb)</td>
</tr>
<tr class="even">
<td align="left">methylecgonine</td>
</tr>
<tr class="odd">
<td align="left">propylhexadrine</td>
</tr>
<tr class="even">
<td align="left">androst-(2,3)-en-17-one</td>
</tr>
<tr class="odd">
<td align="left">promagnon</td>
</tr>
<tr class="even">
<td align="left">non-anatlyical: administration</td>
</tr>
<tr class="odd">
<td align="left">trafficking</td>
</tr>
<tr class="even">
<td align="left">human chorionic gonadotrophin (hcg)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="re-classifying-substances">Re-classifying substances<a class="anchor" aria-label="anchor" href="#re-classifying-substances"></a>
</h3>
<p>The substances that were not classified using the standard WADA list can be added with <code><a href="reference/reclass_substance.html">reclass_substance()</a></code></p>
<div class="section level4">
<h4 id="reclass_substance">
<strong>reclass_substance()</strong><a class="anchor" aria-label="anchor" href="#reclass_substance"></a>
</h4>
<p><code><a href="reference/reclass_substance.html">reclass_substance()</a></code> takes a <code>df</code>, <code>substance</code>, and <code>value</code> (these substances can also added to their relative vector and regular expression in <code>data-raw/</code>).</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># arimistane ----</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"arimistane"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S4 HORMONE AND METABOLIC MODULATORS"</span><span class="op">)</span></span>
<span><span class="co"># torasemide ----</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"torasemide"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S5 DIURETICS/MASKING AGENTS"</span><span class="op">)</span></span>
<span><span class="co"># igf-1 ----</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"igf-1"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S2 PEP HORMONES/G FACTORS/MIMETICS"</span><span class="op">)</span></span>
<span><span class="co"># human chorionic gonadotropin (hcg)  ----</span></span>
<span><span class="co"># https://www.usada.org/athletes/antidoping101/athlete-guide-anti-doping/</span></span>
<span><span class="co"># https://www.usada.org/spirit-of-sport/education/wellness-and-anti-aging-clinics/</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"^human chorionic gonadotropin \\(hcg\\)$"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S2 PEP HORMONES/G FACTORS/MIMETICS"</span><span class="op">)</span></span>
<span><span class="co"># intact human chorionic gonadtrophin (hcg)  ----</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"^intact human chorionic gonadtrophin \\(hcg\\)$"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S2 PEP HORMONES/G FACTORS/MIMETICS"</span><span class="op">)</span></span>
<span><span class="co"># aod-9064  ----</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"aod-9064"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S2 PEP HORMONES/G FACTORS/MIMETICS"</span><span class="op">)</span></span>
<span><span class="co"># s-23  ----</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"s-23"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S1 ANABOLIC AGENTS"</span><span class="op">)</span></span>
<span><span class="co"># methenolone  ----</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"methenolone"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S1 ANABOLIC AGENTS"</span><span class="op">)</span></span>
<span><span class="co"># thiazide metabolite 4-amino-6-chloro-1,3-benzenedisulfonamide (acb)  ----</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"^thiazide metabolite 4-amino-6-chloro-1,3-benzenedisulfonamide \\(acb\\)$"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S5 DIURETICS/MASKING AGENTS"</span><span class="op">)</span></span>
<span><span class="co"># methylecgonine  ----</span></span>
<span><span class="co"># https://www.usada.org/sanction/mike-alexandrov-accepts-doping-sanction/</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"methylecgonine"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S6 STIMULANTS"</span><span class="op">)</span></span>
<span><span class="co"># propylhexadrine  ----</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"propylhexadrine"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S6 STIMULANTS"</span><span class="op">)</span></span>
<span><span class="co"># androst-(2,3)-en-17-one  ----</span></span>
<span><span class="co"># this needs an anchor </span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"androst-\\(2,3\\)-en-17-one"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S1 ANABOLIC AGENTS"</span><span class="op">)</span></span>
<span><span class="co"># promagnon  ----</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"promagnon"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S1 ANABOLIC AGENTS"</span><span class="op">)</span></span>
<span><span class="co"># human chorionic gonadotrophin (hcg)  ----</span></span>
<span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/reclass_substance.html">reclass_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">tidy_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"human chorionic gonadotrophin \\(hcg\\)"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S2 PEP HORMONES/G FACTORS/MIMETICS"</span><span class="op">)</span></span></code></pre></div>
<p>After reclassifying the substances above, we can review the remaining <code>UNCLASSIFIED</code>/<code>multiple</code> sanctions:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>      <span class="va">substance_cat</span> <span class="op">==</span> <span class="st">"multiple"</span> <span class="op">&amp;</span> </span>
<span>      <span class="va">substance_group</span> <span class="op">==</span> <span class="st">"UNCLASSIFIED"</span> <span class="op">&amp;</span> </span>
<span>      <span class="va">substance_reason</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">substance_reason</span><span class="op">)</span> </span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">substance_reason</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">possession</td>
</tr>
<tr class="even">
<td align="left">use/attempted use</td>
</tr>
<tr class="odd">
<td align="left">evading sample collection</td>
</tr>
<tr class="even">
<td align="left">non-anatlyical: administration</td>
</tr>
<tr class="odd">
<td align="left">trafficking</td>
</tr>
</tbody>
</table>
</div>
<p>These remaining <code>UNCLASSIFIED</code> substances should be marked as non-analytic sanctions in <code>sanction_type</code>:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="va">tidy_substances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    sanction_type <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">substance_group</span> <span class="op">==</span> <span class="st">"UNCLASSIFIED"</span> <span class="op">&amp;</span> <span class="va">substance_reason</span> <span class="op">==</span> <span class="st">"possession"</span> <span class="op">~</span> <span class="st">"non-analytic"</span>,</span>
<span>      <span class="va">substance_group</span> <span class="op">==</span> <span class="st">"UNCLASSIFIED"</span> <span class="op">&amp;</span> <span class="va">substance_reason</span> <span class="op">==</span> <span class="st">"use/attempted use"</span> <span class="op">~</span> <span class="st">"non-analytic"</span>,</span>
<span>      <span class="va">substance_group</span> <span class="op">==</span> <span class="st">"UNCLASSIFIED"</span> <span class="op">&amp;</span> <span class="va">substance_reason</span> <span class="op">==</span> <span class="st">"evading sample collection"</span> <span class="op">~</span> <span class="st">"non-analytic"</span>,</span>
<span>      <span class="va">substance_group</span> <span class="op">==</span> <span class="st">"UNCLASSIFIED"</span> <span class="op">&amp;</span> <span class="va">substance_reason</span> <span class="op">==</span> <span class="st">"non-anatlyical: administration"</span> <span class="op">~</span> <span class="st">"non-analytic"</span>,</span>
<span>      <span class="va">substance_group</span> <span class="op">==</span> <span class="st">"UNCLASSIFIED"</span> <span class="op">&amp;</span> <span class="va">substance_reason</span> <span class="op">==</span> <span class="st">"trafficking"</span> <span class="op">~</span> <span class="st">"non-analytic"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">sanction_type</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<p>And non-analytic sanctions should have missing (<code>NA_character_</code>) values for <code>substance_group</code>:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="va">tidy_substances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    substance_group <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">sanction_type</span> <span class="op">==</span> <span class="st">"non-analytic"</span> <span class="op">~</span> <span class="cn">NA_character_</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">substance_group</span><span class="op">)</span></span>
<span>    <span class="op">)</span> </span></code></pre></div>
<p>And we can remove the missing <code>substance_reason</code> values</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tidy_substances</span>, <span class="va">substance_reason</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p>Now all the substances have been properly classified as <a href="https://www.usada.org/spirit-of-sport/education/alphabet-soup-results-management/#:~:text" class="external-link">Adverse Analytical Findings</a>.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">sanction_type</span>, <span class="va">substance_group</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">sanction_type</span>, values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">substance_group</th>
<th align="right">analytic</th>
<th align="right">non-analytic</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">M1 MANIPULATION OF BLOOD</td>
<td align="right">3</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">M2 CHEMICAL AND PHYSICAL MANIPULATION</td>
<td align="right">1</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">P1 BETA-BLOCKERS</td>
<td align="right">2</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">S0 UNAPPROVED SUBSTANCES</td>
<td align="right">1</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">S1 ANABOLIC AGENTS</td>
<td align="right">326</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">S2 PEP HORMONES/G FACTORS/MIMETICS</td>
<td align="right">42</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">S3 BETA-2 AGONISTS</td>
<td align="right">12</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">S4 HORMONE AND METABOLIC MODULATORS</td>
<td align="right">81</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">S5 DIURETICS/MASKING AGENTS</td>
<td align="right">67</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">S6 STIMULANTS</td>
<td align="right">95</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">S7 NARCOTICS</td>
<td align="right">3</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">S8 CANNABINOIDS</td>
<td align="right">41</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">S9 GLUCOCORTICOIDS</td>
<td align="right">8</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
</div>
<p>And the <code>non-analytic</code> sanctions are truly <a href="https://www.usada.org/spirit-of-sport/education/non-analytical-anti-doping-rule-violations/" class="external-link">Non-Analytical Anti-doping Rule Violations</a>.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">tidy_substances</span>, <span class="va">sanction_type</span> <span class="op">==</span> <span class="st">"non-analytic"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="va">substance_cat</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">substance_cat</span>, values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">substance_reason</th>
<th align="right">single</th>
<th align="right">multiple</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">3 whereabouts failures</td>
<td align="right">1</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">evading sample collection</td>
<td align="right">NA</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">non-anatlyical: administration</td>
<td align="right">NA</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">possession</td>
<td align="right">NA</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">trafficking</td>
<td align="right">NA</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">use/attempted use</td>
<td align="right">NA</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
<p>Export <code>tidy_substances</code> to <code>data-raw/</code></p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/export_data.html">export_data</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">tidy_substances</span>, </span>
<span>  path <span class="op">=</span> <span class="st">"data-raw/csv"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Exporting data: data-raw/csv/2023-12-21/2023-12-21-tidy_substances.csv</span></span>
<span><span class="co">#&gt; Data successfully exported!</span></span></code></pre></div>
<p>Verify</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="st">"data-raw/csv"</span><span class="op">)</span></span>
<span><span class="co">#&gt; data-raw/csv</span></span>
<span><span class="co">#&gt; └── 2023-12-21</span></span>
<span><span class="co">#&gt;     ├── 2023-12-21-tidy_sports.csv</span></span>
<span><span class="co">#&gt;     ├── 2023-12-21-tidy_substances.csv</span></span>
<span><span class="co">#&gt;     ├── 2023-12-21-usada_dates.csv</span></span>
<span><span class="co">#&gt;     └── 2023-12-21-usada_raw.csv</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="visualize">Visualize<a class="anchor" aria-label="anchor" href="#visualize"></a>
</h2>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/wch/extrafont" class="external-link">extrafont</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Registering fonts with R</span></span>
<span><span class="fu">loadfonts</span><span class="op">(</span>quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Ryo-N7/tvthemes" class="external-link">tvthemes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ggwaffle</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="adverse-analytical-findings">Adverse Analytical Findings<a class="anchor" aria-label="anchor" href="#adverse-analytical-findings"></a>
</h3>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">substance_group</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>substance_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">substance_group</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">substance_group</span>, name <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">count</span>,</span>
<span>    y <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html" class="external-link">fct_reorder</a></span><span class="op">(</span><span class="va">substance_group</span>, <span class="va">count</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Total Adverse Analytical Findings"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"What is the most common banned substance?"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"WADA Classification"</span>, x <span class="op">=</span> <span class="st">"Counts"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-40-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="sports-1">Sports<a class="anchor" aria-label="anchor" href="#sports-1"></a>
</h3>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">sport</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">sport</span>, name <span class="op">=</span> <span class="st">"count"</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">count</span>,</span>
<span>    y <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html" class="external-link">fct_reorder</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">sport</span><span class="op">)</span>, <span class="va">count</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Top Ten Sports with Sanctions"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"What sports have the most adverse analytical findings?"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Sport"</span>, x <span class="op">=</span> <span class="st">"Number of Sanctions"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-41-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="top-adverse-analytical-findings--sports">Top Adverse Analytical Findings &amp; Sports<a class="anchor" aria-label="anchor" href="#top-adverse-analytical-findings--sports"></a>
</h3>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">top3_sports</span> <span class="op">&lt;-</span> <span class="va">tidy_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">sport</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">sport</span>, name <span class="op">=</span> <span class="st">"count"</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sport</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/as_vector.html" class="external-link">as_vector</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">tidy_substances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sport</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">top3_sports</span> <span class="op">&amp;</span> </span>
<span>      <span class="va">substance_group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S1 ANABOLIC AGENTS"</span>, </span>
<span>        <span class="st">"S6 STIMULANTS"</span>, </span>
<span>        <span class="st">"S4 HORMONE AND METABOLIC MODULATORS"</span>, </span>
<span>        <span class="st">"S5 DIURETICS/MASKING AGENTS"</span>, </span>
<span>        <span class="st">"S2 PEP HORMONES/G FACTORS/MIMETICS"</span>, </span>
<span>        <span class="st">"S8 CANNABINOIDS"</span>, </span>
<span>        <span class="st">"S3 BETA-2 AGONISTS"</span></span>
<span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>substance_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">substance_group</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">substance_group</span>, <span class="va">sport</span>, name <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">count</span>,</span>
<span>    y <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html" class="external-link">fct_reorder</a></span><span class="op">(</span><span class="va">substance_group</span>, <span class="va">count</span><span class="op">)</span>, </span>
<span>    group <span class="op">=</span> <span class="va">sport</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">substance_group</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.45</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">sport</span>, scales <span class="op">=</span> <span class="st">'free_x'</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Top Adverse Analytical Findings"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Most Common Substances by Sport"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"WADA Classification"</span>, </span>
<span>    x <span class="op">=</span> <span class="st">"Total Sanctions"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">tvthemes</span><span class="fu">::</span><span class="fu">scale_fill_bigHero6</span><span class="op">(</span>reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-42-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="mma-substances">MMA Substances<a class="anchor" aria-label="anchor" href="#mma-substances"></a>
</h3>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">waffle_mma</span> <span class="op">&lt;-</span> <span class="va">tidy_substances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sport</span> <span class="op">==</span> <span class="st">"mixed martial arts"</span><span class="op">)</span> <span class="op">|&gt;</span>     </span>
<span>  <span class="fu">ggwaffle</span><span class="fu">::</span><span class="fu">waffle_iron</span><span class="op">(</span><span class="fu">aes_d</span><span class="op">(</span>group <span class="op">=</span> <span class="va">substance_group</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">waffle_mma</span>, </span>
<span>       <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, </span>
<span>           y <span class="op">=</span> <span class="va">y</span>, </span>
<span>           fill <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggwaffle</span><span class="fu">::</span><span class="fu">geom_waffle</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggwaffle</span><span class="fu">::</span><span class="fu">theme_waffle</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mixed martial arts"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Most common WADA banned substances"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using the `size` aesthetic in this geom was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; ℹ Please use `linewidth` in the `default_aes` field and elsewhere instead.</span></span>
<span><span class="co">#&gt; This warning is displayed once every 8 hours.</span></span>
<span><span class="co">#&gt; Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span>
<span><span class="co">#&gt; generated.</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-46-1.png" width="100%"></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing dopingdata</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Martin Frigaard <br><small class="roles"> Maintainer, author </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Martin Frigaard.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
