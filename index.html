<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="R package of data and code from the United States Anti-Doping
    Agency website.">
<title>USADA doping data • dopingdata</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Ubuntu-0.4.8/font.css" rel="stylesheet">
<link href="deps/Ubuntu_Mono-0.4.8/font.css" rel="stylesheet">
<link href="deps/Fira_Sans_Condensed-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="USADA doping data">
<meta property="og:description" content="R package of data and code from the United States Anti-Doping
    Agency website.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">dopingdata</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Harvesting Data</h6>
    <a class="dropdown-item" href="articles/scraping-usada-sanctions.html">USADA Sanctions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="dopingdata">dopingdata<a class="anchor" aria-label="anchor" href="#dopingdata"></a>
</h1></div>
<!-- badges: start -->
<p><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg"></p>
<!-- https://img.shields.io/badge/lifecycle-stable-green.svg -->
<!-- badges: end -->
<p><code>dopingdata</code> contains data from the <a href="https://en.wikipedia.org/wiki/United_States_Anti-Doping_Agency" class="external-link">United States Anti-Doping Agency</a> for exploration, modeling, and visualizations. The datasets in this package are derived from from the <a href="https://www.usada.org/" class="external-link">USADA website</a> and the <a href="https://www.wada-ama.org/en/prohibited-list?q=" class="external-link">World Anti-Doping Agency (WADA) banned substances list</a>. Scraping, processing, and visualizing these data presented so many unique challenges I decided to combine the utilities into a package.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of <code>dopingdata</code> like so:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"mjfrigaard/dopingdata"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjfrigaard.github.io/dopingdata/">dopingdata</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="scraping-sanction-data">Scraping Sanction Data<a class="anchor" aria-label="anchor" href="#scraping-sanction-data"></a>
</h2>
<p>Each dataset was ha<strong>rvest</strong>ed using the <a href="https://rvest.tidyverse.org/" class="external-link"><code>rvest</code></a> and <a href="https://xml2.r-lib.org/" class="external-link"><code>xml2</code></a> packages, but using manners (with the <a href="https://dmi3kno.github.io/polite/" class="external-link"><code>polite</code></a> package).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/scrape_sanctions.html">scrape_sanctions</a></span><span class="op">(</span>dest_path <span class="op">=</span> <span class="st">"dev"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Exporting raw data<span class="sc">:</span> dev<span class="sc">/</span><span class="dv">2023-12-19</span><span class="sc">/</span><span class="dv">2023-12-19</span><span class="sc">-</span>usada_sanctions_raw.csv</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Raw data successfully exported<span class="sc">!</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="processing-data">Processing Data<a class="anchor" aria-label="anchor" href="#processing-data"></a>
</h2>
<p><code><a href="reference/process_text.html">process_text()</a></code> performs the following:</p>
<ul>
<li><p>Processed data have all had the column names formatted <code>snake_case</code></p></li>
<li><p>All of the text has been converted to lowercase</p></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"dev/2023-12-19/2023-12-19-usada_sanctions_raw.csv"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">usada_raw</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    937 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;  $ Athlete           : chr  "Rodriguez, Daniel" "Park, Mariah" "Frey, John" "Jha, Kanak" ...</span></span>
<span><span class="co">#&gt;  $ Sport             : chr  "Mixed Martial Arts" "Weightlifting" "Cycling" "Table Tennis" ...</span></span>
<span><span class="co">#&gt;  $ Substance.Reason  : chr  "Ostarine; LGD-4033" "Chlorthalidone" "Non-Analytical: Refusal to Submit to Sample Collection" "Non-Analytical: 3 Whereabouts Failures" ...</span></span>
<span><span class="co">#&gt;  $ Sanction.Terms    : chr  "3-Month Suspenion" "Public Warning" "2-Year Suspension; Loss of Results" "1-Year Suspension; Loss of Results" ...</span></span>
<span><span class="co">#&gt;  $ Sanction.Announced: chr  "12/14/2023" "12/11/2023" "12/05/2023" "Original: 3/20/2023; Updated: 12/01/2023" ...</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/process_text.html">process_text</a></span><span class="op">(</span>raw_data <span class="op">=</span> <span class="va">usada_raw</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">usada</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    937 obs. of  5 variables:</span></span>
<span><span class="co">#&gt;  $ athlete           : chr  "rodriguez, daniel" "park, mariah" "frey, john" "jha, kanak" ...</span></span>
<span><span class="co">#&gt;  $ sport             : chr  "mixed martial arts" "weightlifting" "cycling" "table tennis" ...</span></span>
<span><span class="co">#&gt;  $ substance_reason  : chr  "ostarine; lgd-4033" "chlorthalidone" "non-analytical: refusal to submit to sample collection" "non-analytical: 3 whereabouts failures" ...</span></span>
<span><span class="co">#&gt;  $ sanction_terms    : chr  "3-month suspenion" "public warning" "2-year suspension; loss of results" "1-year suspension; loss of results" ...</span></span>
<span><span class="co">#&gt;  $ sanction_announced: chr  "12/14/2023" "12/11/2023" "12/05/2023" "original: 3/20/2023; updated: 12/01/2023" ...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sanction-dates">Sanction Dates<a class="anchor" aria-label="anchor" href="#sanction-dates"></a>
</h2>
<p><code>sanction_announced</code> contains the date the sanction was announced, and about 30 of these contain two values (<code>original</code> and <code>updated</code>). Wrangling these values pose some challenges because they aren’t <em>consistently</em> messy.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">usada</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^original"</span>, <span class="va">usada</span><span class="op">[[</span><span class="st">'sanction_announced'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, </span>
<span>  <span class="va">sanction_announced</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 30 × 1</span></span>
<span><span class="co">#&gt;    sanction_announced                       </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                                    </span></span>
<span><span class="co">#&gt;  1 original: 3/20/2023; updated: 12/01/2023 </span></span>
<span><span class="co">#&gt;  2 original: 05/07/2019; updated: 02/04/2022</span></span>
<span><span class="co">#&gt;  3 original: 09/03/21; updated: 01/25/22    </span></span>
<span><span class="co">#&gt;  4 original:  11/04/2019;updated: 05/17/2021</span></span>
<span><span class="co">#&gt;  5 original 12/20/2018; updated 11/04/2020  </span></span>
<span><span class="co">#&gt;  6 original: 10/19/2020updated: 01/05/2021  </span></span>
<span><span class="co">#&gt;  7 original: 09/05/2019; updated: 08/26/2020</span></span>
<span><span class="co">#&gt;  8 original: 07/22/2020, updated: 11/03/2022</span></span>
<span><span class="co">#&gt;  9 original 09/11/2018; updated 01/16/2020  </span></span>
<span><span class="co">#&gt; 10 original: 06/17/2019; updated: 12/16/2019</span></span>
<span><span class="co">#&gt; # ℹ 20 more rows</span></span></code></pre></div>
<p>I decided to split these into three <code>data.frame</code>s to wrangle the dates (<code>bad_dates</code>, <code>good_dates</code>, and <code>no_dates</code>).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bad_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">usada</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^original"</span>, <span class="va">usada</span><span class="op">[[</span><span class="st">'sanction_announced'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">good_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">usada</span>, </span>
<span>  <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^original"</span>, <span class="va">usada</span><span class="op">[[</span><span class="st">'sanction_announced'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">sanction_announced</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="va">no_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">usada</span>,</span>
<span>  <span class="va">athlete</span> <span class="op">==</span> <span class="st">"*name removed"</span> <span class="op">&amp;</span> <span class="va">sanction_announced</span> <span class="op">==</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p>I’ve written a <code><a href="reference/clean_dates.html">clean_dates()</a></code> function that takes <code>date_col</code>, <code>split</code> and <code>pattern</code> arguments:</p>
<ul>
<li><p><code>df</code> = processed USADA dataset with messy dates</p></li>
<li><p><code>date_col</code> = sanction date column (usually <code>sanction_announced</code>)</p></li>
<li><p><code>split</code> = regex to pass to split argument of <code><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit()</a></code> (defaults to <code>"updated"</code>)</p></li>
<li><p><code>pattern</code> = regex for other non-date pattern (defaults to <code>"original"</code>)</p></li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cleaned_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/clean_dates.html">clean_dates</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">bad_dates</span>, </span>
<span>  date_col <span class="op">=</span> <span class="st">"sanction_announced"</span>, </span>
<span>  split <span class="op">=</span> <span class="st">"updated"</span>, </span>
<span>  pattern <span class="op">=</span> <span class="st">"original"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span></span>
<span>  <span class="va">cleaned_dates</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'sanction_announced'</span>, <span class="st">'pattern_date'</span>, <span class="st">'split_date'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;   sanction_announced                        pattern_date split_date</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                                     &lt;date&gt;       &lt;date&gt;    </span></span>
<span><span class="co">#&gt; 1 original: 3/20/2023; updated: 12/01/2023  2023-03-20   2023-12-01</span></span>
<span><span class="co">#&gt; 2 original: 05/07/2019; updated: 02/04/2022 2019-05-07   2022-02-04</span></span>
<span><span class="co">#&gt; 3 original: 09/03/21; updated: 01/25/22     0021-09-03   0022-01-25</span></span>
<span><span class="co">#&gt; 4 original:  11/04/2019;updated: 05/17/2021 2019-11-04   2021-05-17</span></span>
<span><span class="co">#&gt; 5 original 12/20/2018; updated 11/04/2020   2018-12-20   2020-11-04</span></span>
<span><span class="co">#&gt; 6 original: 10/19/2020updated: 01/05/2021   2020-10-19   2021-01-05</span></span></code></pre></div>
<p>I split the bad dates on <code>"updated"</code> and provided <code>"original"</code> as the pattern (the opposite will also work). The <code>sanction_date</code> column will contain the correctly formatted updated <code>sanction_date</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cleaned_dates</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cleaned_dates</span><span class="op">)</span> <span class="op">==</span> <span class="st">'split_date'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'sanction_date'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cleaned_dates</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cleaned_dates</span><span class="op">)</span> <span class="op">==</span> <span class="st">'pattern_date'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'original_date'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span></span>
<span>  <span class="va">cleaned_dates</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'sanction_announced'</span>, <span class="st">'sanction_date'</span>, <span class="st">'original_date'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;   sanction_announced                        sanction_date original_date</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                                     &lt;date&gt;        &lt;date&gt;       </span></span>
<span><span class="co">#&gt; 1 original: 3/20/2023; updated: 12/01/2023  2023-12-01    2023-03-20   </span></span>
<span><span class="co">#&gt; 2 original: 05/07/2019; updated: 02/04/2022 2022-02-04    2019-05-07   </span></span>
<span><span class="co">#&gt; 3 original: 09/03/21; updated: 01/25/22     0022-01-25    0021-09-03   </span></span>
<span><span class="co">#&gt; 4 original:  11/04/2019;updated: 05/17/2021 2021-05-17    2019-11-04   </span></span>
<span><span class="co">#&gt; 5 original 12/20/2018; updated 11/04/2020   2020-11-04    2018-12-20   </span></span>
<span><span class="co">#&gt; 6 original: 10/19/2020updated: 01/05/2021   2021-01-05    2020-10-19</span></span></code></pre></div>
<p>After formatting <code>good_dates</code> and removing <code>original_date</code> column we can combine the two with <code><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind()</a></code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">good_dates</span><span class="op">$</span><span class="va">sanction_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">good_dates</span><span class="op">[[</span><span class="st">'sanction_announced'</span><span class="op">]</span><span class="op">]</span>, </span>
<span>                                    format <span class="op">=</span> <span class="st">"%m/%d/%Y"</span><span class="op">)</span></span>
<span><span class="co"># get intersecting names </span></span>
<span><span class="va">nms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">intersect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cleaned_dates</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">good_dates</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># bind the two datasets </span></span>
<span><span class="va">usada_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">good_dates</span>, <span class="va">cleaned_dates</span><span class="op">[</span><span class="va">nms</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">usada_dates</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    649 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;  $ athlete           : chr  "rodriguez, daniel" "park, mariah" "frey, john" "forrest, evan" ...</span></span>
<span><span class="co">#&gt;  $ sport             : chr  "mixed martial arts" "weightlifting" "cycling" "weightlifting" ...</span></span>
<span><span class="co">#&gt;  $ substance_reason  : chr  "ostarine; lgd-4033" "chlorthalidone" "non-analytical: refusal to submit to sample collection" "boldenone; drostanolone; methandienone; nandrolone; testosterone" ...</span></span>
<span><span class="co">#&gt;  $ sanction_terms    : chr  "3-month suspenion" "public warning" "2-year suspension; loss of results" "3-year suspension; loss of results" ...</span></span>
<span><span class="co">#&gt;  $ sanction_announced: chr  "12/14/2023" "12/11/2023" "12/05/2023" "11/30/2023" ...</span></span>
<span><span class="co">#&gt;  $ sanction_date     : Date, format: "2023-12-14" "2023-12-11" ...</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/export_data.html">export_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">usada_dates</span>, path <span class="op">=</span> <span class="st">"data-raw"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Exporting data: data-raw/2023-12-19/2023-12-19-usada_dates.csv</span></span>
<span><span class="co">#&gt; Raw data successfully exported!</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sports">Sports<a class="anchor" aria-label="anchor" href="#sports"></a>
</h2>
<p>To wrangle the sports, I’ll use packages and functions from the <code>tidyverse</code> (<code>dplyr</code>, <code>stringr</code>, <code>tidyr</code>, etc.), but I also provide the base R alternatives (wherever possible).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; ✔ dplyr     1.1.4     ✔ readr     2.1.4</span></span>
<span><span class="co">#&gt; ✔ forcats   1.0.0     ✔ stringr   1.5.1</span></span>
<span><span class="co">#&gt; ✔ ggplot2   3.4.4     ✔ tibble    3.2.1</span></span>
<span><span class="co">#&gt; ✔ lubridate 1.9.3     ✔ tidyr     1.3.0</span></span>
<span><span class="co">#&gt; ✔ purrr     1.0.2     </span></span>
<span><span class="co">#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></span>
<span><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></span>
<span><span class="co">#&gt; ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</span></span></code></pre></div>
<p><code>tidyverse</code> functions will return a <code>tibble</code> (not a <code>data.frame</code>), which prints fewer rows to the console.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_sports</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">usada_dates</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">usada_sports</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [649 × 6] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ athlete           : chr [1:649] "rodriguez, daniel" "park, mariah" "frey, john" "forrest, evan" ...</span></span>
<span><span class="co">#&gt;  $ sport             : chr [1:649] "mixed martial arts" "weightlifting" "cycling" "weightlifting" ...</span></span>
<span><span class="co">#&gt;  $ substance_reason  : chr [1:649] "ostarine; lgd-4033" "chlorthalidone" "non-analytical: refusal to submit to sample collection" "boldenone; drostanolone; methandienone; nandrolone; testosterone" ...</span></span>
<span><span class="co">#&gt;  $ sanction_terms    : chr [1:649] "3-month suspenion" "public warning" "2-year suspension; loss of results" "3-year suspension; loss of results" ...</span></span>
<span><span class="co">#&gt;  $ sanction_announced: chr [1:649] "12/14/2023" "12/11/2023" "12/05/2023" "11/30/2023" ...</span></span>
<span><span class="co">#&gt;  $ sanction_date     : Date[1:649], format: "2023-12-14" "2023-12-11" ...</span></span></code></pre></div>
<p>We can start by counting the <code>sport</code> column:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_sports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">sport</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 66 × 2</span></span>
<span><span class="co">#&gt;    sport                                   n</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                               &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 mixed martial arts                    135</span></span>
<span><span class="co">#&gt;  2 cycling                               125</span></span>
<span><span class="co">#&gt;  3 weightlifting                         122</span></span>
<span><span class="co">#&gt;  4 track and field                        93</span></span>
<span><span class="co">#&gt;  5 wrestling                              15</span></span>
<span><span class="co">#&gt;  6 triathlon                              14</span></span>
<span><span class="co">#&gt;  7 brazilian jiu-jitsu                    13</span></span>
<span><span class="co">#&gt;  8 paralympic track and field             11</span></span>
<span><span class="co">#&gt;  9 swimming                                9</span></span>
<span><span class="co">#&gt; 10 cycling - athlete support personnel     6</span></span>
<span><span class="co">#&gt; # ℹ 56 more rows</span></span></code></pre></div>
<div class="section level3">
<h3 id="support-personnel">Support personnel<a class="anchor" aria-label="anchor" href="#support-personnel"></a>
</h3>
<p>Some of the sports aren’t sports–they’re <code>athlete support personnel</code>. These have <code>support_personnel</code> identifier.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_sports</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">usada_dates</span>, </span>
<span>  <span class="co"># support_personnel</span></span>
<span>  support_personnel <span class="op">=</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span>condition <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span></span>
<span>      <span class="va">sport</span>, <span class="st">"support personnel"</span><span class="op">)</span>, </span>
<span>      true <span class="op">=</span> <span class="cn">TRUE</span>, false <span class="op">=</span> <span class="cn">FALSE</span>, missing <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">usada_sports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">sport</span>, <span class="st">"support personnel"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">sport</span>, <span class="va">support_personnel</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">support_personnel</span>, values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 2</span></span>
<span><span class="co">#&gt;   sport                                           `TRUE`</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                                            &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 brazilian jiu-jitsu - athlete support personnel      1</span></span>
<span><span class="co">#&gt; 2 cycling - athlete support personnel                  6</span></span>
<span><span class="co">#&gt; 3 track and field - athlete support personnel          6</span></span>
<span><span class="co">#&gt; 4 weightlifting - athlete support personnel            1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="track-and-field-or-track--field">‘track and field’ or ‘track &amp; field’<a class="anchor" aria-label="anchor" href="#track-and-field-or-track--field"></a>
</h3>
<p>I’m going to convert sports like <code>track &amp; field</code> as <code>track and field</code> (this will help me determine which athletes/support personnel are involved in multiple sports).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_sports</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">usada_sports</span>,</span>
<span>  <span class="co"># track &amp; field</span></span>
<span>  sport <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="va">sport</span>, <span class="st">'track and field'</span>, <span class="st">'track &amp; field'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">usada_sports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">sport</span>, <span class="st">"track"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">sport</span>, <span class="va">support_personnel</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">support_personnel</span>, values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;   sport                                           `FALSE` `TRUE`</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                                             &lt;int&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 bobsled and skeleton, track &amp; field                   1     NA</span></span>
<span><span class="co">#&gt; 2 para track &amp; field                                    3     NA</span></span>
<span><span class="co">#&gt; 3 paralympic track &amp; field                             11     NA</span></span>
<span><span class="co">#&gt; 4 paralympic track &amp; field, paralympic volleyball       1     NA</span></span>
<span><span class="co">#&gt; 5 track &amp; field                                        95     NA</span></span>
<span><span class="co">#&gt; 6 track &amp; field - athlete support personnel            NA      6</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="spelling">Spelling<a class="anchor" aria-label="anchor" href="#spelling"></a>
</h3>
<p>The incorrect spelling for <code>brazilian jiu-jitsu</code> (<code>brazillian jiu-jitsu</code>) is corrected below.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_sports</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">usada_sports</span>, </span>
<span>  <span class="co"># brazilian jiu-jitsu</span></span>
<span>  sport <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="va">sport</span> <span class="op">==</span> <span class="st">'brazillian jiu-jitsu'</span> <span class="op">~</span> <span class="st">'brazilian jiu-jitsu'</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">sport</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">usada_sports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">sport</span>, <span class="st">"jitsu"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">sport</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span><span class="co">#&gt;   sport                                               n</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                                           &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 brazilian jiu-jitsu                                14</span></span>
<span><span class="co">#&gt; 2 brazilian jiu-jitsu - athlete support personnel     1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="paralympic">‘paralympic’<a class="anchor" aria-label="anchor" href="#paralympic"></a>
</h3>
<p>An identifier for paralympic sports: <code>paralympic</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_sports</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">usada_sports</span>, </span>
<span>  <span class="co"># paralympic</span></span>
<span>  paralympic <span class="op">=</span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span>condition <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">sport</span>, <span class="st">"paralympic|para"</span><span class="op">)</span>, </span>
<span>      true <span class="op">=</span> <span class="cn">TRUE</span>, false <span class="op">=</span> <span class="cn">FALSE</span>, missing <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">usada_sports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">sport</span>, <span class="st">"paralympic|para"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">paralympic</span>, <span class="va">sport</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">paralympic</span>, values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 14 × 2</span></span>
<span><span class="co">#&gt;    sport                                           `TRUE`</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                                            &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 para shooting                                        1</span></span>
<span><span class="co">#&gt;  2 para track &amp; field                                   3</span></span>
<span><span class="co">#&gt;  3 paralympic archery                                   1</span></span>
<span><span class="co">#&gt;  4 paralympic basketball                                2</span></span>
<span><span class="co">#&gt;  5 paralympic boccia                                    1</span></span>
<span><span class="co">#&gt;  6 paralympic curling                                   1</span></span>
<span><span class="co">#&gt;  7 paralympic cycling                                   4</span></span>
<span><span class="co">#&gt;  8 paralympic judo                                      4</span></span>
<span><span class="co">#&gt;  9 paralympic rugby                                     1</span></span>
<span><span class="co">#&gt; 10 paralympic sailing                                   1</span></span>
<span><span class="co">#&gt; 11 paralympic snowboarding                              1</span></span>
<span><span class="co">#&gt; 12 paralympic table tennis                              1</span></span>
<span><span class="co">#&gt; 13 paralympic track &amp; field                            11</span></span>
<span><span class="co">#&gt; 14 paralympic track &amp; field, paralympic volleyball      1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="multiple-sports">Multiple sports<a class="anchor" aria-label="anchor" href="#multiple-sports"></a>
</h3>
<p>Now we can identify the multiple sports using <code>and</code> and <code>,</code> in the regular expression.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_sports</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">usada_sports</span>, </span>
<span>  <span class="co"># multiple_sports</span></span>
<span>  multiple_sports <span class="op">=</span> </span>
<span>    <span class="fu">if_else</span><span class="op">(</span>condition <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">sport</span>, <span class="st">"and |, "</span><span class="op">)</span>, </span>
<span>      true <span class="op">=</span> <span class="cn">TRUE</span>, false <span class="op">=</span> <span class="cn">FALSE</span>, missing <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">usada_sports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">sport</span>, <span class="st">"and |, "</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">multiple_sports</span>, <span class="va">sport</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">multiple_sports</span>, values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 2</span></span>
<span><span class="co">#&gt;   sport                                           `TRUE`</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                                            &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 bobsled and skeleton                                 4</span></span>
<span><span class="co">#&gt; 2 bobsled and skeleton, track &amp; field                  1</span></span>
<span><span class="co">#&gt; 3 cycling, triathlon                                   3</span></span>
<span><span class="co">#&gt; 4 cycling, weightlifting                               1</span></span>
<span><span class="co">#&gt; 5 paralympic track &amp; field, paralympic volleyball      1</span></span>
<span><span class="co">#&gt; 6 skiing and snowboarding                              1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tidy-sports">Tidy sports<a class="anchor" aria-label="anchor" href="#tidy-sports"></a>
</h3>
<p>The athletes listed with multiple sports will occupy multiple rows in a ‘tidy’ version of <code>usada_sports</code>. We can check this using <code>count()</code> below to verify we have one athlete for each sport:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_sports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">multiple_sports</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_rows.html" class="external-link">separate_rows</a></span><span class="op">(</span><span class="va">sport</span>, sep <span class="op">=</span> <span class="st">"and|, "</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="va">sport</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 23 × 3</span></span>
<span><span class="co">#&gt;    athlete                  sport               n</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                    &lt;chr&gt;           &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 allison, kyler           " skeleton"         1</span></span>
<span><span class="co">#&gt;  2 allison, kyler           "bobsled "          1</span></span>
<span><span class="co">#&gt;  3 bailey, ryan             " skeleton"         1</span></span>
<span><span class="co">#&gt;  4 bailey, ryan             "bobsled "          1</span></span>
<span><span class="co">#&gt;  5 bailey, ryan             "track &amp; field"     1</span></span>
<span><span class="co">#&gt;  6 blandford, jenna         "cycling"           1</span></span>
<span><span class="co">#&gt;  7 blandford, jenna         "triathlon"         1</span></span>
<span><span class="co">#&gt;  8 cruse, j.c.              " skeleton"         1</span></span>
<span><span class="co">#&gt;  9 cruse, j.c.              "bobsled "          1</span></span>
<span><span class="co">#&gt; 10 denney phillips, jessica "cycling"           1</span></span>
<span><span class="co">#&gt; # ℹ 13 more rows</span></span></code></pre></div>
<p>Remove any white-space left over from <code><a href="https://tidyr.tidyverse.org/reference/separate_rows.html" class="external-link">tidyr::separate_rows()</a></code> with <code><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">stringr::str_trim()</a></code> to create a <code>multp_usada_sports</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multp_usada_sports</span> <span class="op">&lt;-</span> <span class="va">usada_sports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">multiple_sports</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate_rows.html" class="external-link">separate_rows</a></span><span class="op">(</span><span class="va">sport</span>, sep <span class="op">=</span> <span class="st">"and|, "</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>sport <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html" class="external-link">str_trim</a></span><span class="op">(</span><span class="va">sport</span>, side <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">multp_usada_sports</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [23 × 9] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ athlete           : chr [1:23] "allison, kyler" "allison, kyler" "blandford, jenna" "blandford, jenna" ...</span></span>
<span><span class="co">#&gt;  $ sport             : chr [1:23] "bobsled" "skeleton" "cycling" "triathlon" ...</span></span>
<span><span class="co">#&gt;  $ substance_reason  : chr [1:23] "non-analytical: refusal to submit to sample collection" "non-analytical: refusal to submit to sample collection" "non-analytical: use and possession (testosterone, hgh and oxandrolone)" "non-analytical: use and possession (testosterone, hgh and oxandrolone)" ...</span></span>
<span><span class="co">#&gt;  $ sanction_terms    : chr [1:23] "4-year suspension; loss of results; sanction tolled due to retirement" "4-year suspension; loss of results; sanction tolled due to retirement" "4-year suspension - loss of results" "4-year suspension - loss of results" ...</span></span>
<span><span class="co">#&gt;  $ sanction_announced: chr [1:23] "10/09/2019" "10/09/2019" "11/28/2017" "11/28/2017" ...</span></span>
<span><span class="co">#&gt;  $ sanction_date     : Date[1:23], format: "2019-10-09" "2019-10-09" ...</span></span>
<span><span class="co">#&gt;  $ support_personnel : logi [1:23] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ paralympic        : logi [1:23] FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ multiple_sports   : logi [1:23] TRUE TRUE TRUE TRUE TRUE TRUE ...</span></span></code></pre></div>
<p>To combine these with the single-sport athletes, I’ll need to remove the single occurrences of the multiple-sport athletes in <code>usada_sports</code> (and replace them with the <code>tidy_usada_sports</code>)</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get athlete names</span></span>
<span><span class="va">multp_sports_athletes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">multp_usada_sports</span><span class="op">[</span><span class="st">'athlete'</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># remove from </span></span>
<span><span class="va">single_usada_sports</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">usada_sports</span>, </span>
<span>                                        <span class="va">athlete</span> <span class="op"><a href="reference/nin.html">%nin%</a></span> <span class="va">multp_sports_athletes</span><span class="op">)</span></span></code></pre></div>
<p>Verify there aren’t any duplicates in <code>single_usada_sports</code> (there should be zero rows here)</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">single_usada_sports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="va">sanction_date</span>, <span class="va">sport</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 0 × 4</span></span>
<span><span class="co">#&gt; # ℹ 4 variables: athlete &lt;chr&gt;, sanction_date &lt;date&gt;, sport &lt;chr&gt;, n &lt;int&gt;</span></span></code></pre></div>
<p>Now we can combine the two datasets and verify there aren’t any duplicates (again).</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_sports</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">single_usada_sports</span>, <span class="va">multp_usada_sports</span><span class="op">)</span></span>
<span><span class="va">tidy_sports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">athlete</span>, <span class="va">sanction_date</span>, <span class="va">sport</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 0 × 4</span></span>
<span><span class="co">#&gt; # ℹ 4 variables: athlete &lt;chr&gt;, sanction_date &lt;date&gt;, sport &lt;chr&gt;, n &lt;int&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">tidy_sports</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    672 obs. of  9 variables:</span></span>
<span><span class="co">#&gt;  $ athlete           : chr  "rodriguez, daniel" "park, mariah" "frey, john" "forrest, evan" ...</span></span>
<span><span class="co">#&gt;  $ sport             : chr  "mixed martial arts" "weightlifting" "cycling" "weightlifting" ...</span></span>
<span><span class="co">#&gt;  $ substance_reason  : chr  "ostarine; lgd-4033" "chlorthalidone" "non-analytical: refusal to submit to sample collection" "boldenone; drostanolone; methandienone; nandrolone; testosterone" ...</span></span>
<span><span class="co">#&gt;  $ sanction_terms    : chr  "3-month suspenion" "public warning" "2-year suspension; loss of results" "3-year suspension; loss of results" ...</span></span>
<span><span class="co">#&gt;  $ sanction_announced: chr  "12/14/2023" "12/11/2023" "12/05/2023" "11/30/2023" ...</span></span>
<span><span class="co">#&gt;  $ sanction_date     : Date, format: "2023-12-14" "2023-12-11" ...</span></span>
<span><span class="co">#&gt;  $ support_personnel : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ paralympic        : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span>
<span><span class="co">#&gt;  $ multiple_sports   : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...</span></span></code></pre></div>
<p>Export <code>tidy_sports</code> to <code>data-raw/</code></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/export_data.html">export_data</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">tidy_sports</span>, </span>
<span>  path <span class="op">=</span> <span class="st">"data-raw"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Exporting data: data-raw/2023-12-19/2023-12-19-tidy_sports.csv</span></span>
<span><span class="co">#&gt; Raw data successfully exported!</span></span></code></pre></div>
<p>Verify</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="st">"data-raw/2023-12-19"</span><span class="op">)</span></span>
<span><span class="co">#&gt; data-raw/2023-12-19</span></span>
<span><span class="co">#&gt; ├── 2023-12-19-tidy_sports.csv</span></span>
<span><span class="co">#&gt; └── 2023-12-19-usada_dates.csv</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="adverse-analytic-findings">Adverse Analytic Findings<a class="anchor" aria-label="anchor" href="#adverse-analytic-findings"></a>
</h2>
<p>We’ll start by classifying ‘adverse analytic findings’ for a single banned substance. I’ve written a <code><a href="reference/get_recent_file.html">get_recent_file()</a></code> function to quickly import .csv files from a specified directory:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/get_recent_file.html">get_recent_file</a></span><span class="op">(</span><span class="st">"data-raw/2023-12-19/"</span>, regex <span class="op">=</span> <span class="st">'sports'</span>, ext <span class="op">=</span> <span class="st">'.csv'</span><span class="op">)</span></span>
<span><span class="co">#&gt; File last changed: 2023-12-19 14:29:09.367087</span></span>
<span><span class="co">#&gt; File name: 2023-12-19-tidy_sports.csv</span></span>
<span><span class="co">#&gt; ✔ import code pasted to clipboard!</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tidy_sports</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.delim</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">'data-raw/2023-12-19/2023-12-19-tidy_sports.csv'</span>, sep <span class="op">=</span> <span class="st">','</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="aafs-vs-adrvs">AAFs vs ADRVs<a class="anchor" aria-label="anchor" href="#aafs-vs-adrvs"></a>
</h4>
<p>The sanctions are divided into two categories:</p>
<ul>
<li><p><code>analytic</code>: <a href="https://www.usada.org/spirit-of-sport/education/alphabet-soup-results-management/#:~:text" class="external-link">Adverse Analytical Finding</a>, AAF; <em>An AAF is a report from a WADA-accredited laboratory that identifies the presence of a prohibited substance and/or its metabolites or markers in a sample.</em></p></li>
<li><p><code>non-analytic</code>: <a href="https://www.usada.org/spirit-of-sport/education/non-analytical-anti-doping-rule-violations/" class="external-link">Non-Analytical Anti-doping Rule Violation</a> ADRV; <em>a non-analytical anti-doping rule violation does not stem from a positive urine or blood sample, but instead originates from, and is substantiated by, other evidence of doping or violations by an athlete or athlete support personnel.</em>.</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="substancereason">substance/reason<a class="anchor" aria-label="anchor" href="#substancereason"></a>
</h4>
<p>The <code>substance_reason</code> column contains the details of the sanction, which can include the following information:</p>
<ol style="list-style-type: decimal">
<li><p>The name of the banned substance</p></li>
<li><p>A description of the infraction (if non-analytic)</p></li>
</ol>
<p>We will use regular expressions to identify the type of substance behind the sanction. See the examples below:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view</a></span><span class="op">(</span><span class="va">tidy_sports</span><span class="op">$</span><span class="va">substance_reason</span>, </span>
<span>  <span class="st">"use \\(epo &amp; hgh\\)"</span>, match <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [649] │ erythropoietin (epo) and non-analytical: &lt;use (epo &amp; hgh)&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view</a></span><span class="op">(</span><span class="va">tidy_sports</span><span class="op">$</span><span class="va">substance_reason</span>,</span>
<span>  <span class="st">"tampering, complicity"</span>, match <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [85] │ non-analytical: &lt;tampering, complicity&gt;</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="sanction-type">Sanction Type<a class="anchor" aria-label="anchor" href="#sanction-type"></a>
</h2>
<p>Most of the non-analytic sanctions include the terms <code>non-analytic</code>/<code>non-analytical</code>/etc., as a prefix in the <code>substance_reason</code> column.</p>
<p>I can pass these terms as regular expressions to create the <code>sanction_type</code> variable, which will contain two values: <code>non-analytical</code> and <code>analytical</code>. I’ll save this variable in a new the <code>usada_substances</code> dataset:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_substances</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">tidy_sports</span>,</span>
<span>    sanction_type <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">substance_reason</span>,</span>
<span>        <span class="st">"non-analytical"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"non-analytical"</span>,</span>
<span>      <span class="op">!</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">substance_reason</span>,</span>
<span>        <span class="st">"non-analytical"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"analytical"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">usada_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">sanction_type</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span><span class="co">#&gt;   sanction_type      n</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;          &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 analytical       504</span></span>
<span><span class="co">#&gt; 2 non-analytical   168</span></span></code></pre></div>
<p>Now I can filter <code>usada_substances</code> to the <code>analytical</code> sanctions in <code>sanction_type</code>.</p>
</div>
<div class="section level2">
<h2 id="substances">Substances<a class="anchor" aria-label="anchor" href="#substances"></a>
</h2>
<p><em>How can I identify the single vs. multiple substances?</em></p>
<p>Let’s take a look at four different sanctions in <code>sanction_type_example</code>:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 × 3</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   sport         substance_reason                                   sanction_type</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;         &lt;chr&gt;                                              &lt;chr&gt;        </span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 swimming      non-analytical: 3 whereabouts failures             non-analytic…</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 track &amp; field cannabinoids                                       analytical   </span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 triathlon     androgenic anabolic steroid; cannabinoids; anastr… analytical   </span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 track &amp; field non-analytical: tampering, administration (iv), a… non-analytic…</span></span></code></pre></div>
<p>We can see two analytic and two non-analytic sanctions, and each one has a single or multiple substance/reason. Fortunately, the sanctions with multiple items are separated by either semicolons (<code>;</code>), commas (<code>,</code>), or a conjunction (<code>and</code>), so I can use a regular expression to separate the items.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">sanction_type_example</span>,</span>
<span>  substance_cat <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span></span>
<span>    <span class="co"># identify the multiple_sr substances using a regular expression</span></span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="st">"; |, | and | &amp; | / "</span><span class="op">)</span> <span class="op">~</span> <span class="st">'multiple'</span>,</span>
<span>    <span class="co"># negate the regular expression for the single substances</span></span>
<span>    <span class="op">!</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="st">"; |, | and | &amp; | / "</span><span class="op">)</span> <span class="op">~</span> <span class="st">'single'</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">substance_cat</span>, <span class="va">sanction_type</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">substance_cat</span>, values_from <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 3</span></span>
<span><span class="co">#&gt;   sanction_type  multiple single</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;             &lt;int&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 analytical            1      1</span></span>
<span><span class="co">#&gt; 2 non-analytical        1      1</span></span></code></pre></div>
<p>The <code>substance_cat</code> identifier can be used to separate sanctions with multiple substance/reasons from sanctions with a single substance or reason.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">usada_substances</span> <span class="op">&lt;-</span> <span class="va">usada_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>substance_cat <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>    <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="st">"; |, | and | &amp; | / "</span><span class="op">)</span> <span class="op">~</span> <span class="st">'multiple'</span>,</span>
<span>    <span class="op">!</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="st">"; |, | and | &amp; | / "</span><span class="op">)</span> <span class="op">~</span> <span class="st">'single'</span>,</span>
<span>    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">usada_substances</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">substance_cat</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span><span class="co">#&gt;   substance_cat     n</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;         &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 single          488</span></span>
<span><span class="co">#&gt; 2 multiple        184</span></span></code></pre></div>
<div class="section level3">
<h3 id="single-analytic-substances">Single analytic substances<a class="anchor" aria-label="anchor" href="#single-analytic-substances"></a>
</h3>
<p>First we’ll focus on the sanctions with a single substance listed (we will deal with multiple substances next).</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">single_analytic_substances</span> <span class="op">&lt;-</span> <span class="va">usada_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">substance_cat</span> <span class="op">==</span> <span class="st">'single'</span> <span class="op">&amp;</span> <span class="va">sanction_type</span> <span class="op">==</span> <span class="st">"analytical"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">single_analytic_substances</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 11</span></span>
<span><span class="co">#&gt;   athlete sport substance_reason sanction_terms sanction_announced sanction_date</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;            &lt;chr&gt;          &lt;chr&gt;              &lt;chr&gt;        </span></span>
<span><span class="co">#&gt; 1 park, … weig… chlorthalidone   public warning 12/11/2023         2023-12-11   </span></span>
<span><span class="co">#&gt; 2 cutro-… judo  anabolic agent   2-year suspen… 09/19/2023         2023-09-19   </span></span>
<span><span class="co">#&gt; 3 saint … mixe… 3α-hydroxy-5α-a… 6-month suspe… 09/18/2023         2023-09-18   </span></span>
<span><span class="co">#&gt; 4 wilson… trac… canrenone        public warning 09/18/2023         2023-09-18   </span></span>
<span><span class="co">#&gt; 5 casey,… mixe… bpc-157          4-month suspe… 09/14/2023         2023-09-14   </span></span>
<span><span class="co">#&gt; 6 taylor… powe… cannabinoids     3-month suspe… 09/11/2023         2023-09-11   </span></span>
<span><span class="co">#&gt; # ℹ 5 more variables: support_personnel &lt;lgl&gt;, paralympic &lt;lgl&gt;,</span></span>
<span><span class="co">#&gt; #   multiple_sports &lt;lgl&gt;, sanction_type &lt;chr&gt;, substance_cat &lt;chr&gt;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="classifying-substances-with-classify_wada_substances">Classifying substances with <code>classify_wada_substances()</code>
<a class="anchor" aria-label="anchor" href="#classifying-substances-with-classify_wada_substances"></a>
</h3>
<p>To identify the <a href="https://www.wada-ama.org/en/prohibited-list#search-anchor" class="external-link">WADA banned substances</a>, I’ve written <code><a href="reference/classify_wada_substances.html">classify_wada_substances()</a></code>, a function that scans the <code>substance_reason</code> column and identifies any substances found on the <a href="https://www.wada-ama.org/sites/default/files/2022-09/2023list_en_final_9_september_2022.pdf" class="external-link">WADA list</a>. See the <code><a href="reference/classify_wada_substances.html">classify_wada_substances()</a></code> documentation for more information.</p>
<div class="section level4">
<h4 id="how-classify_wada_substances-works-s1-anabolic-agents-example">How <code>classify_wada_substances()</code> works (S1 ANABOLIC AGENTS example)<a class="anchor" aria-label="anchor" href="#how-classify_wada_substances-works-s1-anabolic-agents-example"></a>
</h4>
<p><code><a href="reference/classify_wada_substances.html">classify_wada_substances()</a></code> creates a <code>substance_group</code> variable with each of the WADA classifications (these are stored in <code>dopingdata::wada_classes</code>)</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dopingdata</span><span class="fu">::</span><span class="va">wada_classes</span></span>
<span><span class="co">#&gt; # A tibble: 13 × 1</span></span>
<span><span class="co">#&gt;    Classification                       </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                                </span></span>
<span><span class="co">#&gt;  1 S1 ANABOLIC AGENTS                   </span></span>
<span><span class="co">#&gt;  2 S2 PEP HORMONES/G FACTORS/MIMETICS   </span></span>
<span><span class="co">#&gt;  3 S3 BETA-2 AGONISTS                   </span></span>
<span><span class="co">#&gt;  4 S4 HORMONE AND METABOLIC MODULATORS  </span></span>
<span><span class="co">#&gt;  5 S5 DIURETICS/MASKING AGENTS          </span></span>
<span><span class="co">#&gt;  6 S6 STIMULANTS                        </span></span>
<span><span class="co">#&gt;  7 S7 NARCOTICS                         </span></span>
<span><span class="co">#&gt;  8 S8 CANNABINOIDS                      </span></span>
<span><span class="co">#&gt;  9 S9 GLUCOCORTICOIDS                   </span></span>
<span><span class="co">#&gt; 10 M1 MANIPULATION OF BLOOD             </span></span>
<span><span class="co">#&gt; 11 M2 CHEMICAL AND PHYSICAL MANIPULATION</span></span>
<span><span class="co">#&gt; 12 M3 GENE AND CELL DOPING              </span></span>
<span><span class="co">#&gt; 13 P1 BETA-BLOCKERS</span></span></code></pre></div>
<p><code>dopingdata</code> stores vectors with each substance group in the WADA list (S1 substances are below):</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">dopingdata</span><span class="fu">::</span><span class="va">s1_substances</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "androgenic anabolic steroid"                    </span></span>
<span><span class="co">#&gt;  [2] "androgenic anabolic steroids"                   </span></span>
<span><span class="co">#&gt;  [3] "anabolic agent"                                 </span></span>
<span><span class="co">#&gt;  [4] "anabolic agents"                                </span></span>
<span><span class="co">#&gt;  [5] "anabolic steroid"                               </span></span>
<span><span class="co">#&gt;  [6] "anabolic steroids"                              </span></span>
<span><span class="co">#&gt;  [7] "androstenedione"                                </span></span>
<span><span class="co">#&gt;  [8] "metabolites of androstenedione"                 </span></span>
<span><span class="co">#&gt;  [9] "1-androstenediol (5α-androst-1-ene-3β,17β-diol)"</span></span>
<span><span class="co">#&gt; [10] "1-androstenedione"</span></span></code></pre></div>
<p>The substance group vectors are also stored as regular expressions (<code>s1_regex</code>), which we can use to match the <code>substance_reason</code> column on:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_view.html" class="external-link">str_view</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">single_analytic_substances</span><span class="op">$</span><span class="va">substance_reason</span>,</span>
<span>  pattern <span class="op">=</span> <span class="va">s1_regex</span>, match <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [2] │ &lt;anabolic agent&gt;</span></span>
<span><span class="co">#&gt;  [9] │ &lt;epitrenbolone&gt;</span></span>
<span><span class="co">#&gt; [10] │ &lt;dehydroepiandrosterone&gt; (&lt;dhea&gt;)</span></span>
<span><span class="co">#&gt; [11] │ &lt;testosterone&gt;</span></span>
<span><span class="co">#&gt; [17] │ &lt;boldenone&gt;</span></span>
<span><span class="co">#&gt; [20] │ dehydrochlor&lt;methyltestosterone&gt; (&lt;dhcmt&gt;)</span></span>
<span><span class="co">#&gt; [22] │ &lt;testosterone&gt;</span></span>
<span><span class="co">#&gt; [23] │ &lt;testosterone&gt;</span></span>
<span><span class="co">#&gt; [27] │ &lt;androgenic anabolic steroid&gt;</span></span>
<span><span class="co">#&gt; [30] │ &lt;dehydroepiandrosterone&gt; (&lt;dhea&gt;)</span></span>
<span><span class="co">#&gt; [31] │ &lt;ostarine&gt;</span></span>
<span><span class="co">#&gt; [33] │ &lt;anabolic agent&gt;</span></span>
<span><span class="co">#&gt; [34] │ &lt;dehydroepiandrosterone&gt; (&lt;dhea&gt;)</span></span>
<span><span class="co">#&gt; [42] │ &lt;dehydroepiandrosterone&gt; (&lt;dhea&gt;)</span></span>
<span><span class="co">#&gt; [44] │ &lt;androgenic anabolic steroid&gt;</span></span>
<span><span class="co">#&gt; [46] │ &lt;stanozolol&gt;</span></span>
<span><span class="co">#&gt; [48] │ &lt;ostarine&gt;</span></span>
<span><span class="co">#&gt; [56] │ &lt;androgenic anabolic steroid&gt;</span></span>
<span><span class="co">#&gt; [58] │ &lt;dehydroepiandrosterone&gt; (&lt;dhea&gt;)</span></span>
<span><span class="co">#&gt; [59] │ &lt;androgenic anabolic steroid&gt;</span></span>
<span><span class="co">#&gt; ... and 146 more</span></span></code></pre></div>
<p>The output from <code><a href="reference/classify_wada_substances.html">classify_wada_substances()</a></code> can be used to answer questions like: <em>what <code>substance_group</code>’s appear the most?</em></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">single_analytic_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/classify_wada_substances.html">classify_wada_substances</a></span><span class="op">(</span></span>
<span>  usada_data <span class="op">=</span> <span class="va">single_analytic_substances</span>,</span>
<span>  subs_column <span class="op">=</span> <span class="va">substance_reason</span><span class="op">)</span> </span>
<span><span class="va">single_analytic_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">substance_group</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 12 × 2</span></span>
<span><span class="co">#&gt;    substance_group                         n</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                               &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 S1 ANABOLIC AGENTS                    166</span></span>
<span><span class="co">#&gt;  2 S6 STIMULANTS                          57</span></span>
<span><span class="co">#&gt;  3 S4 HORMONE AND METABOLIC MODULATORS    39</span></span>
<span><span class="co">#&gt;  4 S5 DIURETICS/MASKING AGENTS            38</span></span>
<span><span class="co">#&gt;  5 S8 CANNABINOIDS                        38</span></span>
<span><span class="co">#&gt;  6 S2 PEP HORMONES/G FACTORS/MIMETICS     18</span></span>
<span><span class="co">#&gt;  7 S3 BETA-2 AGONISTS                      9</span></span>
<span><span class="co">#&gt;  8 S9 GLUCOCORTICOIDS                      6</span></span>
<span><span class="co">#&gt;  9 UNCLASSIFIED                            6</span></span>
<span><span class="co">#&gt; 10 M1 MANIPULATION OF BLOOD                4</span></span>
<span><span class="co">#&gt; 11 S7 NARCOTICS                            2</span></span>
<span><span class="co">#&gt; 12 P1 BETA-BLOCKERS                        1</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="unclassified-substances">Unclassified substances<a class="anchor" aria-label="anchor" href="#unclassified-substances"></a>
</h3>
<p>The substances that were not classified using the standard WADA list can be added with <code><a href="reference/classify_substance.html">classify_substance()</a></code></p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">single_analytic_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">substance_group</span> <span class="op">==</span> <span class="st">"UNCLASSIFIED"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">substance_reason</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 2</span></span>
<span><span class="co">#&gt;   substance_reason                      n</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                             &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 3 whereabouts failures                1</span></span>
<span><span class="co">#&gt; 2 3α-hydroxy-5α-androst-1-en-17-one     1</span></span>
<span><span class="co">#&gt; 3 bpc-157                               1</span></span>
<span><span class="co">#&gt; 4 elevated t/e                          1</span></span>
<span><span class="co">#&gt; 5 insulin                               1</span></span>
<span><span class="co">#&gt; 6 methenolone                           1</span></span></code></pre></div>
<div class="section level4">
<h4 id="re-classifying-substances">Re-classifying substances<a class="anchor" aria-label="anchor" href="#re-classifying-substances"></a>
</h4>
<p><code><a href="reference/classify_substance.html">classify_substance()</a></code> takes a <code>df</code>, <code>substance</code>, and <code>value</code>:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">single_analytic_substances</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/classify_substance.html">classify_substance</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">single_analytic_substances</span>,</span>
<span>  substance <span class="op">=</span> <span class="st">"elevated t/e"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"S1 ANABOLIC AGENTS"</span><span class="op">)</span></span>
<span><span class="va">single_analytic_substances</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">substance_reason</span> <span class="op">==</span> <span class="st">"elevated t/e"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">substance_reason</span>, <span class="va">substance_cat</span>, <span class="va">substance_group</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span><span class="co">#&gt;   substance_reason substance_cat substance_group   </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;            &lt;chr&gt;         &lt;chr&gt;             </span></span>
<span><span class="co">#&gt; 1 elevated t/e     single        S1 ANABOLIC AGENTS</span></span></code></pre></div>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing dopingdata</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Martin Frigaard <br><small class="roles"> Maintainer, author </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Martin Frigaard.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
